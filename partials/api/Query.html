<h1><code ng:non-bindable="">Query</code>
<div><span class="hint"></span>
</div>
</h1>
<div><h2 id="description">Description</h2>
<div class="description"><div class="query-page"><p>Primary constructor that all queries inherit from. This object is a passthrough to <a href="http: //spservices.codeplex.com/">SPServices</a>.  All
options to passed through to <a href="#/api/dataService.executeQuery">dataService.executeQuery</a>.</p>
</div></div>
<h2 id="usage">Usage</h2>
<div class="usage"><pre class="prettyprint linenums">Query(queryOptions, model);</pre>
<h4 id="usage_parameters">Parameters</h4><table class="variables-matrix table table-bordered table-striped"><thead><tr><th>Param</th><th>Type</th><th>Details</th></tr></thead><tbody><tr><td>queryOptions</td><td><a href="" class="label type-hint type-hint-object">object</a></td><td><div class="query-page"><p>Initialization parameters.</p>
</div></td></tr><tr><td>queryOptions.force</td><td><a href="" class="label type-hint type-hint-boolean">boolean</a></td><td><div class="query-page"><p>Ignore cached data and force server query.</p>
</div> <p><em>(default: false)</em></p></td></tr><tr><td>[queryOptions.listItemID]</td><td><a href="" class="label type-hint type-hint-number">number</a></td><td><div class="query-page"><p>Optionally request for a single list item by id.</p>
</div></td></tr><tr><td>queryOptions.localStorage</td><td><a href="" class="label type-hint type-hint-boolean">boolean</a></td><td><div class="query-page"><p>Should we store data from this query in local storage to speed up requests in the future.</p>
</div> <p><em>(default: false)</em></p></td></tr><tr><td>queryOptions.localStorageExpiration</td><td><a href="" class="label type-hint type-hint-number">number</a></td><td><div class="query-page"><p>Set expiration in milliseconds - Defaults to a day
and if set to 0 doesn&#39;t expire.  Can be updated globally using apConfig.localStorageExpiration.</p>
</div> <p><em>(default: 86400000)</em></p></td></tr><tr><td>queryOptions.name</td><td><a href="" class="label type-hint type-hint-string">string</a></td><td><div class="query-page"><p>The name that we use to identify this query.</p>
</div> <p><em>(default: primary)</em></p></td></tr><tr><td>queryOptions.operation</td><td><a href="" class="label type-hint type-hint-string">string</a></td><td><div class="query-page"><p>Optionally use &#39;GetListItems&#39; to
receive a more efficient response, just don&#39;t have the ability to check for changes since the last time
the query was called. Defaults to <a href="http://msdn.microsoft.com/en-us/library/lists.lists.getlistitemchangessincetoken%28v=office.12%29.aspx">GetListItemChangesSinceToken</a>
but for a smaller payload and faster response you can use <a href="http: //spservices.codeplex.com/wikipage?title=GetListItems&amp;referringTitle=Lists">GetListItems</a>.</p>
</div> <p><em>(default: GetListItemChangesSinceToken)</em></p></td></tr><tr><td>queryOptions.query</td><td><a href="" class="label type-hint type-hint-string">string</a></td><td><div class="query-page"><p>CAML query passed to SharePoint to control
the data SharePoint returns. Josh McCarty has a good quick reference <a href="http: //joshmccarty.com/2012/06/a-caml-query-quick-reference">here</a>.</p>
</div> <p><em>(default: Ordered ascending by ID)</em></p></td></tr><tr><td>[queryOptions.queryOptions]</td><td><a href="" class="label type-hint type-hint-string">string</a></td><td><div class="query-page"><p>SharePoint options xml as string.
<pre class="prettyprint linenums">
&lt;QueryOptions&gt;
   &lt;IncludeMandatoryColumns&gt;FALSE&lt;/IncludeMandatoryColumns&gt;
   &lt;IncludeAttachmentUrls&gt;TRUE&lt;/IncludeAttachmentUrls&gt;
   &lt;IncludeAttachmentVersion&gt;FALSE&lt;/IncludeAttachmentVersion&gt;
   &lt;ExpandUserField&gt;FALSE&lt;/ExpandUserField&gt;
&lt;/QueryOptions&gt;
</pre>
</div></td></tr><tr><td>[queryOptions.rowLimit]</td><td><a href="" class="label type-hint type-hint-string">string</a></td><td><div class="query-page"><p>The number of list items to return, 0 returns all list items.</p>
</div></td></tr><tr><td>[queryOptions.runOnce]</td><td><a href="" class="label type-hint type-hint-boolean">boolean</a></td><td><div class="query-page"><p>Pertains to GetListItems only, optionally run a single time and return initial value for all future
calls.  Works well with data that isn&#39;t expected to change throughout the session but unlike localStorage or sessionStorage
the data doesn&#39;t persist between sessions.</p>
</div></td></tr><tr><td>queryOptions.sessionStorage</td><td><a href="" class="label type-hint type-hint-boolean">boolean</a></td><td><div class="query-page"><p>Use the browsers sessionStorage to cache the list items and uses the
queryOptions.localStorageExpiration param to validate how long the cache is good for.</p>
</div> <p><em>(default: false)</em></p></td></tr><tr><td>[queryOptions.viewFields]</td><td><a href="" class="label type-hint type-hint-string">string</a></td><td><div class="query-page"><p>XML as string that specifies fields to return.</p>
</div></td></tr><tr><td>[queryOptions.webURL]</td><td><a href="" class="label type-hint type-hint-string">string</a></td><td><div class="query-page"><p>Used to override the default URL if list is located somewhere else.</p>
</div></td></tr><tr><td>model</td><td><a href="" class="label type-hint type-hint-object">object</a></td><td><div class="query-page"><p>Reference to the parent model for the query.  Allows us to reference when out of
scope.</p>
</div></td></tr></tbody></table></div>
<div class="member method"><h2 id="methods">Methods</h2>
<ul class="methods"><li><h3 id="methods_execute">execute([options])</h3>
<div class="execute"><div class="query-execute-page"><p>Query SharePoint, pull down all initial records on first call along with list definition if using
&quot;GetListItemChangesSinceToken&quot;.  Note: this is  substantially larger than &quot;GetListItems&quot; on first call.
Subsequent calls pulls down changes (Assuming operation: &quot;GetListItemChangesSinceToken&quot;).</p>
</div><h5 id="methods_execute_parameters">Parameters</h5><table class="variables-matrix table table-bordered table-striped"><thead><tr><th>Param</th><th>Type</th><th>Details</th></tr></thead><tbody><tr><td>[options]</td><td><a href="" class="label type-hint type-hint-object">object</a></td><td><div class="query-execute-page"><p>Any options that should be passed to dataService.executeQuery.</p>
</div></td></tr></tbody></table><h5 id="methods_execute_returns">Returns</h5><table class="variables-matrix"><tr><td><a href="" class="label type-hint type-hint-object">object[]</a></td><td><div class="query-execute-page"><p>Array of list item objects.</p>
</div></td></tr></table></div>
</li>
<li><h3 id="methods_getcache">getCache()</h3>
<div class="getcache"><div class="query-getcache-page"><p>Use this to return the cache instead of using the actual property to allow for future refactoring.</p>
</div><h5 id="methods_getcache_returns">Returns</h5><table class="variables-matrix"><tr><td><a href="" class="label type-hint type-hint-indexedcache">IndexedCache&lt;T&gt;</a></td><td><div class="query-getcache-page"><p>Indexed Cache containing all elements in query.</p>
</div></td></tr></table></div>
</li>
<li><h3 id="methods_getlocalstorage">getLocalStorage()</h3>
<div class="getlocalstorage"><div class="query-getlocalstorage-page"><p>Use this to return query data currenty saved in user&#39;s local or session storage.</p>
</div><h5 id="methods_getlocalstorage_returns">Returns</h5><table class="variables-matrix"><tr><td><a href="" class="label type-hint type-hint-localstoragequery">LocalStorageQuery</a></td><td><div class="query-getlocalstorage-page"><p>Local storage data for this query.</p>
</div></td></tr></table></div>
</li>
<li><h3 id="methods_hydratefromlocalstorage">hydrateFromLocalStorage()</h3>
<div class="hydratefromlocalstorage"><div class="query-hydratefromlocalstorage-page"><p>If data already exists in browser local storage, we rehydrate JSON using list item constructor and
then have the ability to just check the server to see what has changed from the current state.</p>
</div></div>
</li>
<li><h3 id="methods_processresults">processResults()</h3>
<div class="processresults"><div class="query-processresults-page"><p>Internal method exposed to allow for testing.  Handle cleanup after query execution is complete.</p>
</div></div>
</li>
<li><h3 id="methods_savetolocalstorage">saveToLocalStorage()</h3>
<div class="savetolocalstorage"><div class="query-savetolocalstorage-page"><p>Save a snapshot of the current state to local/session storage so we can speed up calls
for data already residing on the users machine.</p>
</div></div>
</li>
</ul>
</div>
<h2 id="example">Example</h2>
<div class="example"><div class="query-page"><pre class="prettyprint linenums">
// Query to retrieve the most recent 25 modifications
model.registerQuery({
   name: 'recentChanges',
   CAMLRowLimit: 25,
   query: '' +
       '&lt;Query&gt;' +
       '   &lt;OrderBy&gt;' +
       '       &lt;FieldRef Name="Modified" Ascending="FALSE"/&gt;' +
       '   &lt;/OrderBy&gt;' +
           // Prevents any records from being returned if user
           // doesn't have permissions on project
       '   &lt;Where&gt;' +
       '       &lt;IsNotNull&gt;' +
       '           &lt;FieldRef Name="Project"/&gt;' +
       '       &lt;/IsNotNull&gt;' +
       '   &lt;/Where&gt;' +
       '&lt;/Query&gt;'
});
</pre>
</div></div>
</div>
