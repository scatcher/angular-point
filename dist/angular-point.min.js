"use strict";try{angular.module("toastr")}catch(e){angular.module("toastr",[]).factory("toastr",["$log",function(a){return{error:a.error,info:a.info,success:a.info,warning:a.warn}}])}angular.module("angularPoint",["toastr"]).run(function(){}),angular.module("angularPoint").constant("apConfig",{appTitle:"SP-Angular",debugEnabled:!0,firebaseURL:"The url of your firebase source",offline:window.location.href.indexOf("localhost")>-1||window.location.href.indexOf("http://0.")>-1||window.location.href.indexOf("http://10.")>-1||window.location.href.indexOf("http://192.")>-1}),angular.module("angularPoint").service("apDataService",["$q","$timeout","apQueueService","apConfig","apUtilityService","toastr",function(a,b,c,d,e,f){function g(a,b){var c=0,d=0,e=_.pluck(a,"id");return _.each(b,function(b){-1===e.indexOf(b.id)?(a.push(b),e.push(b.id),d++):(a[e.indexOf(b.id)]=b,c++)}),{created:d,updated:c}}function h(a,b){var c=[],d=$(a).find("Version").length;return $(a).find("Version").each(function(a){var f=this,g={editor:e.attrToJson($(f).attr("Editor"),"User"),modified:e.attrToJson($(f).attr("Modified"),"DateTime"),version:d-a};g[b.mappedName]=e.attrToJson($(f).attr(b.internalName),b.objectType),c.unshift(g)}),c}function i(a,b){var c=!1,d=_.findWhere(a,{id:b}),e=_.indexOf(a,d);return e&&(a.splice(e,1),c=!0),c}function j(a){return $(a).find("Changes").attr("LastChangeToken")}function k(a){return $(a).find("listitems").attr("EffectivePermMask")}function l(a,b){var c=0;$(a).SPFilterNode("Id").each(function(){var a=$(this).attr("ChangeType");if("Delete"===a){var d=parseInt($(this).text(),10),e=i(b,d);e&&c++}}),c>0&&p&&console.log(c+" item(s) removed from local cache to mirror changes on source list.")}function m(a,b){var c=[];return _.each(a,function(a){_.has(b,a.mappedName)&&c.push(A(a,b[a.mappedName]))}),c}function n(a,b,c){var d=0;return _.each(a.queries,function(a){a!=c&&g(a.cache,[b])}),d}var o={},p=d.offline,q=!p,r=d.defaultUrl||q?$().SPServices.SPGetCurrentSite():"",s=function(a,b,d){c.decrease();var f={factory:a.factory,filter:"z:row",mapping:a.list.mapping,mode:"update",target:a.getCache()},h=_.extend({},f,d),i=$(b).SPFilterNode(h.filter),j=e.xmlToJson(i,{mapping:h.mapping}),k=[];if(_.each(j,function(b){b.getQuery=function(){return h.getQuery()},b.getContainer=function(){return h.target},k.push(new a.factory(b))}),"replace"===h.mode)h.target=k,p&&console.log(a.list.title+" Replaced with "+h.target.length+" new records.");else if("update"===h.mode){var l=g(h.target,k);p&&console.log(a.list.title+" Changes (Create: "+l.created+" | Update: "+l.updated+")")}return k},t=function(c,d){var e=a.defer();if(q){var g=$().SPServices(c);g.then(function(){var a=h(g.responseText,d);e.resolve(a)},function(a){f.error("Failed to fetch version history."),e.reject(a)})}else b(function(){e.resolve([])});return e.promise},u=function(b){c.increase();var d={webURL:r},e=_.extend({},d,b),g=e.filterNode||e.operation.split("Get")[1].split("Collection")[0],h=a.defer(),i=function(a){var b=[];return"GetAttachmentCollection"===e.operation?$(a).SPFilterNode(g).each(function(){b.push($(this).text())}):b=$(a).SPFilterNode(g).SPXmlToJson({includeAllAttrs:!0,removeOws:!1}),b};if(p){var j="dev/"+e.operation+".xml";$.ajax(j).then(function(a){c.decrease(),h.resolve(i(a))},function(a){f.error("You need to have a dev/"+e.operation+".xml in order to get the group collection in offline mode."),h.reject(a),c.decrease()})}else{var k=!0,l={};_.extend(l,e);var m=function(a){_.each(a,function(a){l[a]||(f.error("options"+a+" is required to complete this operation"),k=!1,h.reject([]))})};switch(e.operation){case"GetGroupCollectionFromUser":m(["userLoginName"]);break;case"GetUserCollectionFromGroup":m(["groupName"]);break;case"GetViewCollection":m(["listName"]);break;case"GetAttachmentCollection":m(["listName","ID"])}if(k){var n=$().SPServices(l);n.then(function(){c.decrease(),h.resolve(i(n.responseXML))},function(a){f.error("Failed to fetch list collection."),c.decrease(),h.reject(a)})}}return h.promise},v=function(b){var d={webURL:r},e=_.extend({},d,b),g=a.defer();c.increase();var h=function(a){return e.filterNode?$(a).SPFilterNode(e.filterNode).SPXmlToJson({includeAllAttrs:!0,removeOws:!1}):a};if(q){var i={};_.extend(i,e);var j=$().SPServices(i);j.then(function(){c.decrease(),g.resolve(h(j.responseXML))},function(a){f.error("Failed to fetch list collection."),c.decrease(),g.reject(a)})}else{var k="dev/"+e.operation+".xml";$.ajax(k).then(function(a){c.decrease(),g.resolve(h(a))},function(a){f.error("You need to have a dev/"+e.operation+".xml in order to get the group collection in offline mode."),g.reject(a),c.decrease()})}return g.promise},w=function(b){var d=_.extend({},b);c.increase();var e=a.defer(),g=$().SPServices({operation:"GetList",listName:d.listName});return g.then(function(){c.decrease();var a=$(g.responseXML).SPFilterNode("Field").SPXmlToJson({includeAllAttrs:!0,removeOws:!1});e.resolve(a)},function(a){e.reject(a),f.error("Failed to fetch list details.")}).always(function(){c.decrease()}),e.promise},x=function(b){var d={operation:"DeleteAttachment"},e=_.extend({},d,b);c.increase();var g=a.defer(),h=$().SPServices({operation:"DeleteAttachment",listItemID:e.listItemId,url:e.url,listName:e.listName});return h.then(function(){c.decrease();var a=$(h.responseXML).SPFilterNode("Field").SPXmlToJson({includeAllAttrs:!0,removeOws:!1});g.resolve(a)},function(a){g.reject(a),f.error("Failed to fetch list details.")}).always(function(){c.decrease()}),g.promise},y=function(b){var d=_.extend({},b),e=a.defer();c.increase();var g={operation:"GetView",listName:d.listName};d.viewName&&(g.viewName=d.viewName);var h=$().SPServices(g);return h.then(function(){var a={query:"<Query>"+$(h.responseText).find("Query").html()+"</Query>",viewFields:"<ViewFields>"+$(h.responseText).find("ViewFields").html()+"</ViewFields>",rowLimit:$(h.responseText).find("RowLimit").html()};e.resolve(a)},function(a){f.error("Failed to fetch view details."),e.reject(a)}).always(function(){c.decrease()}),e.promise},z=function(b,d,e){var g={target:b.getCache()},h=a.defer(),i=_.extend({},g,e);if(i.getQuery=function(){return d},c.increase(),q){var m=$().SPServices(d);m.then(function(){var a=m.responseXML;if("GetListItemChangesSinceToken"===d.operation){d.changeToken=j(a);var e=k(a);e&&(b.list.effectivePermMask=e),l(a,i.target)}var f=s(b,a,i);d.lastRun=new Date,c.decrease(),h.resolve(f)})}else{var n=i.offlineXML||d.offlineXML||"dev/"+b.list.title+".xml";d.lastRun?(d.lastRun=new Date,c.decrease(),h.resolve(d.cache)):$.ajax(n).then(function(a){var e=s(b,a,i);d.lastRun=new Date,c.decrease(),h.resolve(e)},function(){var a=b.generateMockData();h.resolve(a),f.error('There was a problem locating the "dev/'+b.list.title+'.xml"')})}return h.promise},A=function(a,b){var c=[],d=a.internalName;if(b&&""!==b){switch(a.objectType){case"Lookup":case"User":c=b.lookupId?[d,b.lookupId]:[d,""];break;case"LookupMulti":case"UserMulti":var f=e.stringifySharePointMultiSelect(b,"lookupId");c=[a.internalName,f];break;case"Boolean":c=[d,b?1:0];break;case"DateTime":c=_.isDate(b)?[d,e.stringifySharePointDate(b)]:[d,""];break;case"Note":case"HTML":c=[d,_.escape(b)];break;case"JSON":c=[d,angular.toJson(b)];break;default:c=[d,b]}p&&console.log("{"+a.objectType+"} "+c)}else c=[d,""];return c},B=function(b,d,e){var g={mode:"update",buildValuePairs:!0,updateAllCaches:!1,valuePairs:[]},h=a.defer(),i=_.extend({},g,e);if(c.increase(),i.buildValuePairs===!0){var j=_.where(b.list.fields,{readOnly:!1});i.valuePairs=m(j,d)}var k={operation:"UpdateListItems",webURL:b.list.webURL,listName:b.list.guid,valuepairs:i.valuePairs};if(_.isObject(d)&&_.isNumber(d.id)?(k.batchCmd="Update",k.ID=d.id):k.batchCmd="New",q){var l=$().SPServices(k);l.then(function(){var a=s(b,l.responseXML,i),c=a[0];i.updateAllCaches&&_.isNumber(d.id)&&n(b,c,d.getQuery(),"update"),h.resolve(c)},function(a){f.error("There was an error getting the requested data from "+b.list.name),h.reject(a)}).always(function(){c.decrease()})}else{window.console.log(k);var o={modified:new Date,editor:{lookupId:23,lookupValue:"Generic User"}};if(d.id)_.extend(d,o),h.resolve(d);else{var p;o.author={lookupId:23,lookupValue:"Generic User"},o.created=new Date,_.each(b.queries,function(a){var c=1;_.each(a.cache,function(a){a.id>c&&(c=a.id)}),o.id=c+1,_.extend(d,o),p=new b.factory(d),a.cache.push(p)}),h.resolve(p)}c.decrease()}return h.promise},C=function(b,d,e){function g(){var a=0;if(j.updateAllCaches){var b=d.getModel();_.each(b.queries,function(b){var c=i(b.cache,d.id);c&&a++})}else{var c=i(j.target,d.id);c&&a++}return a}c.increase();var h={target:d.getContainer(),updateAllCaches:!1},j=_.extend({},h,e),k={operation:"UpdateListItems",webURL:b.list.webURL,listName:b.list.guid,batchCmd:"Delete",ID:d.id},l=a.defer();if(q){var m=$().SPServices(k);m.then(function(){g(),c.decrease(),l.resolve(j.target)},function(a){f.error("There was an error deleting a list item from "+b.list.title),c.decrease(),l.reject(a)})}else g(),c.decrease(),l.resolve(j.target);return l.promise};return _.extend(o,{addUpdateItemModel:B,createValuePair:A,deleteAttachment:x,deleteItemModel:C,generateValuePairs:m,getCollection:u,getFieldVersionHistory:t,getList:w,getView:y,executeQuery:z,processListItems:s,serviceWrapper:v}),o}]),angular.module("angularPoint").service("apFieldService",["apUtilityService",function(a){function b(){return chance.bool()}function c(){return chance.word()+" "+chance.word()}function d(){return chance.paragraph()}function e(){return parseInt(100*_.random(1e7,!0))/100}function f(){return chance.date()}function g(){return chance.integer()}function h(a){var b;switch(a){case"AddListItems":b="0x0000000000000002";break;case"EditListItems":b="0x0000000000000004";break;case"DeleteListItems":b="0x0000000000000008";break;case"ApproveItems":b="0x0000000000000010";break;case"FullMask":b="0x7FFFFFFFFFFFFFFF";break;case"ViewListItems":default:b="0x0000000000000001"}return b}function i(a){var b="FullMask";return a&&a.permissionLevel&&(b=a.permissionLevel),h(b)}function j(){return{lookupId:s(),lookupValue:chance.word()}}function k(){return{lookupId:s(),lookupValue:chance.name()}}function l(){var a=[];return _.each(_.random(10),function(){a.push(j())}),a}function m(){var a=[];return _.each(_.random(10),function(){a.push(k())}),a}function n(b){var c=this,d={readOnly:!1,objectType:"Text"};_.extend(c,d,b),c.displayName=c.displayName||a.fromCamelCase(c.mappedName)}function o(a){return t[a]}function p(a){var b,c=o(a);return c&&(b=c.defaultValue),b}function q(a,b){var c,d=o(a);return d&&(c=!b||!b.staticValue&&_.isFunction(chance)?d.dynamicMock(b):d.staticMock),c}function r(a){var b=function(b){var c=new n(b);a.fields.push(c),a.viewFields+='<FieldRef Name="'+c.internalName+'"/>',a.mapping["ows_"+c.internalName]={mappedName:c.mappedName,objectType:c.objectType}};a.viewFields+="<ViewFields>",_.each(u,function(a){b(a)}),_.each(a.customFields,function(a){b(a)}),a.viewFields+="</ViewFields>"}var s=function(){var a=s;return a.count=a.count||0,a.count++,a.count};n.prototype.getDefinition=function(){return o(this.objectType)},n.prototype.getDefaultValueForType=function(){return p(this.objectType)},n.prototype.getMockData=function(a){return q(this.objectType,a)};var t={Text:{defaultValue:"",staticMock:"Test String",dynamicMock:c},TextLong:{defaultValue:"",staticMock:"This is a sentence.",dynamicMock:d},Boolean:{defaultValue:null,staticMock:!0,dynamicMock:b},Counter:{defaultValue:null,staticMock:s(),dynamicMock:s},Currency:{defaultValue:null,staticMock:120.5,dynamicMock:e},DateTime:{defaultValue:null,staticMock:new Date(2014,5,4,11,33,25),dynamicMock:f},Integer:{defaultValue:null,staticMock:14,dynamicMock:g},JSON:{defaultValue:"",staticMock:[{id:1,title:"test"},{id:2}],dynamicMock:c},Lookup:{defaultValue:"",staticMock:{lookupId:49,lookupValue:"Static Lookup"},dynamicMock:j},LookupMulti:{defaultValue:[],staticMock:[{lookupId:50,lookupValue:"Static Multi 1"},{lookupId:51,lookupValue:"Static Multi 2"}],dynamicMock:l},Mask:{defaultValue:i(),staticMock:i(),dynamicMock:i},User:{defaultValue:"",staticMock:{lookupId:52,lookupValue:"Static User"},dynamicMock:k},UserMulti:{defaultValue:[],staticMock:[{lookupId:53,lookupValue:"Static User 1"},{lookupId:54,lookupValue:"Static User 2"}],dynamicMock:m}},u=[{internalName:"ID",objectType:"Counter",mappedName:"id",readOnly:!0},{internalName:"Modified",objectType:"DateTime",mappedName:"modified",readOnly:!0},{internalName:"Created",objectType:"DateTime",mappedName:"created",readOnly:!0},{internalName:"Author",objectType:"User",mappedName:"author",readOnly:!0},{internalName:"Editor",objectType:"User",mappedName:"editor",readOnly:!0},{internalName:"PermMask",objectType:"Mask",mappedName:"permMask",readOnly:!0}];return{defaultFields:u,extendFieldDefinitions:r,getDefaultValueForType:p,getMockData:q,getDefinition:o,mockPermMask:i,resolveValueForEffectivePermMask:h}}]),angular.module("angularPoint").service("apModalService",["$modal","toastr",function(a,b){function c(b){return function c(){var d=c,e={templateUrl:b.templateUrl,controller:b.controller,resolve:{}},f=_.extend({},e,b),g=arguments;_.each(b.expectedArguments,function(a,b){f.resolve[a]=function(){return g[b]}});var h=a.open(f);return g[0]&&(d.snapshot=angular.copy(g[0]),h.result.then(function(){},function(){_.extend(g[0],d.snapshot)})),h.result}}function d(a){var b={userCanEdit:!0,userCanDelete:!1,userCanApprove:!1,fullControl:!1};if(_.isObject(a)&&_.isFunction(a.resolvePermissions)){var c=a.resolvePermissions();b.userCanEdit=c.EditListItems,b.userCanDelete=c.DeleteListItems,b.userCanApprove=c.ApproveItems,b.fullControl=c.FullMask}return b}function e(a,b){var c={userCanEdit:!1,userCanDelete:!1,negotiatingWithServer:!1,locked:!1,lockedBy:"",displayMode:"View"},e=d(a);return a&&a.id?e.userCanEdit&&(c.displayMode="Edit"):c.displayMode="New",_.extend(c,e,b)}function f(a,c,d){var e=window.confirm("Are you sure you want to delete this record?");e&&(c.negotiatingWithServer=!0,a.deleteItem().then(function(){b.success("Record deleted successfully"),d.close()},function(){b.error("Failed to delete record.  Please try again.")}))}function g(a,c,d,e){a.id?a.saveChanges().then(function(){b.success("Record updated"),e.close()},function(){b.error("There was a problem updating this record.  Please try again.")}):c.addNewItem(a).then(function(){b.success("New record created"),e.close()},function(){b.error("There was a problem creating a new record.  Please try again.")})}return{deleteEntity:f,initializeState:e,modalModelProvider:c,getPermissions:d,saveEntity:g}}]),angular.module("angularPoint").factory("apModelFactory",["$q","$timeout","apConfig","apDataService","apFieldService","toastr",function(a,b,c,d,e,f){function g(a){var b=this,c={data:[],factory:n,lastServerUpdate:null,queries:{}};return _.extend(b,c,a),b.list=new i(b.list),b.factory.prototype=new h,b.factory.prototype.getModel=function(){return b},b}function h(){}function i(a){var b={viewFields:"",customFields:[],isReady:!1,fields:[],guid:"",mapping:{},title:"",webURL:c.defaultUrl},d=_.extend({},b,a);return e.extendFieldDefinitions(d),d}function j(b,d){var e=this,f={cache:[],initialized:a.defer(),lastRun:null,listName:d.list.guid,negotiatingWithServer:!1,operation:"GetListItemChangesSinceToken",cacheXML:!1,query:'<Query>   <OrderBy>       <FieldRef Name="ID" Ascending="TRUE"/>   </OrderBy></Query>',queryOptions:"<QueryOptions>   <IncludeMandatoryColumns>FALSE</IncludeMandatoryColumns>   <IncludeAttachmentUrls>TRUE</IncludeAttachmentUrls>   <IncludeAttachmentVersion>FALSE</IncludeAttachmentVersion>   <ExpandUserField>FALSE</ExpandUserField></QueryOptions>",viewFields:d.list.viewFields,webURL:c.defaultUrl};_.extend(e,f,b);var g=[["query","CAMLQuery"],["viewFields","CAMLViewFields"],["rowLimit","CAMLRowLimit"],["queryOptions","CAMLQueryOptions"],["listItemID","ID"]];_.each(g,function(a){e[a[0]]&&!e[a[1]]&&(e[a[1]]=e[a[0]])}),e.getModel=function(){return d}}function k(a){!c.offline&&a.sync&&_.isFunction(a.sync.registerChange)&&a.sync.registerChange()}function l(a){var b={};return b.ViewListItems=(1&a)>0,b.AddListItems=(2&a)>0,b.EditListItems=(4&a)>0,b.DeleteListItems=(8&a)>0,b.ApproveItems=(16&a)>0,b.OpenItems=(32&a)>0,b.ViewVersions=(64&a)>0,b.DeleteVersions=(128&a)>0,b.CancelCheckout=(256&a)>0,b.PersonalViews=(512&a)>0,b.ManageLists=(2048&a)>0,b.ViewFormPages=(4096&a)>0,b.Open=(65536&a)>0,b.ViewPages=(131072&a)>0,b.AddAndCustomizePages=(262144&a)>0,b.ApplyThemeAndBorder=(524288&a)>0,b.ApplyStyleSheets=(1048576&a)>0,b.ViewUsageData=(2097152&a)>0,b.CreateSSCSite=(4194314&a)>0,b.ManageSubwebs=(8388608&a)>0,b.CreateGroups=(16777216&a)>0,b.ManagePermissions=(33554432&a)>0,b.BrowseDirectories=(67108864&a)>0,b.BrowseUserInfo=(134217728&a)>0,b.AddDelPrivateWebParts=(268435456&a)>0,b.UpdatePersonalWebParts=(536870912&a)>0,b.ManageWeb=(1073741824&a)>0,b.UseRemoteAPIs=(137438953472&a)>0,b.ManageAlerts=(274877906944&a)>0,b.CreateAlerts=(549755813888&a)>0,b.EditMyUserInfo=(1099511627776&a)>0,b.EnumeratePermissions=(0x4000000000000000&a)>0,b.FullMask=0x8000000000000000==a,b.FullMask&&_.each(b,function(a,c){b[c]=!0}),b}var m="primary",n=function(a){var b=this;_.extend(b,a)};return g.prototype.getAllListItems=function(){var b=a.defer();return d.executeQuery(this,this.queries.getAllListItems,{deferred:b}).then(function(a){b.resolve(a)}),b.promise()},g.prototype.addNewItem=function(b,c){var e=this,f=a.defer();return d.addUpdateItemModel(e,b,c).then(function(a){f.resolve(a),k(e)}),f.promise},g.prototype.registerQuery=function(a){var b=this,c={name:m};return a=_.extend({},c,a),b.queries[a.name]=new j(a,b),b.queries[a.name]},g.prototype.getQuery=function(a){var b,c=this;return b=_.isObject(c.queries[a])?c.queries[a]:_.isObject(c.queries[m])&&!a?c.queries[m]:void 0},g.prototype.getCache=function(a){var b,c,d=this;return b=d.getQuery(a),b&&b.cache&&(c=b.cache),c},g.prototype.executeQuery=function(a,b){var c=this,d=c.getQuery(a);return d?d.execute(b):void 0},g.prototype.isInitialised=function(){return _.isDate(this.lastServerUpdate)},g.prototype.searchLocalCache=function(a,b){var c,d=this,e=d.searchLocalCache,f={propertyPath:"id",localCache:d.getCache(),cacheName:"main",rebuildIndex:!1},g=_.extend({},f,b);e.indexCache=e.indexCache||{},e.indexCache[g.cacheName]=e.indexCache[g.cacheName]||{};var h=e.indexCache[g.cacheName],i=g.propertyPath.split(".");return _.each(i,function(a){h[a]=h[a]||{},h=h[a]}),h.map=h.map||[],(!_.isNumber(h.count)||h.count!==g.localCache.length||g.rebuildIndex)&&(h.map=_.deepPluck(g.localCache,g.propertyPath),h.count=g.localCache.length),_.isArray(a)?(c=[],_.each(a,function(a){c.push(g.localCache[h.map.indexOf(a)])})):c=g.localCache[h.map.indexOf(a)],c},g.prototype.createEmptyItem=function(a){var b=this,c={};_.each(b.list.customFields,function(a){a.readOnly||(c[a.mappedName]=e.getDefaultValueForType(a.objectType))});var d=_.extend({},c,a);return new b.factory(d)},g.prototype.generateMockData=function(a){var b=[],c=this,d={quantity:10,staticValue:!1,permissionLevel:"FullMask"},e=_.extend({},d,a);return _.times(e.quantity,function(){var a={};_.each(c.list.fields,function(b){a[b.mappedName]=b.getMockData(e)}),b.push(new c.factory(a))}),b},g.prototype.validateEntity=function(a,b){var c=!0,d=this,e={toast:!0},g=_.extend({},e,b),h=function(a){return _.isObject(a)&&_.isNumber(a.lookupId)};return _.each(d.list.customFields,function(b){var d=a[b.mappedName],e='"'+b.objectType+'" value.';if(b.required&&c){switch(b.objectType){case"DateTime":c=_.isDate(d);break;case"Lookup":case"User":c=h(d);break;case"LookupMulti":case"UserMulti":c=_.isArray(d)&&d.length>0,c&&_.each(d,function(a){return c?void(c=h(a)):!1});break;default:c=!_.isEmpty(d)}if(!c&&g.toast){var i=b.label||b.internalName;f.error(i+" does not appear to be a valid "+e)}}return c?void 0:!1}),c},h.prototype.getDataService=function(){return d},h.prototype.saveChanges=function(b){var c=this,e=c.getModel(),f=a.defer();return d.addUpdateItemModel(e,c,b).then(function(a){f.resolve(a),k(e)}),f.promise},h.prototype.saveFields=function(b,c){var e=this,f=e.getModel(),g=a.defer(),h=[];_.each(b,function(a){var b=_.findWhere(f.list.customFields,{mappedName:a});b&&h.push(b)});var i=d.generateValuePairs(h,e),j={buildValuePairs:!1,valuePairs:i},l=_.extend({},j,c);return d.addUpdateItemModel(f,e,l).then(function(a){g.resolve(a),k(f)}),g.promise},h.prototype.deleteItem=function(b){var c=this,e=c.getModel(),f=a.defer();return d.deleteItemModel(e,c,b).then(function(a){f.resolve(a),k(e)}),f.promise},h.prototype.validateEntity=function(a){var b=this,c=b.getModel();return c.validateEntity(b,a)},h.prototype.getAttachmentCollection=function(){return d.getCollection({operation:"GetAttachmentCollection",listName:this.getModel().list.guid,webURL:this.getModel().list.webURL,ID:this.id,filterNode:"Attachment"})},h.prototype.deleteAttachment=function(a){var b=this;return d.deleteAttachment({listItemId:b.id,url:a,listName:b.getModel().list.guid})},h.prototype.resolvePermissions=function(){return l(this.permMask)},h.prototype.getFieldVersionHistory=function(b){var e=a.defer(),f=[],g=this,h=g.getModel(),i=function(a){var b=_.findWhere(h.list.fields,{mappedName:a}),e={operation:"GetVersionCollection",webURL:c.defaultUrl,strlistID:h.list.guid,strlistItemID:g.id,strFieldName:b.internalName};f.push(d.getFieldVersionHistory(e,b))};if(b)_.isString(b)&&(b=[b]);else{var j=_.where(h.list.fields,{readOnly:!1});b=[],_.each(j,function(a){b.push(a.mappedName)})}return _.each(b,function(a){i(a)}),a.all(f).then(function(a){var b={};_.each(a,function(a){_.each(a,function(a){b[a.modified.toJSON()]||(b[a.modified.toJSON()]={}),_.extend(b[a.modified.toJSON()],a)})});var c=[];_.each(b,function(a,b){a.version=b,c.push(a)}),e.resolve(c)}),e.promise},j.prototype.execute=function(b){var c=this,e=c.getModel(),f=a.defer();if(c.negotiatingWithServer)return c.promise;c.negotiatingWithServer=!0;var g=_.isNull(c.lastRun),h={target:c.cache},i=_.extend({},h,b);return d.executeQuery(e,c,i).then(function(){g&&(c.initialized.resolve(i.target),c.negotiatingWithServer=!1),e.lastServerUpdate=new Date,f.resolve(i.target)}),c.promise=f.promise,f.promise},j.prototype.searchLocalCache=function(a,b){var c=this,d=c.getModel(),e={cacheName:c.name,localCache:c.cache},f=_.extend({},e,b);return d.searchLocalCache(a,f)},{ListItem:h,Model:g,Query:j,resolvePermissions:l}}]),angular.module("angularPoint").service("apQueueService",function(){var a=0,b=function(){return a++,g(),a},c=function(){return a>0?(a--,g(),a):void 0},d=function(){return a=0,g(),a},e=[],f=function(a){e.push(a)},g=function(){angular.forEach(e,function(b){b(a)})};return{count:a,decrease:c,increase:b,registerObserverCallback:f,reset:d}}),angular.module("angularPoint").service("apUtilityService",function(){function a(a,n){var o;switch(n){case"DateTime":case"datetime":o=g(a);break;case"Lookup":o=j(a);break;case"User":o=h(a);break;case"LookupMulti":o=k(a);break;case"UserMulti":o=i(a);break;case"Boolean":o=f(a);break;case"Integer":o=d(a);break;case"Counter":o=d(a);break;case"MultiChoice":o=l(a);break;case"Currency":case"Number":case"float":o=e(a);break;case"Calc":o=m(a);break;case"JSON":o=b(a);break;default:o=c(a)}return o}function b(a){return JSON.parse(a)}function c(a){return a}function d(a){return parseInt(a,10)}function e(a){return parseFloat(a)}function f(a){return"0"===a||"False"===a?!1:!0}function g(a){return new Date(a.replace(/-/g,"/"))}function h(a){return 0===a.length?null:new r(a)}function i(a){if(0===a.length)return null;for(var b=[],c=a.split(";#"),d=0;d<c.length;d+=2){var e=h(c[d]+";#"+c[d+1]);b.push(e)}return b}function j(a){return 0===a.length?null:new q(a)}function k(a){if(0===a.length)return[];for(var b=[],c=a.split(";#"),d=0;d<c.length;d+=2){var e=j(c[d]+";#"+c[d+1]);b.push(e)}return b}function l(a){if(0===a.length)return[];for(var b=[],c=a.split(";#"),d=0;d<c.length;d++)0!==c[d].length&&b.push(c[d]);return b}function m(b){if(0===b.length)return null;var c=b.split(";#");return a(c[1],c[0])}function n(a){var b=a.split(";#");this.id=parseInt(b[0],10),this.value=b[1]}function o(a){return a.replace(/(?:^\w|[A-Z]|\b\w)/g,function(a,b){return 0==b?a.toLowerCase():a.toUpperCase()}).replace(/\s+/g,"")}function p(a){a.replace(/([A-Z])/g," $1").replace(/^./,function(a){return a.toUpperCase()})}function q(a){var b=new n(a);this.lookupId=b.id,this.lookupValue=b.value}function r(a){var b=this,c=new n(a),d=c.value.split(",#");1===d.length?(b.lookupId=c.id,b.lookupValue=c.value):(b.lookupId=c.id,b.lookupValue=d[0].replace(/(,,)/g,","),b.loginName=d[1].replace(/(,,)/g,","),b.email=d[2].replace(/(,,)/g,","),b.sipAddress=d[3].replace(/(,,)/g,","),b.title=d[4].replace(/(,,)/g,","))}function s(a){return a>9?a.toString():"0"+a}function t(a){if(!_.isDate(a))return"";var b=this,c="";return c+=a.getFullYear(),c+="-",c+=s(a.getMonth()+1),c+="-",c+=s(a.getDate()),c+="T",c+=s(a.getHours()),c+=":",c+=s(a.getMinutes()),c+=":",c+=s(a.getSeconds()),c+="Z-",b.timeZone||(window.console.log("Calculating"),b.timeZone=(new Date).getTimezoneOffset()/60),c+=s(b.timeZone),c+=":00"}function u(a,b){var c="",d=b||"lookupId";return _.each(a,function(b,e){c+=b[d],e<a.length&&(c+=";#;#")}),c}function v(a){var b=a.getFullYear().toString(),c=(a.getMonth()+1).toString(),d=a.getDate().toString();return parseInt(b+s(c)+s(d))}function w(a,b,c){if(!a||!b)return!1;c=c||new Date;var d=v(a),e=v(b),f=v(c);return f>=d&&e>=f}_.mixin({isDefined:function(a){return!_.isUndefined(a)}});var x=function(b,c){var d,e=$.extend({},{mapping:{},includeAllAttrs:!1,removeOws:!0},c),f=[];return _.each(b,function(b){var c={},g=b.attributes;for(_.each(e.mapping,function(a){c[a.mappedName]=""}),d=0;d<g.length;d++){var h=g[d].name,i=e.mapping[h],j="undefined"!=typeof i?i.mappedName:e.removeOws?h.split("ows_")[1]:h,k="undefined"!=typeof i?i.objectType:void 0;(e.includeAllAttrs||void 0!==i)&&(c[j]=a(g[d].value,k))}f.push(c)}),f};return{attrToJson:a,dateWithinRange:w,fromCamelCase:p,lookupToJsonObject:j,SplitIndex:n,stringifySharePointDate:t,stringifySharePointMultiSelect:u,toCamelCase:o,xmlToJson:x}}),angular.module("angularPoint").service("apUserModel",["$q","apDataService","apConfig",function(a,b,c){var d={};return d._getUserProfile=function(){var d=a.defer();return b.serviceWrapper({operation:"GetUserProfileByName"}).then(function(a){var b={};$(a).SPFilterNode("PropertyData").each(function(){var a=$(this).SPFilterNode("Name"),c=$(this).SPFilterNode("Value");a.length>0&&c.length>0&&(b[a.text().trim()]=c.text().trim())}),b.userLoginName=c.userLoginNamePrefix?c.userLoginNamePrefix+b.AccountName:b.AccountName,d.resolve(b)}),d.promise},d.getUserProfile=d._getUserProfile(),d._getGroupCollection=function(){var c=a.defer();return d.getUserProfile.then(function(a){b.serviceWrapper({operation:"GetGroupCollectionFromUser",userLoginName:a.userLoginName,filterNode:"Group"}).then(function(a){c.resolve(a)})}),c.promise},d.getGroupCollection=d._getGroupCollection(),d.checkIfMember=function(b){var c=a.defer(),e=this;return d.getGroupCollection.then(function(a){e.groupMap&&e.groupMap.length===a.length||(e.groupMap=[],_.each(a,function(a){e.groupMap.push(a.Name)})),c.resolve(_.isObject(a[e.groupMap.indexOf(b)]))}),c.promise},d}]),angular.module("angularPoint").directive("apAttachments",["$sce","toastr",function(a,b){return{restrict:"A",replace:!0,templateUrl:"src/directives/ap_attachments/ap_attachments_tmpl.html",scope:{listItem:"=",changeEvent:"="},link:function(c,d){function e(){_.isFunction(c.changeEvent)&&c.changeEvent(),d.find("iframe").attr("src",d.find("iframe").attr("src"))}c.attachments=[],c.state={ready:!1},c.refresh=function(){c.$$phase||c.$apply()};var f=c.listItem.getModel(),g=f.list.webURL+"/_layouts/Attachfile.aspx?ListId="+f.list.guid+"&ItemId="+c.listItem.id+"&IsDlg=1";c.trustedUrl=a.trustAsResourceUrl(g);var h=function(){b.info("Checking for attachments"),c.listItem.getAttachmentCollection().then(function(a){c.attachments.length=0,Array.prototype.push.apply(c.attachments,a)})};h(),c.fileName=function(a){var b=a.lastIndexOf("/")+1;return a.substr(b)},c.deleteAttachment=function(a){var d=window.confirm("Are you sure you want to delete this file?");d&&(b.info("Negotiating with the server"),c.listItem.deleteAttachment(a).then(function(){b.success("Attachment successfully deleted"),h(),_.isFunction(c.changeEvent)&&c.changeEvent()}))},d.find("iframe").bind("load",function(){c.state.ready=!0,c.refresh();var a=$(this).contents();a.find("#CancelButton").length<1?(b.success("File successfully uploaded"),e(),h(),_.isFunction(c.changeEvent)&&c.changeEvent()):(a.find("#CancelButton").hide(),a.find(".ms-dialog").css({height:"95px"}),a.find("input[name$='Ok']").css({"float":"left"}).click(function(){b.info("Please wait while the file is uploaded")}),a.find("input[name$='$InputFile']").attr({size:40}),a.find("#s4-workspace").css({"overflow-y":"hidden","overflow-x":"hidden"}),console.log("Frame Loaded"))})}}}]),angular.module("angularPoint").directive("apSelect",function(){return{restrict:"A",replace:!0,templateUrl:"src/directives/ap_select/ap_select_tmpl.html",scope:{target:"=",bindedField:"=",multi:"=",arr:"=",lookupValue:"=",ngDisabled:"="},link:function(a){a.bindedField&&!a.target&&(a.target=a.bindedField),a.state={multiSelectIDs:[],singleSelectID:""},a.state.lookupField=a.lookupValue||"title";var b=function(b){var c=parseInt(b,10),d=_.findWhere(a.arr,{id:c});return{lookupId:c,lookupValue:d[a.state.lookupField]}};a.generateDisplayText=function(b){return _.isFunction(a.state.lookupField)?a.state.lookupField(b):_.isString(a.state.lookupField)?b[a.state.lookupField]:b.title},a.updateMultiModel=function(){_.isArray(a.target)||(a.target=[]),a.target.length=0,_.each(a.state.multiSelectIDs,function(c){a.target.push(b(c))})},a.updateSingleModel=function(){a.target=b(a.state.singleSelectID)},a.$watch("target",function(){a.multi?_.each(a.target,function(b){a.state.multiSelectIDs.push(b.lookupId.toString())}):_.isObject(a.target)&&a.target.lookupId&&(a.state.singleSelectID=a.target.lookupId)})}}}),angular.module("angularPoint").run(["$templateCache",function(a){a.put("src/directives/ap_attachments/oa_attachments_tmpl.html",'<div style="min-height: 200px;">\n\n    <div class="row">\n        <div class="col-xs-12">\n            <div ng-hide="state.ready" class="alert alert-info">Loading attachment details</div>\n            <div style="height: 110px;" ng-show="state.ready">\n                <h4>\n                    <small>Add Attachment</small>\n                </h4>\n                <iframe frameborder="0" seamless="seamless" width="100%" src="{{ trustedUrl }}"\n                        scrolling="no" style="height: 95px"></iframe>\n            </div>\n        </div>\n    </div>\n\n    <h4 ng-show="attachments.length > 0">\n        <small>Attachments</small>\n    </h4>\n\n    <ul class="list-unstyled">\n        <li ng-repeat="attachment in attachments">\n            <a href="{{ attachment }}" target="_blank">{{ fileName(attachment) }}</a>\n            <button class="btn btn-link" ng-click="deleteAttachment(attachment)" title="Delete this attachment">\n                <i class="fa fa-times red"></i>\n            </button>\n        </li>\n    </ul>\n\n</div>'),a.put("src/directives/ap_comments/ap_comments_tmpl.html",'<div>\n    <div class="pull-right">\n        <button class="btn btn-primary btn-xs" ng-click="createNewComment()"\n                title="Create a new comment"\n                ng-show="state.tempComment.length > 0">Save\n        </button>\n        <button class="btn btn-default btn-xs" ng-click="clearTempVars()"\n                title="Cancel comment"\n                ng-show="state.tempComment.length > 0">Cancel\n        </button>\n        <!--<button class="btn btn-link btn-xs" title="Toggle the new comment form"-->\n        <!--ng-click="state.newCommentVisible = !state.newCommentVisible">-->\n        <!--<i class="fa fa-comment"></i> Create-->\n        <!--</button>-->\n    </div>\n    <div style="min-height: 150px;">\n        <div class="newComment">\n            <div class="form-group">\n                <h4><small>New Comment</small></h4>\n                <textarea class="form-control" rows="2" ng-model="state.tempComment" placeholder="Create a new comment..."></textarea>\n            </div>\n        </div>\n        <div class="alert text-center" style="margin-top: 30px;" ng-show="!state.ready">\n            <h4><small>loading...</small></h4>\n        </div>\n        <div class="grey" style="margin-top: 30px;" ng-show="!comments && !state.newCommentVisible && state.ready">\n            No comments have been made. Create one using the input box above.\n        </div>\n        <div ng-if="comments && comments.thread.length > 0" class="comments-container">\n            <span ng-include="\'src/directives/ap_comments/ap_recursive_comment.html\'"\n                  ng-init="comment = comments;"></span>\n        </div>\n    </div>\n</div>'),a.put("src/directives/ap_comments/ap_recursive_comment.html",'<ul class="comments">\n    <li class="comment" ng-repeat="response in comment.thread" style="border-top-width: 1px;border-top-color: grey">\n        <div class="comment-content">\n            <div class="content">\n                <h5>\n                    <small>\n                        <span class="author">{{ response.author.lookupValue }}</span>\n                        <span>{{ response.modified  | date:\'short\' }}</span>\n                        <button class="btn btn-link btn-xs" ng-click="state.respondingTo = response"><i\n                                class="fa fa-mail-reply"></i> Reply\n                        </button>\n                        <button class="btn btn-link btn-xs"\n                                ng-click="deleteComment(response)"><i\n                                class="fa fa-trash-o"></i> Delete\n                        </button>\n                    </small>\n                </h5>\n                <p class="comment-text">{{ response.comment }}</p>\n            </div>\n        </div>\n        <div ng-if="state.respondingTo === response">\n            <div class="row">\n                <div class="col-xs-12">\n                    <form>\n                        <div class="form-group">\n                            <h5>\n                                <small>\n                                    Response\n                                    <label class="pull-right">\n                                        <button class="btn btn-link btn-xs"\n                                                ng-click="createResponse(response)"><i\n                                                class="fa fa-save"></i> Save\n                                        </button>\n                                        <button class="btn btn-link btn-xs"\n                                                ng-click="clearTempVars()"><i class="fa fa-undo"></i> Cancel\n                                        </button>\n                                    </label>\n                                </small>\n                            </h5>\n                            <textarea class="form-control" rows="2"\n                                      ng-model="state.tempResponse"></textarea>\n                        </div>\n                    </form>\n                </div>\n            </div>\n        </div>\n        <div ng-if="response.thread.length !== -1">\n            <span ng-include="\'src/directives/ap_comments/ap_recursive_comment.html\'"\n                  ng-init="comment = response;"></span>\n        </div>\n    </li>\n</ul>'),a.put("src/directives/ap_select/ap_select_tmpl.html",'<span class="ng-cloak">\n   <span ng-if="!multi">\n       <select class="form-control" ng-model="state.singleSelectID"\n               ng-change="updateSingleModel()" style="width: 100%" ng-disabled="ngDisabled"\n               ng-options="lookup.id as lookup[state.lookupField] for lookup in arr">\n       </select>\n   </span>\n   <span ng-if="multi">\n       <select multiple ui-select2 ng-model="state.multiSelectIDs"\n               ng-change="updateMultiModel()" style="width: 100%;" ng-disabled="ngDisabled">\n           <option></option>\n           <option ng-repeat="lookup in arr" value="{{ lookup.id }}"\n                   ng-bind="lookup[state.lookupField]">&nbsp;</option>\n       </select>\n   </span>\n</span>\n'),a.put("src/views/generate_offline_view.html",'<div class="container">\n    <h3>Offline XML Generator</h3>\n    <p>Fill in the basic information for a list and make the request to SharePoint.  The xml\n        response will appear at the bottom of the page where you can then copy by Ctrl + A.</p>\n    <hr/>\n    <form role="form">\n        <div class="form-group">\n            <label>Site URL</label>\n            <div class="input-group">\n                <input type="url" class="form-control" ng-model="state.siteUrl">\n                  <span class="input-group-btn">\n                    <button title="Refresh list/libraries" class="btn btn-success btn-sm"\n                            type="button" ng-click="getLists()">\n                        <i class="fa fa-refresh"></i> </button>\n                  </span>\n            </div>\n        </div>\n        <div class="row">\n            <div class="col-xs-6">\n                <div class="form-group">\n                    <label>List Name or GUID</label>\n                    <select ng-model="state.selectedList"\n                            ng-options="list.Title for list in listCollection"\n                            class="form-control"></select>\n                </div>\n            </div>\n            <div class="col-xs-6">\n                <div class="form-group">\n                    <label>Number of Items to Return (Optional) [0 = All Items]</label>\n                    <input type="number" class="form-control" ng-model="state.itemLimit"/>\n                </div>\n            </div>\n        </div>\n        <div class="row">\n            <div class="col-xs-12">\n                <div class="form-group">\n                    <label>Selected Fields</label>\n                    <select multiple ui-select2 ng-model="state.selectedListFields"\n                            style="width: 100%;"\n                            ng-disabled="listCollection.length < 1">\n                        <option ng-repeat="field in state.availableListFields"\n                                value="{{field.Name}}">{{ field.Name }}</option>\n                    </select>\n                </div>\n            </div>\n        </div>\n        <div class="form-group">\n            <label>CAML Query (Optional)</label>\n            <textarea  class="form-control" ng-model="state.query" rows="3"></textarea>\n        </div>\n        <br/>\n        <button type="submit" class="btn btn-primary" ng-click="getXML()">Make Request</button>\n        <hr/>\n        <h4>XML Response</h4>\n        <ol>\n            <li>Create a new offline file under "app/dev" in angularPoint.</li>\n            <li>Use the same name as found in the model at "model.list.title" + .xml</li>\n            <li>Select the returned XML below (Ctrl+A)</li>\n            <li>Add the XML to the newly created offline .xml file.</li>\n        </ol>\n        <div class="well well-sm">\n            <textarea name="xmlResponse" class="form-control" cols="30" rows="10"\n                      ng-model="state.xmlResponse"></textarea>\n        </div>\n    </form>\n</div>'),a.put("src/views/group_manager_view.html",'<style type="text/css">\n    select.multiselect {\n        min-height: 400px;\n    }\n\n    .ui-match {\n        background: yellow;\n    }\n</style>\n\n\n<div class="container">\n<ul class="nav nav-tabs">\n    <li ng-class="{active: state.activeTab === \'Users\'}">\n        <a href ng-click="updateTab(\'Users\')">Users</a>\n    </li>\n    <li ng-class="{active: state.activeTab === \'Groups\'}">\n        <a href ng-click="updateTab(\'Groups\')">Groups</a>\n    </li>\n    <li ng-class="{active: state.activeTab === \'Merge\'}">\n        <a href ng-click="state.activeTab = \'Merge\'">Merge</a>\n    </li>\n    <li ng-class="{active: state.activeTab === \'UserList\'}">\n        <a href ng-click="state.activeTab = \'UserList\'">User List</a>\n    </li>\n    <li ng-class="{active: state.activeTab === \'GroupList\'}">\n        <a href ng-click="state.activeTab = \'GroupList\'">Group List</a>\n    </li>\n</ul>\n\n<div ng-if="state.activeTab === \'Users\'">\n    <div class="panel panel-default">\n        <div class="panel-heading">\n            <div class="row">\n                <div class="col-xs-5">\n                    <span style="font-weight:bold">Select a Group:</span>\n                    <select class="form-control" ng-model="users.filter"\n                            ng-options="group.Name for group in groups.all"\n                            ng-change="updateAvailableUsers(users.filter)" style="min-width: 100px;"></select>\n                </div>\n                <div class="col-xs-7">\n                    <span style="font-weight:bold">Site/Site Collection: </span>\n                    <input class="form-control" ng-model="state.siteUrl" ng-change="updateAvailableUsers(users.filter)">\n                </div>\n            </div>\n            <div class="row" ng-if="users.filter.Description">\n                <div class="col-xs-12">\n                    <p class="help-block">Description: {{ users.filter.Description }}</p>\n                </div>\n            </div>\n        </div>\n        <div class="panel-body">\n            <div class="row">\n                <div class="col-xs-12">\n                    <div colspan="3" class="description">This tab will allow you to quickly assign multiple users to a selected group.</div>\n                </div>\n            </div>\n            <hr class="hr-sm">\n            <div class="row">\n                <div class="col-xs-5">\n                    <div class="form-group">\n                        <label>Available Users ({{users.available.length}})</label>\n                        <select ng-model="users.selectedAvailable"\n                                ng-options="user.Name for user in users.available"\n                                multiple="multiple" class="multiselect form-control"></select>\n                    </div>\n                </div>\n                <div class="col-xs-2 text-center" style="padding-top: 175px">\n                    <button class="btn btn-default" style="width:80px;"\n                            ng-click="updatePermissions(\'AddUserToGroup\', users.selectedAvailable, [users.filter])" title="Add user">\n                        <i class="fa fa-2x fa-angle-double-right"></i>\n                    </button>\n                    <br/><br/>\n                    <button class="btn btn-default" style="width:80px;"\n                            ng-click="updatePermissions(\'RemoveUserFromGroup\', users.selectedAssigned, [users.filter])">\n                        <i class="fa fa-2x fa-angle-double-left"></i>\n                    </button>\n                </div>\n                <div class="col-xs-5">\n                    <div class="form-group">\n                        <label>Assigned Users ({{users.assigned.length}})</label>\n                        <select ng-model="users.selectedAssigned"\n                                ng-options="user.Name for user in users.assigned"\n                                multiple="multiple" class="multiselect form-control"></select>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n\n<div ng-if="state.activeTab === \'Groups\'">\n    <div class="panel panel-default">\n        <div class="panel-heading">\n            <div class="row">\n                <div class="col-xs-5">\n                    <span style="font-weight:bold">Select a User:</span>\n                    <select class="form-control" ng-model="groups.filter"\n                            ng-options="user.Name for user in users.all"\n                            ng-change="updateAvailableGroups(groups.filter)" style="min-width: 100px;"></select>\n                </div>\n                <div class="col-xs-7">\n                    <span style="font-weight:bold">Site/Site Collection: </span>\n                    <input class="form-control" ng-model="state.siteUrl" ng-change="updateAvailableGroups(groups.filter)">\n                </div>\n            </div>\n        </div>\n        <div class="panel-body">\n            <div class="row">\n                <div class="col-xs-12">\n                    <div colspan="3" class="description">This page was created to make the process of managing users/groups within the site\n                        collection more manageable.  When a user is selected, the available groups are displayed on the\n                        left and the groups that the user is currently a member of will show on the right. Selecting\n                        multiple groups is supported.</div>\n                </div>\n            </div>\n            <hr class="hr-sm">\n            <div class="row">\n                <div class="col-xs-5">\n                    <div class="form-group">\n                        <label>Available Groups ({{groups.available.length}})</label>\n                        <select ng-model="groups.selectedAvailable"\n                                ng-options="group.Name for group in groups.available"\n                                multiple="multiple" class="multiselect form-control"></select>\n                    </div>\n                </div>\n                <div class="col-xs-2 text-center" style="padding-top: 175px">\n                    <button class="btn btn-default" style="width:80px;"\n                            ng-click="updatePermissions(\'AddUserToGroup\', [groups.filter], groups.selectedAvailable)" title="Add to group">\n                        <i class="fa fa-2x fa-angle-double-right"></i>\n                    </button>\n                    <br/><br/>\n                    <button class="btn btn-default" style="width:80px;"\n                            ng-click="updatePermissions(\'RemoveUserFromGroup\', [groups.filter], groups.selectedAssigned)">\n                        <i class="fa fa-2x fa-angle-double-left"></i>\n                    </button>\n                </div>\n                <div class="col-xs-5">\n                    <div class="form-group">\n                        <label>Assigned Users ({{users.assigned.length}})</label>\n                        <select ng-model="groups.selectedAssigned"\n                                ng-options="group.Name for group in groups.assigned"\n                                multiple="multiple" class="multiselect form-control"></select>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n\n<div ng-if="state.activeTab === \'Merge\'">\n    <div class="panel panel-default">\n        <div class="panel-body">\n            <div class="row">\n                <div class="col-xs-12">\n                    <div class="description">This tab allows us to copy the members from the "Source" group over to\n                        the "Target" group.\n                        It\'s not a problem if any of the users already exist in the destination group. Note: This is\n                        a onetime operation\n                        so any additional members added to the Source group will not automatically be added to the\n                        destination group. You will\n                        need to repeat this process.\n                    </div>\n                </div>\n            </div>\n            <hr class="hr-sm">\n            <div class="row">\n                <div class="col-xs-5">\n                    <fieldset>\n                        <legend>Step 1</legend>\n                        <div class="well">\n                            <div class="form-group">\n                                <label>Source Group</label>\n                                <select class="form-control" ng-model="state.sourceGroup"\n                                        ng-options="group.Name for group in groups.all"\n                                        ng-change="updateAvailableUsers(state.sourceGroup)"\n                                        style="min-width: 100px;"></select>\n                            </div>\n                        </div>\n                    </fieldset>\n                </div>\n                <div class="col-xs-5">\n                    <fieldset>\n                        <legend>Step 2</legend>\n\n                        <div class="well">\n                            <div class="form-group">\n                                <label>Source Group</label>\n                                <select class="form-control" ng-model="state.targetGroup"\n                                        ng-options="group.Name for group in groups.all"\n                                        style="min-width: 100px;"></select>\n                            </div>\n                        </div>\n                    </fieldset>\n                </div>\n                <div class="col-xs-2">\n                    <fieldset>\n                        <legend>Step 3</legend>\n                        <button class="btn btn-success"\n                                ng-disabled="state.sourceGroup.length < 1 || state.targetGroup.length < 1"\n                                ng-click="mergeGroups()"\n                                title="Copy all members from the source group over to the destination group.">\n                            <i class="fa fa-2x fa-magic"></i> Merge\n                        </button>\n                    </fieldset>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n<div ng-if="state.activeTab === \'UserList\'">\n    <div class="panel panel-default">\n        <div class="panel-heading">\n            <span style="font-weight:bold">User Filter</span>\n            <input type="text" class="form-control" ng-model="state.userFilter"\n                   ng-change="usersTable.reload()">\n        </div>\n        <table ng-table="usersTable" class="table" template-pagination="custom/pager">\n            <tr ng-repeat="user in $data">\n                <td data-title="\'ID\'"> {{ user.ID }}</td>\n                <td data-title="\'Name\'">\n                    <a href ng-click="userDetailsLink(user)"\n                       ng-bind-html="user.Name |  highlight:state.userFilter"></a>\n                </td>\n                <td data-title="\'Email\'"> {{ user.Email }}</td>\n            </tr>\n\n        </table>\n    </div>\n</div>\n<div ng-if="state.activeTab === \'GroupList\'">\n    <div class="panel panel-default">\n        <div class="panel-heading">\n            <span style="font-weight:bold">Group Filter</span>\n            <input type="text" class="form-control" ng-model="state.groupFilter"\n                   ng-change="groupsTable.reload()">\n        </div>\n        <table ng-table="groupsTable" class="table" template-pagination="custom/pager">\n            <tr ng-repeat="group in $data">\n                <td data-title="\'ID\'"> {{ group.ID }}</td>\n                <td data-title="\'Name\'">\n                    <a href ng-click="groupDetailsLink(group)"\n                       ng-bind-html="group.Name |  highlight:state.groupFilter"></a>\n                </td>\n                <td data-title="\'Description\'"> {{ group.Description }}</td>\n            </tr>\n        </table>\n    </div>\n</div>\n</div>\n\n<script type="text/ng-template" id="custom/pager">\n    <div class="row">\n        <div class="col-xs-12">\n            <ul class="pager ng-cloak">\n                <li ng-repeat="page in pages"\n                    ng-class="{\'disabled\': !page.active}"\n                    ng-show="page.type == \'prev\' || page.type == \'next\'" ng-switch="page.type">\n                    <a ng-switch-when="prev" ng-click="params.page(page.number)" href="">\n                        <i class="fa fa-chevron-left"></i>\n                    </a>\n                    <a ng-switch-when="next" ng-click="params.page(page.number)" href="">\n                        <i class="fa fa-chevron-right"></i>\n                    </a>\n                </li>\n            </ul>\n        </div>\n    </div>\n</script>')
}]);