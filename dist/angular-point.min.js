"use strict";try{angular.module("toastr")}catch(e){angular.module("toastr",[]).factory("toastr",["$log",function(a){return{error:a.error,info:a.info,success:a.info,warning:a.warn}}])}angular.module("angularPoint",["toastr"]).constant("apConfig",{appTitle:"Angular-Point",debugEnabled:!0,firebaseURL:"The optional url of your firebase source",offline:window.location.href.indexOf("localhost")>-1||window.location.href.indexOf("http://0.")>-1||window.location.href.indexOf("http://10.")>-1||window.location.href.indexOf("http://192.")>-1}).run(function(){}),angular.module("angularPoint").service("apCacheService",["$q","$log",function(a,b){var c={},d={},e={},f=function(a){a.list&&a.list.guid&&a.list.title&&(d[a.list.title]={model:a,entityType:h(a.list.guid)})},g=function(a){return d[a]&&d[a].entityType?d[a].entityType:void b.error("The requested list name isn't valid: ",a)},h=function(a){return _.isGuid(a)?a.toLowerCase():g(a)},i=function(a,b){var c=this;c.associationQueue=[],c.updateCount=0,c.entityType=h(a),c.entityId=b};i.prototype.getEntity=function(){var b=this,c=a.defer();return b.entity?c.resolve(b.entity):b.associationQueue.push(c),c.promise};var j=function(a,b){var c=m(a,b);return c.getEntity()};i.prototype.addEntity=function(a){var b=this;return b.entity=a,b.updateCount++,b.entity.age=new Date,_.each(b.associationQueue,function(c){c.resolve(a),b.associationQueue.shift()}),b.entity};var k=function(a){var b=a.getModel().list.guid,c=m(b,a.id);return c.addEntity(a)};i.prototype.removeEntity=function(){delete e[this.entityType][this.entityId]};var l=function(a,b){var c=m(a,b);c.removeEntity()},m=function(a,b){var c=h(a);return e[c]&&e[c][b]||(e[c]=e[c]||{},e[c][b]=new i(c,b)),e[c][b]},n=function(a,b,c){var d=o(a,b);return d[b]=c,d[b]},o=function(a,b){return c[a]=c[a]||{},c[a][b]=c[a][b]||{},c[a][b]},p=function(a,b,c){var d=o(a,b);d&&d[b]&&d[b][c.id]&&delete d[b][c.id]};return{getEntity:j,removeEntity:l,listItem:{add:n,get:o,remove:p},registerEntity:k,registerModel:f}}]),angular.module("angularPoint").service("apDataService",["$q","$timeout","apQueueService","apConfig","apUtilityService","apDecodeService","apEncodeService","apFieldService","toastr",function(a,b,c,d,e,f,g,h,i){function j(a,b){var c=!1,d=_.findWhere(a,{id:b}),e=_.indexOf(a,d);return e&&(a.splice(e,1),c=!0),c}function k(a){return $(a).find("Changes").attr("LastChangeToken")}function l(a){return $(a).find("listitems").attr("EffectivePermMask")}function m(a,b){var c=0;$(a).SPFilterNode("Id").each(function(){var a=$(this).attr("ChangeType");if("Delete"===a){var d=parseInt($(this).text(),10),e=j(b,d);e&&c++}}),c>0&&p&&console.log(c+" item(s) removed from local cache to mirror changes on source list.")}function n(a,b,c){var d=0;return _.each(a.queries,function(a){a!=c&&f.updateLocalCache(a.cache,[b])}),d}var o={},p=d.offline,q=!p,r=function(c,d){var e=a.defer();if(q){var g=$().SPServices(c);g.then(function(){var a=f.parseFieldVersions(g.responseText,d);e.resolve(a)},function(a){i.error("Failed to fetch version history."),e.reject(a)})}else b(function(){e.resolve([])});return e.promise},s=function(b){c.increase();var d={},e=_.extend({},d,b),f=e.filterNode||e.operation.split("Get")[1].split("Collection")[0],g=a.defer(),h=function(a){var b=[];return"GetAttachmentCollection"===e.operation?$(a).SPFilterNode(f).each(function(){b.push($(this).text())}):b=$(a).SPFilterNode(f).SPXmlToJson({includeAllAttrs:!0,removeOws:!1}),b};if(p){var j="dev/"+e.operation+".xml";$.ajax(j).then(function(a){c.decrease(),g.resolve(h(a))},function(a){i.error("You need to have a dev/"+e.operation+".xml in order to get the group collection in offline mode."),g.reject(a),c.decrease()})}else{var k=!0,l={};_.extend(l,e);var m=function(a){_.each(a,function(a){l[a]||(i.error("options"+a+" is required to complete this operation"),k=!1,g.reject([]))})};switch(e.operation){case"GetGroupCollectionFromUser":m(["userLoginName"]);break;case"GetUserCollectionFromGroup":m(["groupName"]);break;case"GetViewCollection":m(["listName"]);break;case"GetAttachmentCollection":m(["listName","ID"])}if(k){var n=$().SPServices(l);n.then(function(){c.decrease(),g.resolve(h(n.responseXML))},function(a){i.error("Failed to fetch list collection."),c.decrease(),g.reject(a)})}}return g.promise},t=function(b){var d={},e=_.extend({},d,b),f=a.defer();c.increase();var g=function(a){return e.filterNode?$(a).SPFilterNode(e.filterNode).SPXmlToJson({includeAllAttrs:!0,removeOws:!1}):a};if(q){var h={};_.extend(h,e);var j=$().SPServices(h);j.then(function(){c.decrease(),f.resolve(g(j.responseXML))},function(a){i.error("Failed to fetch list collection."),c.decrease(),f.reject(a)})}else{var k="dev/"+e.operation+".xml";$.ajax(k).then(function(a){c.decrease(),f.resolve(g(a))},function(a){i.error("You need to have a dev/"+e.operation+".xml in order to get the group collection in offline mode."),f.reject(a),c.decrease()})}return f.promise},u=function(b){var d=_.extend({},b);c.increase();var e=a.defer(),f=$().SPServices({operation:"GetList",listName:d.listName});return f.then(function(){c.decrease();var a=$(f.responseXML).SPFilterNode("Field").SPXmlToJson({includeAllAttrs:!0,removeOws:!1});e.resolve(a)},function(a){e.reject(a),i.error("Failed to fetch list details.")}).always(function(){c.decrease()}),e.promise},v=function(b){var d={operation:"DeleteAttachment"},e=_.extend({},d,b);c.increase();var f=a.defer(),g=$().SPServices({operation:"DeleteAttachment",listItemID:e.listItemId,url:e.url,listName:e.listName});return g.then(function(){c.decrease();var a=$(g.responseXML).SPFilterNode("Field").SPXmlToJson({includeAllAttrs:!0,removeOws:!1});f.resolve(a)},function(a){f.reject(a),i.error("Failed to fetch list details.")}).always(function(){c.decrease()}),f.promise},w=function(b){var d=_.extend({},b),e=a.defer();c.increase();var f={operation:"GetView",listName:d.listName};d.viewName&&(f.viewName=d.viewName);var g=$().SPServices(f);return g.then(function(){var a={query:"<Query>"+$(g.responseText).find("Query").html()+"</Query>",viewFields:"<ViewFields>"+$(g.responseText).find("ViewFields").html()+"</ViewFields>",rowLimit:$(g.responseText).find("RowLimit").html()};e.resolve(a)},function(a){i.error("Failed to fetch view details."),e.reject(a)}).always(function(){c.decrease()}),e.promise},x=function(b,d,e){var g={target:b.getCache()},h=a.defer(),j=_.extend({},g,e);if(j.getQuery=function(){return d},c.increase(),q){var n=$().SPServices(d);n.then(function(){var a=n.responseXML;if("GetListItemChangesSinceToken"===d.operation){b.list.extendedFieldDefinitions||(b.list.extendedFieldDefinitions=f.parseFieldDefinitionXML(b.list.customFields,a)),d.changeToken=k(a);var e=l(a);e&&(b.list.effectivePermMask=e),m(a,j.target)}f.processListItems(b,a,j).then(function(a){d.lastRun=new Date,c.decrease(),h.resolve(a)})})}else{var o=j.offlineXML||d.offlineXML||"dev/"+b.list.title+".xml";d.lastRun?(d.lastRun=new Date,c.decrease(),h.resolve(d.cache)):$.ajax(o).then(function(a){f.processListItems(b,a,j).then(function(e){d.lastRun=new Date,c.decrease(),"GetListItemChangesSinceToken"===d.operation&&(b.list.extendedFieldDefinitions=f.parseFieldDefinitionXML(b.list.customFields,a)),h.resolve(e)})},function(){var a=b.generateMockData();h.resolve(a),i.error('There was a problem locating the "dev/'+b.list.title+'.xml"')})}return h.promise},y=function(b,d,e){var h={mode:"update",buildValuePairs:!0,updateAllCaches:!1,valuePairs:[]},j=a.defer(),k=_.extend({},h,e);if(c.increase(),k.buildValuePairs===!0){var l=_.where(b.list.fields,{readOnly:!1});k.valuePairs=g.generateValuePairs(l,d)}var m={operation:"UpdateListItems",webURL:b.list.webURL,listName:b.list.guid,valuepairs:k.valuePairs};if(_.isObject(d)&&_.isNumber(d.id)?(m.batchCmd="Update",m.ID=d.id):m.batchCmd="New",q){var o=$().SPServices(m);o.then(function(){f.processListItems(b,o.responseXML,k).then(function(a){var c=a[0];k.updateAllCaches&&_.isNumber(d.id)&&n(b,c,d.getQuery()),j.resolve(c)})},function(a){i.error("There was an error getting the requested data from "+b.list.name),j.reject(a)}).always(function(){c.decrease()})}else{window.console.log(m);var p={modified:new Date,editor:{lookupId:23,lookupValue:"Generic User"}};if(d.id)_.extend(d,p),j.resolve(d);else{var r;p.author={lookupId:23,lookupValue:"Generic User"},p.created=new Date,_.each(b.queries,function(a){var c=1;_.each(a.cache,function(a){a.id>c&&(c=a.id)}),p.id=c+1,_.extend(d,p),r=new b.factory(d),a.cache.push(r)}),j.resolve(r)}c.decrease()}return j.promise},z=function(b,d,e){function f(){var a=0;if(h.updateAllCaches){var b=d.getModel();_.each(b.queries,function(b){var c=j(b.cache,d.id);c&&a++})}else{var c=j(h.target,d.id);c&&a++}return a}c.increase();var g={target:d.getContainer(),updateAllCaches:!1},h=_.extend({},g,e),k={operation:"UpdateListItems",webURL:b.list.webURL,listName:b.list.guid,batchCmd:"Delete",ID:d.id},l=a.defer();if(q){var m=$().SPServices(k);m.then(function(){f(),c.decrease(),l.resolve(h.target)},function(a){i.error("There was an error deleting a list item from "+b.list.title),c.decrease(),l.reject(a)})}else f(),c.decrease(),l.resolve(h.target);return l.promise};return _.extend(o,{addUpdateItemModel:y,deleteAttachment:v,deleteItemModel:z,getCollection:s,getFieldVersionHistory:r,getList:u,getView:w,executeQuery:x,serviceWrapper:t}),o}]),angular.module("angularPoint").service("apDecodeService",["$q","apUtilityService","apQueueService","apConfig","apCacheService",function(a,b,c,d,e){function f(a,b){var c=0,d=0,e=_.pluck(a,"id");return _.each(b,function(b){-1===e.indexOf(b.id)?(a.push(b),e.push(b.id),d++):(a[e.indexOf(b.id)]=b,c++)}),{created:d,updated:c}}function g(a,b,c){var d;switch(b){case"DateTime":case"datetime":d=n(a);break;case"Lookup":d=q(a,c);break;case"User":d=o(a);break;case"LookupMulti":d=r(a,c);break;case"UserMulti":d=p(a);break;case"Boolean":d=m(a);break;case"Integer":case"Counter":d=k(a);break;case"Currency":case"Number":case"Float":case"float":d=l(a);break;case"Calc":d=t(a);break;case"MultiChoice":d=s(a);break;case"HTML":d=i(a);break;case"JSON":d=h(a);break;default:d=j(a)}return d}function h(a){var b=null;try{b=JSON.parse(a)}catch(c){console.error("Invalid JSON: ",a)}return b}function i(a){return _.unescape(a)}function j(a){return a}function k(a){return parseInt(a,10)}function l(a){return parseFloat(a)}function m(a){return"0"===a||"False"===a?!1:!0}function n(a){return new Date(a.replace(/-/g,"/").replace(/T/i," "))}function o(a){return 0===a.length?null:new v(a)}function p(a){if(0===a.length)return null;for(var b=[],c=a.split(";#"),d=0;d<c.length;d+=2){var e=o(c[d]+";#"+c[d+1]);b.push(e)}return b}function q(a,b){return 0===a.length?null:new u(a,b)}function r(a,b){if(0===a.length)return[];for(var c=[],d=a.split(";#"),e=0;e<d.length;e+=2){var f=q(d[e]+";#"+d[e+1],b);c.push(f)}return c}function s(a){if(0===a.length)return[];for(var b=[],c=a.split(";#"),d=0;d<c.length;d++)0!==c[d].length&&b.push(c[d]);return b}function t(a){if(0===a.length)return null;var b=a.split(";#");return g(b[1],b[0])}function u(a,c){var d=this,e=new b.SplitIndex(a);d.lookupId=e.id,d.lookupValue=e.value,d._props=function(){return c}}function v(a){var c=this,d=new b.SplitIndex(a),e=d.value.split(",#");1===e.length?(c.lookupId=d.id,c.lookupValue=d.value):(c.lookupId=d.id,c.lookupValue=e[0].replace(/(,,)/g,","),c.loginName=e[1].replace(/(,,)/g,","),c.email=e[2].replace(/(,,)/g,","),c.sipAddress=e[3].replace(/(,,)/g,","),c.title=e[4].replace(/(,,)/g,","))}function w(a,b){var c=[],d=$(a).find("Version").length;return $(a).find("Version").each(function(a){var e=this,f={editor:g($(e).attr("Editor"),"User"),modified:g($(e).attr("Modified"),"DateTime"),version:d-a};f[b.mappedName]=g($(e).attr(b.internalName),b.objectType),c.unshift(f)}),c}var x=function(b,g,h){var i=a.defer(),j={ctor:function(a){a.getQuery=function(){return k.getQuery()},a.getContainer=function(){return k.target};var c=new b.factory(a);return e.registerEntity(c),c},factory:b.factory,filter:"z:row",mapping:b.list.mapping,mode:"update",target:b.getCache()},k=_.extend({},j,h),l=$(g).SPFilterNode(k.filter);return y(l,k).then(function(a){if("replace"===k.mode)k.target=a,d.offline&&console.log(b.list.title+" Replaced with "+k.target.length+" new records.");else if("update"===k.mode){var e=f(k.target,a);d.offline&&console.log(b.list.title+" Changes (Create: "+e.created+" | Update: "+e.updated+")")}c.decrease(),i.resolve(a)}),i.promise},y=function(c,d){var e,f={mapping:{},includeAllAttrs:!1,removeOws:!0,throttle:!0},h=a.defer(),i=_.extend({},f,d),j=[],k=function(a){var b={},c=a.attributes;for(_.each(i.mapping,function(a){b[a.mappedName]=""}),e=0;e<c.length;e++){var d=c[e].name,f=i.mapping[d],h="undefined"!=typeof f?f.mappedName:i.removeOws?d.split("ows_")[1]:d,k="undefined"!=typeof f?f.objectType:void 0;(i.includeAllAttrs||void 0!==f)&&(b[h]=g(c[e].value,k,{getQuery:i.getQuery,entity:b,propertyName:h}))}j.push(_.isFunction(i.ctor)?i.ctor(b):b)};return i.throttle?b.batchProcess(c,k,this,25).then(function(){h.resolve(j)}):(_.each(c,k),h.resolve(j)),h.promise};u.prototype.getEntity=function(){var b=this,c=b._props();if(!c.getEntity){var d=c.getQuery(),e=d.searchLocalCache(c.entity.id);c.getEntity=a.defer(),e.getLookupReference(c.propertyName,b.lookupId).then(function(a){c.getEntity.resolve(a)})}return c.getEntity.promise},u.prototype.getProperty=function(b){var c=this,d=a.defer();return c.getEntity().then(function(a){d.resolve(_.deepGetOwnValue(a,b))}),d.promise};var z=function(a,b){var c={};return _.each(a,function(a){a.internalName&&(c[a.internalName]=a)}),$(b).SPFilterNode("Field").each(function(){var a=this,b=$(a).attr("StaticName");if(c[b]){var d={},e=a.attributes;_.each(e,function(b,c){var f=e[c].name;d[f]=$(a).attr(f)}),("Choice"===c[b].objectType||"MultiChoice"===c[b].objectType)&&(d.choices=[],$(this).find("CHOICE").each(function(){d.choices.push($(this).text())}),d.Default=$(this).find("Default").text()),_.extend(c[b],d)}}),!0};return{attrToJson:g,lookupToJsonObject:q,parseFieldDefinitionXML:z,parseFieldVersions:w,processListItems:x,updateLocalCache:f,xmlToJson:y}}]),angular.module("angularPoint").service("apEncodeService",["apConfig","apUtilityService",function(a,b){function c(a){var b="",c=";#";return a.length>0&&(b+=c,_.each(a,function(a){b+=a+c})),b}function d(a,b){var c=[];return _.each(a,function(a){_.has(b,a.mappedName)&&c.push(h(a,b[a.mappedName]))}),c}function e(a){if(!_.isDate(a))return"";var c=this,d="";return d+=a.getFullYear(),d+="-",d+=b.doubleDigit(a.getMonth()+1),d+="-",d+=b.doubleDigit(a.getDate()),d+="T",d+=b.doubleDigit(a.getHours()),d+=":",d+=b.doubleDigit(a.getMinutes()),d+=":",d+=b.doubleDigit(a.getSeconds()),d+="Z-",c.timeZone||(window.console.log("Calculating"),c.timeZone=(new Date).getTimezoneOffset()/60),d+=b.doubleDigit(c.timeZone),d+=":00"}function f(a,b){var c="",d=b||"lookupId";return _.each(a,function(b,e){c+=b[d],e<a.length&&(c+=";#;#")}),c}var g=a.offline,h=function(a,b){var d=[],h=a.internalName;if(b&&""!==b){switch(a.objectType){case"Lookup":case"User":d=b.lookupId?[h,b.lookupId]:[h,""];break;case"LookupMulti":case"UserMulti":var i=f(b,"lookupId");d=[a.internalName,i];break;case"MultiChoice":d=[a.internalName,c(b)];break;case"Boolean":d=[h,b?1:0];break;case"DateTime":d=_.isDate(b)?[h,e(b)]:[h,""];break;case"Note":case"HTML":d=[h,_.escape(b)];break;case"JSON":d=[h,angular.toJson(b)];break;default:d=[h,b]}g&&console.log("{"+a.objectType+"} "+d)}else d=[h,""];return d};return{choiceMultiToString:c,createValuePair:h,generateValuePairs:d,stringifySharePointDate:e,stringifySharePointMultiSelect:f}}]),angular.module("angularPoint").service("apFieldService",["apUtilityService",function(a){function b(){return chance.bool()}function c(){return chance.word()+" "+chance.word()}function d(){return chance.paragraph()}function e(){return parseInt(100*_.random(1e7,!0))/100}function f(){return chance.date()}function g(){return chance.integer()}function h(a){var b;switch(a){case"AddListItems":b="0x0000000000000002";break;case"EditListItems":b="0x0000000000000004";break;case"DeleteListItems":b="0x0000000000000008";break;case"ApproveItems":b="0x0000000000000010";break;case"FullMask":b="0x7FFFFFFFFFFFFFFF";break;case"ViewListItems":default:b="0x0000000000000001"}return b}function i(a){var b="FullMask";return a&&a.permissionLevel&&(b=a.permissionLevel),h(b)}function j(){return{lookupId:s(),lookupValue:chance.word()}}function k(){return{lookupId:s(),lookupValue:chance.name()}}function l(){var a=[];return _.each(_.random(10),function(){a.push(j())}),a}function m(){var a=[];return _.each(_.random(10),function(){a.push(k())}),a}function n(b){var c=this,d={readOnly:!1,objectType:"Text"};_.extend(c,d,b),c.displayName=c.displayName||a.fromCamelCase(c.mappedName)}function o(a){return t[a]}function p(a){var b,c=o(a);return c&&(b=c.defaultValue),b}function q(a,b){var c,d=o(a);return d&&(c=!b||!b.staticValue&&_.isFunction(chance)?d.dynamicMock(b):d.staticMock),c}function r(a){var b=function(b){var c=new n(b);a.fields.push(c),a.viewFields+='<FieldRef Name="'+c.internalName+'"/>',a.mapping["ows_"+c.internalName]={mappedName:c.mappedName,objectType:c.objectType}};a.viewFields+="<ViewFields>",_.each(u,function(a){b(a)}),_.each(a.customFields,function(a){b(a)}),a.viewFields+="</ViewFields>"}var s=function(){var a=s;return a.count=a.count||0,a.count++,a.count};n.prototype.getDefinition=function(){return o(this.objectType)},n.prototype.getDefaultValueForType=function(){return p(this.objectType)},n.prototype.getMockData=function(a){return q(this.objectType,a)};var t={Text:{defaultValue:"",staticMock:"Test String",dynamicMock:c},TextLong:{defaultValue:"",staticMock:"This is a sentence.",dynamicMock:d},Boolean:{defaultValue:null,staticMock:!0,dynamicMock:b},Counter:{defaultValue:null,staticMock:s(),dynamicMock:s},Currency:{defaultValue:null,staticMock:120.5,dynamicMock:e},DateTime:{defaultValue:null,staticMock:new Date(2014,5,4,11,33,25),dynamicMock:f},Integer:{defaultValue:null,staticMock:14,dynamicMock:g},JSON:{defaultValue:"",staticMock:[{id:1,title:"test"},{id:2}],dynamicMock:c},Lookup:{defaultValue:"",staticMock:{lookupId:49,lookupValue:"Static Lookup"},dynamicMock:j},LookupMulti:{defaultValue:[],staticMock:[{lookupId:50,lookupValue:"Static Multi 1"},{lookupId:51,lookupValue:"Static Multi 2"}],dynamicMock:l},Mask:{defaultValue:i(),staticMock:i(),dynamicMock:i},User:{defaultValue:"",staticMock:{lookupId:52,lookupValue:"Static User"},dynamicMock:k},UserMulti:{defaultValue:[],staticMock:[{lookupId:53,lookupValue:"Static User 1"},{lookupId:54,lookupValue:"Static User 2"}],dynamicMock:m}},u=[{internalName:"ID",objectType:"Counter",mappedName:"id",readOnly:!0},{internalName:"Modified",objectType:"DateTime",mappedName:"modified",readOnly:!0},{internalName:"Created",objectType:"DateTime",mappedName:"created",readOnly:!0},{internalName:"Author",objectType:"User",mappedName:"author",readOnly:!0},{internalName:"Editor",objectType:"User",mappedName:"editor",readOnly:!0},{internalName:"PermMask",objectType:"Mask",mappedName:"permMask",readOnly:!0},{internalName:"UniqueId",objectType:"String",mappedName:"uniqueId",readOnly:!0}];return{defaultFields:u,extendFieldDefinitions:r,getDefaultValueForType:p,getMockData:q,getDefinition:o,mockPermMask:i,resolveValueForEffectivePermMask:h}}]),angular.module("angularPoint").service("apModalService",["$modal","toastr",function(a,b){function c(b){return function c(){var d=c,e={templateUrl:b.templateUrl,controller:b.controller,resolve:{}},f=_.extend({},e,b),g=arguments;_.each(b.expectedArguments,function(a,b){f.resolve[a]=function(){return g[b]}});var h=a.open(f);return g[0]&&(d.snapshot=angular.copy(g[0]),h.result.then(function(){},function(){_.extend(g[0],d.snapshot)})),h.result}}function d(a,b){function c(a){var b=a.resolvePermissions();d.userCanEdit=b.EditListItems,d.userCanDelete=b.DeleteListItems,d.userCanApprove=b.ApproveItems,d.fullControl=b.FullMask}var d={userCanApprove:!1,userCanDelete:!1,userCanEdit:!1,fullControl:!1};return a&&a.resolvePermissions?c(a):b&&b.resolvePermissions&&c(b),d}function e(a,b,c){var e={displayMode:"View",locked:!1,lockedBy:"",negotiatingWithServer:!1,ready:!1},f=d(a,c);return a&&a.id?f.userCanEdit&&(e.displayMode="Edit"):e.displayMode="New",_.extend(e,f,b)}function f(a,c,d){var e=window.confirm("Are you sure you want to delete this record?");e&&(c.negotiatingWithServer=!0,a.deleteItem().then(function(){b.success("Record deleted successfully"),d.close()},function(){b.error("Failed to delete record.  Please try again.")}))}function g(a,c,d,e){a.id?a.saveChanges().then(function(){b.success("Record updated"),e.close()},function(){b.error("There was a problem updating this record.  Please try again.")}):c.addNewItem(a).then(function(){b.success("New record created"),e.close()},function(){b.error("There was a problem creating a new record.  Please try again.")})}return{deleteEntity:f,initializeState:e,modalModelProvider:c,getPermissions:d,saveEntity:g}}]),angular.module("angularPoint").service("apQueueService",function(){var a=0,b=function(){return a++,g(),a},c=function(){return a>0?(a--,g(),a):void 0},d=function(){return a=0,g(),a},e=[],f=function(a){e.push(a)},g=function(){angular.forEach(e,function(b){b(a)})};return{count:a,decrease:c,increase:b,registerObserverCallback:f,reset:d}}),angular.module("angularPoint").service("apUtilityService",["$q","apConfig","$log",function(a,b,c){function d(a){return a>9?a.toString():"0"+a}function e(a){var b=a.getFullYear().toString(),c=(a.getMonth()+1).toString(),e=a.getDate().toString();return parseInt(b+d(c)+d(e))}function f(a,b,c){if(!a||!b)return!1;c=c||new Date;var d=e(a),f=e(b),g=e(c);return g>=d&&f>=g}function g(b,d,e,f,g){function h(){for(var a=+new Date,l=j;i>j&&g>j-l&&new Date-a<100;)d.call(e,b[j]),j+=1;i>j?(c.info("Batch Delayed"),setTimeout(h,f)):k.resolve(b)}var i=b.length,f=f||25,g=g||i,j=0,k=a.defer();return h(),k.promise}function h(a){var b={};return b.ViewListItems=(1&a)>0,b.AddListItems=(2&a)>0,b.EditListItems=(4&a)>0,b.DeleteListItems=(8&a)>0,b.ApproveItems=(16&a)>0,b.OpenItems=(32&a)>0,b.ViewVersions=(64&a)>0,b.DeleteVersions=(128&a)>0,b.CancelCheckout=(256&a)>0,b.PersonalViews=(512&a)>0,b.ManageLists=(2048&a)>0,b.ViewFormPages=(4096&a)>0,b.Open=(65536&a)>0,b.ViewPages=(131072&a)>0,b.AddAndCustomizePages=(262144&a)>0,b.ApplyThemeAndBorder=(524288&a)>0,b.ApplyStyleSheets=(1048576&a)>0,b.ViewUsageData=(2097152&a)>0,b.CreateSSCSite=(4194314&a)>0,b.ManageSubwebs=(8388608&a)>0,b.CreateGroups=(16777216&a)>0,b.ManagePermissions=(33554432&a)>0,b.BrowseDirectories=(67108864&a)>0,b.BrowseUserInfo=(134217728&a)>0,b.AddDelPrivateWebParts=(268435456&a)>0,b.UpdatePersonalWebParts=(536870912&a)>0,b.ManageWeb=(1073741824&a)>0,b.UseRemoteAPIs=(137438953472&a)>0,b.ManageAlerts=(274877906944&a)>0,b.CreateAlerts=(549755813888&a)>0,b.EditMyUserInfo=(1099511627776&a)>0,b.EnumeratePermissions=(0x4000000000000000&a)>0,b.FullMask=0x8000000000000000==a,b.FullMask&&_.each(b,function(a,c){b[c]=!0}),b}function i(a){return a.replace(/(?:^\w|[A-Z]|\b\w)/g,function(a,b){return 0==b?a.toLowerCase():a.toUpperCase()}).replace(/\s+/g,"")}function j(a){a.replace(/([A-Z])/g," $1").replace(/^./,function(a){return a.toUpperCase()})}function k(a){var b=a.split(";#");this.id=parseInt(b[0],10),this.value=b[1]}function l(a){!b.offline&&a.sync&&_.isFunction(a.sync.registerChange)&&a.sync.registerChange()}return _.mixin({isDefined:function(a){return!_.isUndefined(a)},isGuid:function(a){return"string"==typeof a&&/[a-fA-F\d]{8}-(?:[a-fA-F\d]{4}-){3}[a-fA-F\d]{12}/.test(a)}}),{batchProcess:g,dateWithinRange:f,doubleDigit:d,fromCamelCase:j,registerChange:l,resolvePermissions:h,SplitIndex:k,toCamelCase:i}}]),angular.module("angularPoint").factory("apListFactory",["apConfig","apFieldService",function(a,b){function c(c){var d={viewFields:"",customFields:[],isReady:!1,fields:[],guid:"",mapping:{},title:""};a.defaultUrl&&(d.webURL=a.defaultUrl);var e=_.extend({},d,c);return b.extendFieldDefinitions(e),e}var d=function(a){return new c(a)};return{create:d,List:c}}]),angular.module("angularPoint").factory("apListItemFactory",["$q","apCacheService","apDataService","apUtilityService",function(a,b,c,d){function e(){}e.prototype.getDataService=function(){return c},e.prototype.saveChanges=function(b){var e=this,f=e.getModel(),g=a.defer();return c.addUpdateItemModel(f,e,b).then(function(a){g.resolve(a),d.registerChange(f)}),g.promise},e.prototype.saveFields=function(b,e){var f=this,g=f.getModel(),h=a.defer(),i=[];_.each(b,function(a){var b=_.findWhere(g.list.customFields,{mappedName:a});b&&i.push(b)});var j=c.generateValuePairs(i,f),k={buildValuePairs:!1,valuePairs:j},l=_.extend({},k,e);return c.addUpdateItemModel(g,f,l).then(function(a){h.resolve(a),d.registerChange(g)}),h.promise},e.prototype.deleteItem=function(b){var e=this,f=e.getModel(),g=a.defer();return c.deleteItemModel(f,e,b).then(function(a){g.resolve(a),d.registerChange(f)}),g.promise},e.prototype.getLookupReference=function(c,d){var e=this,f=a.defer(),g=d||e[c].lookupId;if(c){var h=e.getModel(),i=h.getFieldDefinition(c);i&&i.List?b.getEntity(i.List,g).then(function(a){f.resolve(a)}):f.fail("Need a List GUID before we can find this in cache.")}else f.fail("Need both fieldName && lookupId params");return f.promise},e.prototype.validateEntity=function(a){var b=this,c=b.getModel();return c.validateEntity(b,a)},e.prototype.getFieldDefinition=function(a){return this.getModel().getFieldDefinition(a)},e.prototype.getAttachmentCollection=function(){return c.getCollection({operation:"GetAttachmentCollection",listName:this.getModel().list.guid,webURL:this.getModel().list.webURL,ID:this.id,filterNode:"Attachment"})},e.prototype.deleteAttachment=function(a){var b=this;return c.deleteAttachment({listItemId:b.id,url:a,listName:b.getModel().list.guid})},e.prototype.resolvePermissions=function(){return d.resolvePermissions(this.permMask)},e.prototype.getEntityReferenceCache=function(){return b.listItem.get(this.uniqueId)},e.prototype.addEntityReference=function(a){var c=this;if(a&&"ListItem"===a.constructor.name){var d=c.uniqueId,e=a.getModel().list.title;return b.listItem.add(d,e,a)}$log.warn("Please verify that a valid entity is being used: ",c,a)},e.prototype.getEntityReferences=function(a){var b=this,c=b.getEntityReferenceCache();return a&&!c[a]?{}:a&&c[a]?c[a]:c},e.prototype.removeEntityReference=function(a){var c=this.uniqueId,d=a.getModel().list.title;return b.listItem.remove(c,d,a)},e.prototype.getFieldVersionHistory=function(b){var d=a.defer(),e=[],f=this,g=f.getModel(),h=function(a){var b=_.findWhere(g.list.fields,{mappedName:a}),d={operation:"GetVersionCollection",strlistID:g.list.guid,strlistItemID:f.id,strFieldName:b.internalName};apConfig.defaultUrl&&(d.webURL=apConfig.defaultUrl),e.push(c.getFieldVersionHistory(d,b))};if(b)_.isString(b)&&(b=[b]);else{var i=_.where(g.list.fields,{readOnly:!1});b=[],_.each(i,function(a){b.push(a.mappedName)})}return _.each(b,function(a){h(a)}),a.all(e).then(function(a){var b={};_.each(a,function(a){_.each(a,function(a){b[a.modified.toJSON()]||(b[a.modified.toJSON()]={}),_.extend(b[a.modified.toJSON()],a)})});var c=[];_.each(b,function(a,b){a.version=b,c.push(a)}),d.resolve(c)}),d.promise};var f=function(a){var b=this;_.extend(b,a)},g=function(){return new e},h=function(){return new f};return{create:g,createGenericFactory:h,ListItem:e,StandardListItem:f}}]),angular.module("angularPoint").factory("apModelFactory",["apModalService","apCacheService","apDataService","apListFactory","apListItemFactory","apQueryFactory","apUtilityService","$q","toastr",function(a,b,c,d,e,f,g,h,i){function j(a){var c=this,f={data:[],factory:e.createGenericFactory(),lastServerUpdate:null,queries:{}};return _.extend(c,f,a),c.list=d.create(c.list),c.factory.prototype=e.create(),c.factory.prototype.getModel=function(){return c},b.registerModel(c),c.searchLocalCache=function(a,b){var d,e=c.searchLocalCache,f={propertyPath:"id",localCache:c.getCache(),cacheName:"main",rebuildIndex:!1},g=_.extend({},f,b);e.indexCache=e.indexCache||{},e.indexCache[g.cacheName]=e.indexCache[g.cacheName]||{};var h=e.indexCache[g.cacheName],i=g.propertyPath.split(".");return _.each(i,function(a){h[a]=h[a]||{},h=h[a]}),h.map=h.map||[],(!_.isNumber(h.count)||h.count!==g.localCache.length||g.rebuildIndex)&&(h.map=_.deepPluck(g.localCache,g.propertyPath),h.count=g.localCache.length),_.isArray(a)?(d=[],_.each(a,function(a){d.push(g.localCache[h.map.indexOf(a)])})):d=g.localCache[h.map.indexOf(a)],d},c}var k="primary";j.prototype.getLocalEntity=function(a){return b.getEntity(this.list.guid,a)},j.prototype.getAllListItems=function(){var a=h.defer();return c.executeQuery(this,this.queries.getAllListItems,{deferred:a}).then(function(b){a.resolve(b)}),a.promise()},j.prototype.addNewItem=function(a,b){var d=this,e=h.defer();return c.addUpdateItemModel(d,a,b).then(function(a){e.resolve(a),g.registerChange(d)}),e.promise},j.prototype.registerQuery=function(a){var b=this,c={name:k};return a=_.extend({},c,a),b.queries[a.name]=f.create(a,b),b.queries[a.name]},j.prototype.getQuery=function(a){var b,c=this;return b=_.isObject(c.queries[a])?c.queries[a]:_.isObject(c.queries[k])&&!a?c.queries[k]:void 0},j.prototype.getFieldDefinition=function(a){return _.findWhere(this.list.customFields,{mappedName:a})},j.prototype.getCache=function(a){var b,c,d=this;return b=d.getQuery(a),b&&b.cache&&(c=b.cache),c},j.prototype.executeQuery=function(a,b){var c=this,d=c.getQuery(a);return d?d.execute(b):void 0},j.prototype.isInitialised=function(){return _.isDate(this.lastServerUpdate)},j.prototype.createEmptyItem=function(a){var b=this,c={};_.each(b.list.customFields,function(a){a.readOnly||(c[a.mappedName]=apFieldService.getDefaultValueForType(a.objectType))});var d=_.extend({},c,a);return new b.factory(d)},j.prototype.generateMockData=function(a){var b=[],c=this,d={quantity:10,staticValue:!1,permissionLevel:"FullMask"},e=_.extend({},d,a);return _.times(e.quantity,function(){var a={};_.each(c.list.fields,function(b){a[b.mappedName]=b.getMockData(e)}),b.push(new c.factory(a))}),b},j.prototype.validateEntity=function(a,b){var c=!0,d=this,e={toast:!0},f=_.extend({},e,b),g=function(a){return _.isObject(a)&&_.isNumber(a.lookupId)};return _.each(d.list.customFields,function(b){var d=a[b.mappedName],e='"'+b.objectType+'" value.';if(b.required&&c){switch(b.objectType){case"DateTime":c=_.isDate(d);break;case"Lookup":case"User":c=g(d);break;case"LookupMulti":case"UserMulti":c=_.isArray(d)&&d.length>0,c&&_.each(d,function(a){return c?void(c=g(a)):!1});break;default:c=!_.isEmpty(d)}if(!c&&f.toast){var h=b.label||b.internalName;i.error(h+" does not appear to be a valid "+e)}}return c?void 0:!1}),c},j.prototype.initializeModalState=function(b,c){return a.initializeState(b,c,this)},j.prototype.resolvePermissions=function(){return this.list&&this.list.effectivePermMask?utilityService.resolvePermissions(this.list.effectivePermMask):(window.console.error("Attempted to resolve permissions of a model that hasn't been initialized.",this),utilityService.resolvePermissions(null))};var l=function(a){return new j(a)};return{create:l,Model:j}}]),angular.module("angularPoint").factory("apQueryFactory",["apModalService","apCacheService","apDataService","apConfig","$q",function(a,b,c,d,e){function f(a,b){var c=this,f={cache:[],initialized:e.defer(),lastRun:null,listName:b.list.guid,negotiatingWithServer:!1,operation:"GetListItemChangesSinceToken",cacheXML:!1,query:'<Query>   <OrderBy>       <FieldRef Name="ID" Ascending="TRUE"/>   </OrderBy></Query>',queryOptions:"<QueryOptions>   <IncludeMandatoryColumns>FALSE</IncludeMandatoryColumns>   <IncludeAttachmentUrls>TRUE</IncludeAttachmentUrls>   <IncludeAttachmentVersion>FALSE</IncludeAttachmentVersion>   <ExpandUserField>FALSE</ExpandUserField></QueryOptions>",viewFields:b.list.viewFields};d.defaultUrl&&(f.webURL=d.defaultUrl),_.extend(c,f,a);var g=[["query","CAMLQuery"],["viewFields","CAMLViewFields"],["rowLimit","CAMLRowLimit"],["queryOptions","CAMLQueryOptions"],["listItemID","ID"]];_.each(g,function(a){c[a[0]]&&!c[a[1]]&&(c[a[1]]=c[a[0]])
}),c.getModel=function(){return b}}f.prototype.execute=function(a){var b=this,d=b.getModel(),f=e.defer();if(b.negotiatingWithServer)return b.promise;b.negotiatingWithServer=!0;var g=_.isNull(b.lastRun),h={target:b.cache},i=_.extend({},h,a);return c.executeQuery(d,b,i).then(function(){g&&(b.initialized.resolve(i.target),b.negotiatingWithServer=!1),d.lastServerUpdate=new Date,f.resolve(i.target)}),b.promise=f.promise,f.promise},f.prototype.searchLocalCache=function(a,b){var c=this,d=c.getModel(),e={cacheName:c.name,localCache:c.cache},f=_.extend({},e,b);return d.searchLocalCache(a,f)};var g=function(a,b){return new f(a,b)};return{create:g,Query:f}}]),angular.module("angularPoint").service("apUserModel",["$q","apDataService","apConfig",function(a,b,c){var d={};return d._getUserProfile=function(){var d=a.defer();return b.serviceWrapper({operation:"GetUserProfileByName"}).then(function(a){var b={};$(a).SPFilterNode("PropertyData").each(function(){var a=$(this).SPFilterNode("Name"),c=$(this).SPFilterNode("Value");a.length>0&&c.length>0&&(b[a.text().trim()]=c.text().trim())}),b.userLoginName=c.userLoginNamePrefix?c.userLoginNamePrefix+b.AccountName:b.AccountName,d.resolve(b)}),d.promise},d.getUserProfile=d._getUserProfile(),d._getGroupCollection=function(){var c=a.defer();return d.getUserProfile.then(function(a){b.serviceWrapper({operation:"GetGroupCollectionFromUser",userLoginName:a.userLoginName,filterNode:"Group"}).then(function(a){c.resolve(a)})}),c.promise},d.getGroupCollection=d._getGroupCollection(),d.checkIfMember=function(b){var c=a.defer(),e=this;return d.getGroupCollection.then(function(a){e.groupMap&&e.groupMap.length===a.length||(e.groupMap=[],_.each(a,function(a){e.groupMap.push(a.Name)})),c.resolve(_.isObject(a[e.groupMap.indexOf(b)]))}),c.promise},d}]),angular.module("angularPoint").directive("apAttachments",["$sce","toastr",function(a,b){return{restrict:"A",replace:!0,templateUrl:"src/directives/ap_attachments/ap_attachments_tmpl.html",scope:{listItem:"=",changeEvent:"="},link:function(c,d){function e(){_.isFunction(c.changeEvent)&&c.changeEvent(),d.find("iframe").attr("src",d.find("iframe").attr("src"))}c.attachments=[],c.state={ready:!1},c.refresh=function(){c.$$phase||c.$apply()};var f=c.listItem.getModel(),g=f.list.webURL+"/_layouts/Attachfile.aspx?ListId="+f.list.guid+"&ItemId="+c.listItem.id+"&IsDlg=1";c.trustedUrl=a.trustAsResourceUrl(g);var h=function(){b.info("Checking for attachments"),c.listItem.getAttachmentCollection().then(function(a){c.attachments.length=0,Array.prototype.push.apply(c.attachments,a)})};h(),c.fileName=function(a){var b=a.lastIndexOf("/")+1;return a.substr(b)},c.deleteAttachment=function(a){var d=window.confirm("Are you sure you want to delete this file?");d&&(b.info("Negotiating with the server"),c.listItem.deleteAttachment(a).then(function(){b.success("Attachment successfully deleted"),h(),_.isFunction(c.changeEvent)&&c.changeEvent()}))},d.find("iframe").bind("load",function(){c.state.ready=!0,c.refresh();var a=$(this).contents();a.find("#CancelButton").length<1?(b.success("File successfully uploaded"),e(),h(),_.isFunction(c.changeEvent)&&c.changeEvent()):(a.find("#CancelButton").hide(),a.find(".ms-dialog").css({height:"95px"}),a.find("input[name$='Ok']").css({"float":"left"}).click(function(){b.info("Please wait while the file is uploaded")}),a.find("input[name$='$InputFile']").attr({size:40}),a.find("#s4-workspace").css({"overflow-y":"hidden","overflow-x":"hidden"}),console.log("Frame Loaded"))})}}}]),angular.module("angularPoint").directive("apSelect",function(){return{restrict:"A",replace:!0,templateUrl:"src/directives/ap_select/ap_select_tmpl.html",scope:{target:"=",bindedField:"=",multi:"=",arr:"=",lookupValue:"=",ngDisabled:"="},link:function(a){a.bindedField&&!a.target&&(a.target=a.bindedField),a.state={multiSelectIDs:[],singleSelectID:""},a.state.lookupField=a.lookupValue||"title";var b=function(b){var c=parseInt(b,10),d=_.findWhere(a.arr,{id:c});return{lookupId:c,lookupValue:d[a.state.lookupField]}};a.generateDisplayText=function(b){return _.isFunction(a.state.lookupField)?a.state.lookupField(b):_.isString(a.state.lookupField)?b[a.state.lookupField]:b.title},a.updateMultiModel=function(){_.isArray(a.target)||(a.target=[]),a.target.length=0,_.each(a.state.multiSelectIDs,function(c){a.target.push(b(c))})},a.updateSingleModel=function(){a.target=b(a.state.singleSelectID)},a.$watch("target",function(){a.multi?_.each(a.target,function(b){a.state.multiSelectIDs.push(b.lookupId.toString())}):_.isObject(a.target)&&a.target.lookupId&&(a.state.singleSelectID=a.target.lookupId)})}}}),angular.module("angularPoint").run(["$templateCache",function(a){a.put("src/directives/ap_attachments/ap_attachments_tmpl.html",'<div style="min-height: 200px"><div class=row><div class=col-xs-12><div ng-hide=state.ready class="alert alert-info">Loading attachment details</div><div style="height: 110px" ng-show=state.ready><h4><small>Add Attachment</small></h4><iframe frameborder=0 seamless width=100% src="{{ trustedUrl }}" scrolling=no style="height: 95px"></iframe></div></div></div><h4 ng-show="attachments.length > 0"><small>Attachments</small></h4><ul class=list-unstyled><li ng-repeat="attachment in attachments"><a href="{{ attachment }}" target=_blank>{{ fileName(attachment) }}</a> <button class="btn btn-link" ng-click=deleteAttachment(attachment) title="Delete this attachment"><i class="fa fa-times red"></i></button></li></ul></div>'),a.put("src/directives/ap_comments/ap_comments_tmpl.html",'<div><div class=pull-right><button class="btn btn-primary btn-xs" ng-click=createNewComment() title="Create a new comment" ng-show="state.tempComment.length > 0">Save</button> <button class="btn btn-default btn-xs" ng-click=clearTempVars() title="Cancel comment" ng-show="state.tempComment.length > 0">Cancel</button>    </div><div style="min-height: 150px"><div class=newComment><div class=form-group><h4><small>New Comment</small></h4><textarea class=form-control rows=2 ng-model=state.tempComment placeholder="Create a new comment..."></textarea></div></div><div class="alert text-center" style="margin-top: 30px" ng-show=!state.ready><h4><small>loading...</small></h4></div><div class=grey style="margin-top: 30px" ng-show="!comments && !state.newCommentVisible && state.ready">No comments have been made. Create one using the input box above.</div><div ng-if="comments && comments.thread.length > 0" class=comments-container><span ng-include="\'src/directives/ap_comments/ap_recursive_comment.html\'" ng-init="comment = comments;"></span></div></div></div>'),a.put("src/directives/ap_comments/ap_recursive_comment.html",'<ul class=comments><li class=comment ng-repeat="response in comment.thread" style="border-top-width: 1px;border-top-color: grey"><div class=comment-content><div class=content><h5><small><span class=author>{{ response.author.lookupValue }}</span> <span>{{ response.modified | date:\'short\' }}</span> <button class="btn btn-link btn-xs" ng-click="state.respondingTo = response"><i class="fa fa-mail-reply"></i> Reply</button> <button class="btn btn-link btn-xs" ng-click=deleteComment(response)><i class="fa fa-trash-o"></i> Delete</button></small></h5><p class=comment-text>{{ response.comment }}</p></div></div><div ng-if="state.respondingTo === response"><div class=row><div class=col-xs-12><form><div class=form-group><h5><small>Response<label class=pull-right><button class="btn btn-link btn-xs" ng-click=createResponse(response)><i class="fa fa-save"></i> Save</button> <button class="btn btn-link btn-xs" ng-click=clearTempVars()><i class="fa fa-undo"></i> Cancel</button></label></small></h5><textarea class=form-control rows=2 ng-model=state.tempResponse></textarea></div></form></div></div></div><div ng-if="response.thread.length !== -1"><span ng-include="\'src/directives/ap_comments/ap_recursive_comment.html\'" ng-init="comment = response;"></span></div></li></ul>'),a.put("src/directives/ap_select/ap_select_tmpl.html",'<span class=ng-cloak><span ng-if=!multi><select class=form-control ng-model=state.singleSelectID ng-change=updateSingleModel() style="width: 100%" ng-disabled=ngDisabled ng-options="lookup.id as lookup[state.lookupField] for lookup in arr"></select></span> <span ng-if=multi><select multiple ui-select2="" ng-model=state.multiSelectIDs ng-change=updateMultiModel() style="width: 100%" ng-disabled=ngDisabled><option></option><option ng-repeat="lookup in arr" value="{{ lookup.id }}" ng-bind=lookup[state.lookupField]>&nbsp;</option></select></span></span>'),a.put("src/views/generate_offline_view.html",'<div class=container><h3>Offline XML Generator</h3><p>Fill in the basic information for a list and make the request to SharePoint. The xml response will appear at the bottom of the page where you can then copy by Ctrl + A.</p><hr><form role=form><div class=form-group><label>Site URL</label><div class=input-group><input type=url class=form-control ng-model=state.siteUrl><span class=input-group-btn><button title="Refresh list/libraries" class="btn btn-success" type=button ng-click=getLists()><i class="fa fa-refresh"></i></button></span></div></div><div class=row><div class=col-xs-5><div class=form-group><label>List Name or GUID</label><select ng-model=state.selectedList ng-options="list.Title for list in listCollection" class=form-control></select></div></div><div class=col-xs-3><div class=form-group><label>Number of Items to Return</label><input type=number class=form-control ng-model=state.itemLimit><p class=help-block>[0 = All Items]</p></div></div><div class=col-xs-4><div class=form-group><label>Operation</label><select class=form-control ng-model=state.operation ng-options="operation for operation in operations"></select><p class=help-block>Operation to query with.</p></div></div></div><div class=row><div class=col-xs-12><div class=form-group><label>Selected Fields</label><select multiple ui-select2="" ng-model=state.selectedListFields style="width: 100%" ng-disabled="listCollection.length < 1"><option ng-repeat="field in state.availableListFields" value={{field.Name}}>{{ field.Name }}</option></select><p class=help-block>Leaving this blank will return all fields visible in the default list view.</p></div></div></div><div class=form-group><label>CAML Query (Optional)</label><textarea class=form-control ng-model=state.query rows=3></textarea></div><br><button type=submit class="btn btn-primary" ng-click=getXML()>Make Request</button><hr><h4>XML Response</h4><ol><li>Create a new offline file under "app/dev" in angularPoint.</li><li>Use the same name as found in the model at "model.list.title" + .xml</li><li>Select the returned XML below by clicking in the textarea.</li><li>Add the XML to the newly created offline .xml file.</li></ol><div class="well well-sm"><textarea name=xmlResponse class=form-control cols=30 rows=10 ng-model=state.xmlResponse ng-click=onTextClick($event)></textarea></div></form></div>'),a.put("src/views/group_manager_view.html",'<style>select.multiselect {\n        min-height: 400px;\n    }\n\n    .ui-match {\n        background: yellow;\n    }</style><div class=container><ul class="nav nav-tabs"><li ng-class="{active: state.activeTab === \'Users\'}"><a href="" ng-click="updateTab(\'Users\')">Users</a></li><li ng-class="{active: state.activeTab === \'Groups\'}"><a href="" ng-click="updateTab(\'Groups\')">Groups</a></li><li ng-class="{active: state.activeTab === \'Merge\'}"><a href="" ng-click="state.activeTab = \'Merge\'">Merge</a></li><li ng-class="{active: state.activeTab === \'UserList\'}"><a href="" ng-click="state.activeTab = \'UserList\'">User List</a></li><li ng-class="{active: state.activeTab === \'GroupList\'}"><a href="" ng-click="state.activeTab = \'GroupList\'">Group List</a></li></ul><div ng-if="state.activeTab === \'Users\'"><div class="panel panel-default"><div class=panel-heading><div class=row><div class=col-xs-5><span style=font-weight:bold>Select a Group:</span><select class=form-control ng-model=users.filter ng-options="group.Name for group in groups.all" ng-change=updateAvailableUsers(users.filter) style="min-width: 100px"></select></div><div class=col-xs-7><span style=font-weight:bold>Site/Site Collection:</span><input class=form-control ng-model=state.siteUrl ng-change=updateAvailableUsers(users.filter)></div></div><div class=row ng-if=users.filter.Description><div class=col-xs-12><p class=help-block>Description: {{ users.filter.Description }}</p></div></div></div><div class=panel-body><div class=row><div class=col-xs-12><div colspan=3 class=description>This tab will allow you to quickly assign multiple users to a selected group.</div></div></div><hr class=hr-sm><div class=row><div class=col-xs-5><div class=form-group><label>Available Users ({{users.available.length}})</label><select ng-model=users.selectedAvailable ng-options="user.Name for user in users.available" multiple class="multiselect form-control"></select></div></div><div class="col-xs-2 text-center" style="padding-top: 175px"><button class="btn btn-default" style=width:80px ng-click="updatePermissions(\'AddUserToGroup\', users.selectedAvailable, [users.filter])" title="Add user"><i class="fa fa-2x fa-angle-double-right"></i></button><br><br><button class="btn btn-default" style=width:80px ng-click="updatePermissions(\'RemoveUserFromGroup\', users.selectedAssigned, [users.filter])"><i class="fa fa-2x fa-angle-double-left"></i></button></div><div class=col-xs-5><div class=form-group><label>Assigned Users ({{users.assigned.length}})</label><select ng-model=users.selectedAssigned ng-options="user.Name for user in users.assigned" multiple class="multiselect form-control"></select></div></div></div></div></div></div><div ng-if="state.activeTab === \'Groups\'"><div class="panel panel-default"><div class=panel-heading><div class=row><div class=col-xs-5><span style=font-weight:bold>Select a User:</span><select class=form-control ng-model=groups.filter ng-options="user.Name for user in users.all" ng-change=updateAvailableGroups(groups.filter) style="min-width: 100px"></select></div><div class=col-xs-7><span style=font-weight:bold>Site/Site Collection:</span><input class=form-control ng-model=state.siteUrl ng-change=updateAvailableGroups(groups.filter)></div></div></div><div class=panel-body><div class=row><div class=col-xs-12><div colspan=3 class=description>This page was created to make the process of managing users/groups within the site collection more manageable. When a user is selected, the available groups are displayed on the left and the groups that the user is currently a member of will show on the right. Selecting multiple groups is supported.</div></div></div><hr class=hr-sm><div class=row><div class=col-xs-5><div class=form-group><label>Available Groups ({{groups.available.length}})</label><select ng-model=groups.selectedAvailable ng-options="group.Name for group in groups.available" multiple class="multiselect form-control"></select></div></div><div class="col-xs-2 text-center" style="padding-top: 175px"><button class="btn btn-default" style=width:80px ng-click="updatePermissions(\'AddUserToGroup\', [groups.filter], groups.selectedAvailable)" title="Add to group"><i class="fa fa-2x fa-angle-double-right"></i></button><br><br><button class="btn btn-default" style=width:80px ng-click="updatePermissions(\'RemoveUserFromGroup\', [groups.filter], groups.selectedAssigned)"><i class="fa fa-2x fa-angle-double-left"></i></button></div><div class=col-xs-5><div class=form-group><label>Assigned Users ({{users.assigned.length}})</label><select ng-model=groups.selectedAssigned ng-options="group.Name for group in groups.assigned" multiple class="multiselect form-control"></select></div></div></div></div></div></div><div ng-if="state.activeTab === \'Merge\'"><div class="panel panel-default"><div class=panel-body><div class=row><div class=col-xs-12><div class=description>This tab allows us to copy the members from the "Source" group over to the "Target" group. It\'s not a problem if any of the users already exist in the destination group. Note: This is a onetime operation so any additional members added to the Source group will not automatically be added to the destination group. You will need to repeat this process.</div></div></div><hr class=hr-sm><div class=row><div class=col-xs-5><fieldset><legend>Step 1</legend><div class=well><div class=form-group><label>Source Group</label><select class=form-control ng-model=state.sourceGroup ng-options="group.Name for group in groups.all" ng-change=updateAvailableUsers(state.sourceGroup) style="min-width: 100px"></select></div></div></fieldset></div><div class=col-xs-5><fieldset><legend>Step 2</legend><div class=well><div class=form-group><label>Source Group</label><select class=form-control ng-model=state.targetGroup ng-options="group.Name for group in groups.all" style="min-width: 100px"></select></div></div></fieldset></div><div class=col-xs-2><fieldset><legend>Step 3</legend><button class="btn btn-success" ng-disabled="state.sourceGroup.length < 1 || state.targetGroup.length < 1" ng-click=mergeGroups() title="Copy all members from the source group over to the destination group."><i class="fa fa-2x fa-magic"></i> Merge</button></fieldset></div></div></div></div></div><div ng-if="state.activeTab === \'UserList\'"><div class="panel panel-default"><div class=panel-heading><span style=font-weight:bold>User Filter</span><input class=form-control ng-model=state.userFilter ng-change=usersTable.reload()></div><table ng-table=usersTable class=table template-pagination=custom/pager><tr ng-repeat="user in $data"><td data-title="\'ID\'">{{ user.ID }}</td><td data-title="\'Name\'"><a href="" ng-click=userDetailsLink(user) ng-bind-html="user.Name |  highlight:state.userFilter"></a></td><td data-title="\'Email\'">{{ user.Email }}</td></tr></table></div></div><div ng-if="state.activeTab === \'GroupList\'"><div class="panel panel-default"><div class=panel-heading><span style=font-weight:bold>Group Filter</span><input class=form-control ng-model=state.groupFilter ng-change=groupsTable.reload()></div><table ng-table=groupsTable class=table template-pagination=custom/pager><tr ng-repeat="group in $data"><td data-title="\'ID\'">{{ group.ID }}</td><td data-title="\'Name\'"><a href="" ng-click=groupDetailsLink(group) ng-bind-html="group.Name |  highlight:state.groupFilter"></a></td><td data-title="\'Description\'">{{ group.Description }}</td></tr></table></div></div></div><script type=text/ng-template id=custom/pager><div class="row">\n        <div class="col-xs-12">\n            <ul class="pager ng-cloak">\n                <li ng-repeat="page in pages"\n                    ng-class="{\'disabled\': !page.active}"\n                    ng-show="page.type == \'prev\' || page.type == \'next\'" ng-switch="page.type">\n                    <a ng-switch-when="prev" ng-click="params.page(page.number)" href="">\n                        <i class="fa fa-chevron-left"></i>\n                    </a>\n                    <a ng-switch-when="next" ng-click="params.page(page.number)" href="">\n                        <i class="fa fa-chevron-right"></i>\n                    </a>\n                </li>\n            </ul>\n        </div>\n    </div></script>')}]);