"use strict";try{angular.module("toastr")}catch(e){angular.module("toastr",[]).factory("toastr",["$log",function(a){return{error:a.error,info:a.info,success:a.info,warning:a.warn}}])}angular.module("angularPoint",["toastr"]).run(["apConfig",function(a){a.online=!a.offline}]),angular.module("angularPoint").constant("_",_).constant("apConfig",{appTitle:"Angular-Point",debug:!1,defaultQueryName:"primary",firebaseURL:"The optional url of your firebase source",offline:window.location.href.indexOf("localhost")>-1||window.location.href.indexOf("http://0.")>-1||window.location.href.indexOf("http://10.")>-1||window.location.href.indexOf("http://192.")>-1,offlineXML:"dev/"}),angular.module("angularPoint").service("apCacheService",["$q","$log","_",function(a,b,c){function d(a){a.list&&a.list.guid&&a.list.title&&(p[a.list.title]={model:a,entityType:f(a.list.guid)})}function e(a){return p[a]&&p[a].entityType?p[a].entityType:void b.error("The requested list name isn't valid: ",a)}function f(a){return c.isGuid(a)?a.toLowerCase():e(a)}function g(a,b){var c=this;c.associationQueue=[],c.updateCount=0,c.entityType=f(a),c.entityId=b}function h(a,b){var c=k(a,b);return c.getEntity()}function i(a){var b=a.getModel().list.guid,c=k(b,a.id);return c.addEntity(a)}function j(a,b){var c=k(a,b);c.removeEntity()}function k(a,b){var c=f(a);return q[c]&&q[c][b]||(q[c]=q[c]||{},q[c][b]=new g(c,b)),q[c][b]}function l(a,b,c){var d=m(a,b);return d[b]=c,d[b]}function m(a,b){return o[a]=o[a]||{},o[a][b]=o[a][b]||{},o[a][b]}function n(a,b,c){var d=m(a,b);d&&d[b]&&d[b][c.id]&&delete d[b][c.id]}var o={},p={},q={};return g.prototype.getEntity=function(){var b=this,c=a.defer();return b.entity?c.resolve(b.entity):b.associationQueue.push(c),c.promise},g.prototype.addEntity=function(a){var b=this;return b.entity=a,b.updateCount++,b.entity.age=new Date,c.each(b.associationQueue,function(c){c.resolve(a),b.associationQueue.shift()}),b.entity},g.prototype.removeEntity=function(){delete q[this.entityType][this.entityId]},{getEntity:h,removeEntity:j,listItem:{add:l,get:m,remove:n},registerEntity:i,registerModel:d}}]),angular.module("angularPoint").service("apDataService",["$q","$timeout","_","apQueueService","apConfig","apUtilityService","apDecodeService","apEncodeService","apFieldService","toastr",function(a,b,c,d,e,f,g,h,i,j){function k(b,d){var e={operation:"GetVersionCollection"},f=c.extend({},e,b),h=a.defer();return B?n(f).then(function(a){var b=g.parseFieldVersions(a.responseText,d);h.resolve(b)},function(a){j.error("Failed to fetch version history."),h.reject(a)}):h.resolve([]),h.promise}function l(b){d.increase();var f={},g=c.extend({},f,b),h=g.filterNode||g.operation.split("Get")[1].split("Collection")[0],i=a.defer(),k=function(a){var b=[];return"GetAttachmentCollection"===g.operation?$(a).SPFilterNode(h).each(function(){b.push($(this).text())}):b=$(a).SPFilterNode(h).SPXmlToJson({includeAllAttrs:!0,removeOws:!1}),b};if(A){var l=e.offlineXML+g.operation+".xml";$.ajax(l).then(function(a){d.decrease(),i.resolve(k(a))},function(a){j.error("You need to have a "+e.offlineXML+g.operation+".xml in order to get the group collection in offline mode."),i.reject(a),d.decrease()})}else{var n=!0,o=c.extend({},g),p=function(a){c.each(a,function(a){o[a]||(j.error("options"+a+" is required to complete this operation"),n=!1,i.reject([]))})};switch(g.operation){case"GetGroupCollectionFromUser":p(["userLoginName"]);break;case"GetUserCollectionFromGroup":p(["groupName"]);break;case"GetViewCollection":p(["listName"]);break;case"GetAttachmentCollection":p(["listName","ID"])}if(n){var q=$().SPServices(o);q.then(function(){d.decrease(),m(q.responseXML,g.operation),i.resolve(k(q.responseXML))},function(a){j.error("Failed to fetch list collection."),d.decrease(),i.reject(a)})}}return i.promise}function m(a,b){var c=g.checkResponseForErrors(a);c&&console.error(b,c)}function n(b){var f={offlineXML:e.offlineXML+b.operation+".xml"},g=c.extend({},f,b),h=a.defer();d.increase();var i=function(a){return g.filterNode?$(a).SPFilterNode(g.filterNode).SPXmlToJson({includeAllAttrs:!0,removeOws:!1}):a};if(B){var k={};c.extend(k,g);var l=$().SPServices(k);l.then(function(){d.decrease(),m(l.responseXML,g.operation),h.resolve(i(l.responseXML))},function(a){j.error("Failed to complete the requested "+g.operation+" operation."),d.decrease(),h.reject(a)})}else $.ajax(g.offlineXML).then(function(a){d.decrease(),h.resolve(i(a))},function(a){j.error("You need to have a "+g.offlineXML+" file in order mock this request."),h.reject(a),d.decrease()});return h.promise}function o(a){var b={operation:"GetList",filterNode:"Field"},d=c.extend({},b,a);return n(d)}function p(a,b){var d={operation:"GetListItems",filterNode:"z:row",CAMLRowLimit:1,CAMLQuery:'<Query> <Where>   <Eq>     <FieldRef Name="ID"/>     <Value Type="Number">'+a+"</Value>   </Eq> </Where></Query>"},e=c.extend({},d,b);return n(e)}function q(a){var b={operation:"DeleteAttachment",filterNode:"Field"},d=c.extend({},b,a);return n(d)}function r(b){var d={operation:"GetView",offlineXML:e.offlineXML+"GetView.xml"},f=a.defer(),g=c.extend({},d,b);return n(g).then(function(a){var b=e.offline?a:a.responseText,c={query:"<Query>"+$(b).find("Query").html()+"</Query>",viewFields:"<ViewFields>"+$(b).find("ViewFields").html()+"</ViewFields>",rowLimit:$(b).find("RowLimit").html()};f.resolve(c)},function(a){j.error("Failed to fetch view details."),f.reject(a)}),f.promise}function s(b,f,h){var i={target:b.getCache()},k=a.defer(),l=c.extend({},i,h);if(l.getQuery=function(){return f},d.increase(),B){var n=$().SPServices(f);n.then(function(){var a=n.responseXML;if(m(n.responseXML,l.operation),"GetListItemChangesSinceToken"===f.operation){b.fieldDefinitionsExtended||(g.extendListDefinitionFromXML(b.list,a),g.extendFieldDefinitionsFromXML(b.list.fields,a),b.fieldDefinitionsExtended=!0),f.changeToken=u(a);var c=v(a);c&&(b.list.effectivePermMask=c),w(a,l.target)}g.processListItems(b,a,l).then(function(a){f.lastRun=new Date,d.decrease(),k.resolve(a)})})}else{var o=l.offlineXML||f.offlineXML||e.offlineXML+b.list.title+".xml";f.lastRun?(f.lastRun=new Date,d.decrease(),k.resolve(f.cache)):$.ajax(o).then(function(a){g.processListItems(b,a,l).then(function(c){f.lastRun=new Date,d.decrease(),"GetListItemChangesSinceToken"===f.operation&&(g.extendListDefinitionFromXML(b.list,a),g.extendFieldDefinitionsFromXML(b.list.fields,a)),k.resolve(c)})},function(){var a=b.generateMockData();k.resolve(a),j.error('There was a problem locating the "'+e.offlineXML+b.list.title+'.xml"')})}return k.promise}function t(a,b){var d=!1,e=c.findWhere(a,{id:b}),f=c.indexOf(a,e);return f>-1&&(a.splice(f,1),d=!0),d}function u(a){return $(a).find("Changes").attr("LastChangeToken")}function v(a){return $(a).find("listitems").attr("EffectivePermMask")}function w(a,b){var c=0;$(a).SPFilterNode("Id").each(function(){var a=$(this).attr("ChangeType");if("Delete"===a){var d=parseInt($(this).text(),10),e=t(b,d);e&&c++}}),c>0&&A&&console.log(c+" item(s) removed from local cache to mirror changes on source list.")}function x(a,b,d){var e=0;return c.each(a.queries,function(a){a!=d&&g.updateLocalCache(a.cache,[b])}),e}function y(b,e,f){var i={mode:"update",buildValuePairs:!0,updateAllCaches:!1,valuePairs:[]},k=a.defer(),l=c.extend({},i,f);if(d.increase(),l.buildValuePairs===!0){var m=c.where(b.list.fields,{readOnly:!1});l.valuePairs=h.generateValuePairs(m,e)}var n={operation:"UpdateListItems",webURL:b.list.webURL,listName:b.list.guid,valuepairs:l.valuePairs};if(c.isObject(e)&&c.isNumber(e.id)?(n.batchCmd="Update",n.ID=e.id):n.batchCmd="New",B){var o=$().SPServices(n);o.then(function(){g.processListItems(b,o.responseXML,l).then(function(a){var d=a[0];l.updateAllCaches&&c.isNumber(e.id)&&x(b,d,e.getQuery()),k.resolve(d)})},function(a){j.error("There was an error getting the requested data from "+b.list.name),k.reject(a)}).always(function(){d.decrease()})}else{window.console.log(n);var p={modified:new Date,editor:{lookupId:23,lookupValue:"Generic User"}};if(e.id)c.extend(e,p),k.resolve(e);else{var q={};p.author={lookupId:23,lookupValue:"Generic User"},p.created=new Date,c.each(b.queries,function(a){var d=1;c.each(a.cache,function(a){a.id>d&&(d=a.id)}),p.id=d+1,c.extend(e,p),q=new b.factory(e),a.cache.push(q)}),k.resolve(q)}d.decrease()}return k.promise}function z(b,e,f){function g(){var a=0;if(i.updateAllCaches){var b=e.getModel();c.each(b.queries,function(b){var c=t(b.cache,e.id);c&&a++})}else{var d=t(i.target,e.id);d&&a++}return a}var h={target:c.isFunction(e.getContainer)?e.getContainer():b.getCache(),updateAllCaches:!1,operation:"UpdateListItems",webURL:b.list.webURL,listName:b.list.guid,batchCmd:"Delete",ID:e.id},i=c.extend({},h,f),k=a.defer();return B?n(i).then(function(){g(),d.decrease(),k.resolve(i.target)},function(a){j.error("There was an error deleting a list item from "+b.list.title),k.reject(a)}):(g(),k.resolve(i.target)),k.promise}var A=e.offline,B=!A;return{addUpdateItemModel:y,deleteAttachment:q,deleteItemModel:z,getCollection:l,getFieldVersionHistory:k,getListFields:o,getListItemById:p,getView:r,executeQuery:s,serviceWrapper:n}}]),angular.module("angularPoint").service("apDecodeService",["$q","_","apUtilityService","apQueueService","apConfig","apCacheService",function(a,b,c,d,e,f){function g(c,g,h){var k=a.defer(),l={ctor:function(a){a.getQuery=function(){return m.getQuery()},a.getContainer=function(){return m.target};var b=new c.factory(a);return f.registerEntity(b),b},factory:c.factory,filter:"z:row",mapping:c.list.mapping,mode:"update",target:c.getCache(),throttle:e.online},m=b.extend({},l,h),n=$(g).SPFilterNode(m.filter);return j(n,m).then(function(a){if("replace"===m.mode)m.target=a,e.offline&&console.log(c.list.title+" Replaced with "+m.target.length+" new records.");else if("update"===m.mode){var b=i(m.target,a);e.offline&&console.log(c.list.title+" Changes (Create: "+b.created+" | Update: "+b.updated+")")}d.decrease(),k.resolve(a)}),k.promise}function h(a){var b=null;return $(a).find("errorstring").each(function(){b=$(this).text()}),b}function i(a,c){var d=0,e=0,f=b.pluck(a,"id");return b.each(c,function(b){-1===f.indexOf(b.id)?(a.push(b),f.push(b.id),e++):(a[f.indexOf(b.id)]=b,d++)}),{created:e,updated:d}}function j(d,e){var f,g={mapping:{},includeAllAttrs:!1,removeOws:!0,throttle:!0},h=a.defer(),i=b.extend({},g,e),j=[],l=function(a){var c={},d=a.attributes;for(b.each(i.mapping,function(a){c[a.mappedName]=""}),f=0;f<d.length;f++){var e=d[f].name,g=i.mapping[e],h="undefined"!=typeof g?g.mappedName:i.removeOws?e.split("ows_")[1]:e,l="undefined"!=typeof g?g.objectType:void 0;(i.includeAllAttrs||void 0!==g)&&(c[h]=k(d[f].value,l,{getQuery:i.getQuery,entity:c,propertyName:h}))}j.push(b.isFunction(i.ctor)?i.ctor(c):c)};return i.throttle?c.batchProcess(d,l,this,25).then(function(){h.resolve(j)}):(b.each(d,l),h.resolve(j)),h.promise}function k(a,b,c){var d;switch(b){case"DateTime":d=r(a);break;case"Lookup":d=u(a,c);break;case"User":d=s(a);break;case"LookupMulti":d=v(a,c);break;case"UserMulti":d=t(a);break;case"Boolean":d=q(a);break;case"Integer":case"Counter":d=o(a);break;case"Currency":case"Number":case"Float":d=p(a);break;case"Calc":d=x(a);break;case"MultiChoice":d=w(a);break;case"HTML":d=m(a);break;case"JSON":d=l(a);break;case"Choice":default:d=n(a)}return d}function l(a){var b=null;try{b=JSON.parse(a)}catch(c){console.error("Invalid JSON: ",a)}return b}function m(a){return b.unescape(a)}function n(a){return a}function o(a){return a?parseInt(a,10):a}function p(a){return a?parseFloat(a):a}function q(a){return"0"===a||"False"===a?!1:!0}function r(a){return new Date(a.replace(/-/g,"/").replace(/T/i," "))}function s(a){return 0===a.length?null:new z(a)}function t(a){if(0===a.length)return[];for(var b=[],c=a.split(";#"),d=0;d<c.length;d+=2){var e=s(c[d]+";#"+c[d+1]);b.push(e)}return b}function u(a,b){return 0===a.length?null:new y(a,b)}function v(a,b){if(0===a.length)return[];for(var c=[],d=a.split(";#"),e=0;e<d.length;e+=2){var f=u(d[e]+";#"+d[e+1],b);c.push(f)}return c}function w(a){if(0===a.length)return[];for(var b=[],c=a.split(";#"),d=0;d<c.length;d++)0!==c[d].length&&b.push(c[d]);return b}function x(a){if(0===a.length)return null;var b=a.split(";#");return k(b[1],b[0])}function y(a,b){var d=this,e=new c.SplitIndex(a);d.lookupId=e.id,d.lookupValue=e.value,d._props=function(){return b}}function z(a){var b=this,d=new c.SplitIndex(a),e=d.value.split(",#");1===e.length?(b.lookupId=d.id,b.lookupValue=d.value):(b.lookupId=d.id,b.lookupValue=e[0].replace(/(,,)/g,","),b.loginName=e[1].replace(/(,,)/g,","),b.email=e[2].replace(/(,,)/g,","),b.sipAddress=e[3].replace(/(,,)/g,","),b.title=e[4].replace(/(,,)/g,","))}function A(a,c){var d=c||{},e=a.attributes;return b.each(e,function(b,c){var f=e[c].name;d[f]=$(a).attr(f)}),d}function B(a,b){$(b).find("List").each(function(){A(this,a)})}function C(a,c){var d={};b.each(a,function(a){a.internalName&&(d[a.internalName]=a)});var e=$(c).SPFilterNode("Field");return b.each(e,function(a){var c=$(a).attr("StaticName"),e=d[c];if(e&&(A(a,e),"Choice"===e.objectType||"MultiChoice"===e.objectType)){e.Choices=[];var f=$(a).find("CHOICE");b.each(f,function(a){e.Choices.push($(a).text())}),e.Default=$(a).find("Default").text()}}),a}function D(a,b){var c=[],d=$(a).find("Version").length;return $(a).find("Version").each(function(a){var e=this,f={editor:k($(e).attr("Editor"),"User"),modified:k($(e).attr("Modified"),"DateTime"),version:d-a};f[b.mappedName]=k($(e).attr(b.internalName),b.objectType),c.unshift(f)}),c}return{attrToJson:k,checkResponseForErrors:h,extendFieldDefinitionsFromXML:C,extendListDefinitionFromXML:B,lookupToJsonObject:u,parseFieldVersions:D,processListItems:g,updateLocalCache:i,xmlToJson:j}}]),angular.module("angularPoint").service("apEncodeService",["_","apConfig","apUtilityService",function(a,b,c){function d(b){var c="",d=";#";return b.length>0&&(c+=d,a.each(b,function(a){c+=a+d})),c}function e(b,c){var d=[];return a.each(b,function(b){a.has(c,b.mappedName)&&d.push(i(b,c[b.mappedName]))}),d}function f(b){if(!a.isDate(b))return"";var d=f,e="";return e+=b.getFullYear(),e+="-",e+=c.doubleDigit(b.getMonth()+1),e+="-",e+=c.doubleDigit(b.getDate()),e+="T",e+=c.doubleDigit(b.getHours()),e+=":",e+=c.doubleDigit(b.getMinutes()),e+=":",e+=c.doubleDigit(b.getSeconds()),e+="Z-",d.timeZone||(window.console.log("Calculating"),d.timeZone=(new Date).getTimezoneOffset()/60),e+=c.doubleDigit(d.timeZone),e+=":00"}function g(b,c){var d="",e=c||"lookupId";return a.each(b,function(a,c){d+=a[e],c<b.length&&(d+=";#;#")}),d}var h=b.offline,i=function(b,c){var e=[],i=b.internalName;if(c&&""!==c){switch(b.objectType){case"Lookup":case"User":e=c.lookupId?[i,c.lookupId]:[i,""];break;case"LookupMulti":case"UserMulti":var j=g(c,"lookupId");e=[b.internalName,j];break;case"MultiChoice":e=[b.internalName,d(c)];break;case"Boolean":e=[i,c?1:0];break;case"DateTime":e=a.isDate(c)?[i,f(c)]:[i,""];break;case"Note":case"HTML":e=[i,a.escape(c)];break;case"JSON":e=[i,angular.toJson(c)];break;default:e=[i,c]}h&&console.log("{"+b.objectType+"} "+e)}else e=[i,""];return e};return{choiceMultiToString:d,createValuePair:i,generateValuePairs:e,stringifySharePointDate:f,stringifySharePointMultiSelect:g}}]),angular.module("angularPoint").service("apExportService",["_","apUtilityService",function(a,b){var c=function(a,b,c){if(!a)return void console.error("apExportService.save"+b.toUpperCase()+": No data");var d=b.split(";")[0];c||(c="debug."+d),"json"===b&&"object"==typeof a&&(a=JSON.stringify(a,void 0,4));var e=new Blob([a],{type:"text/"+b}),f=document.createEvent("MouseEvents"),g=document.createElement("a");g.download=c,g.href=window.URL.createObjectURL(e),g.dataset.downloadurl=["text/"+b,g.download,g.href].join(":"),f.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),g.dispatchEvent(f)},d=function(a,b){c(a,"json",b)},e=function(a,b){c(a,"xml",b)},f=function(a){var b=a;return b=b.replace(/[\u2018|\u2019|\u201A]/g,"'"),b=b.replace(/[\u201C|\u201D|\u201E]/g,'"'),b=b.replace(/\u2026/g,"..."),b=b.replace(/[\u2013|\u2014]/g,"-"),b=b.replace(/\u02C6/g,"^"),b=b.replace(/\u2039/g,"<"),b=b.replace(/\u203A/g,">"),b=b.replace(/[\u02DC|\u00A0]/g," ")},g=function(b,d){var e="";a.each(b,function(b){a.each(b,function(a,b){var c=null===a?"":f(a);b>0&&(e+=","),c=c.replace(/"/g,'""'),e+='"'+c+'"'}),e+="\n"}),c(e,"csv;charset=utf-8;",d)},h=function(c,d,e){var f={delim:"; "},g=a.extend({},f,e),h=[[]];return a.each(c,function(c,e){var f=[];a.each(d,function(d){var j=a.isString(d)?{field:d}:d,k=j.field.split("."),l=k[0];if(0===e){var m=j.label?j.label:b.fromCamelCase(l);h[0].push(m)}var n="";if(a.isFunction(j.stringify))n=j.stringify(c[j.field]);else if(k.length>1)a.deepIn(c,j.field)&&(n=a.deepGet(c,j.field).toString());else{var o=c.getFieldDefinition(l);n=i(c[j.field],o.objectType,g.delim)}f.push(n)}),h.push(f)}),h},i=function(a,b,c){var d="";if(a)switch(b){case"Lookup":case"User":d=k(a);break;case"Boolean":d=l(a);break;case"DateTime":d=m(a);break;case"Integer":case"Number":case"Counter":d=j(a);break;case"MultiChoice":d=n(a,c);break;case"UserMulti":case"LookupMulti":d=o(a,c);break;default:d=a}return d},j=function(b){var c="";return a.isNumber(b)&&(c=b.toString()),c},k=function(a){var b="";return a&&a.lookupValue&&(b=a.lookupValue),b},l=function(b){var c="";return a.isBoolean(b)&&(c=b.toString()),c},m=function(b){var c="";return a.isDate(b)&&(c=b.toJSON()),c},n=function(b,c){var d="",e=c||"; ";return a.each(b,function(a,b){b>0&&(d+=e),d+=a}),d},o=function(b,c){var d="",e=c||"; ";return a.each(b,function(a,b){b>0&&(d+=e),d+=k(a)}),d};return{generateCSV:h,parseMultiLookup:o,parseBoolean:l,parseDate:m,parseLookup:k,parseMultiChoice:n,parseNumber:j,saveCSV:g,saveFile:c,saveJSON:d,saveXML:e,stringifyProperty:i}}]),angular.module("angularPoint").service("apFieldService",["_","apUtilityService",function(a,b){function c(){return chance.bool()}function d(){return chance.word()+" "+chance.word()}function e(){var b=[];return a.times(a.random(1,4),function(){b.push(d())}),b}function f(){return chance.paragraph()}function g(){return parseInt(100*a.random(1e7,!0))/100}function h(){return chance.date()}function i(){return chance.integer()}function j(a){var b;switch(a){case"AddListItems":b="0x0000000000000002";break;case"EditListItems":b="0x0000000000000004";break;case"DeleteListItems":b="0x0000000000000008";break;case"ApproveItems":b="0x0000000000000010";break;case"FullMask":b="0x7FFFFFFFFFFFFFFF";break;case"ViewListItems":default:b="0x0000000000000001"}return b}function k(a){var b="FullMask";return a&&a.permissionLevel&&(b=a.permissionLevel),j(b)}function l(){return{lookupId:u(),lookupValue:chance.word()}}function m(){return{lookupId:u(),lookupValue:chance.name()}}function n(){var b=[];return a.each(a.random(10),function(){b.push(l())}),b}function o(){var b=[];return a.each(a.random(10),function(){b.push(m())}),b}function p(c){var d=this,e={readOnly:!1,objectType:"Text"};a.extend(d,e,c),d.displayName=d.displayName?d.displayName:b.fromCamelCase(d.mappedName)}function q(a){return v[a]}function r(a){var b,c=q(a);return c&&(b=c.defaultValue),b}function s(b,c){var d,e=q(b);return e&&(d=a.isFunction(Chance)&&c&&!c.staticValue?e.dynamicMock(c):e.staticMock),d}function t(b){var c=function(a){var c=new p(a);b.fields.push(c),b.viewFields+='<FieldRef Name="'+c.internalName+'"/>',b.mapping["ows_"+c.internalName]={mappedName:c.mappedName,objectType:c.objectType}};b.viewFields+="<ViewFields>",a.each(w,function(a){c(a)}),a.each(b.customFields,function(a){c(a)}),b.viewFields+="</ViewFields>"}var u=function(){var a=u;return a.count=a.count||0,a.count++,a.count};p.prototype.getDefinition=function(){return q(this.objectType)},p.prototype.getDefaultValueForType=function(){return r(this.objectType)},p.prototype.getMockData=function(a){return s(this.objectType,a)};var v={Text:{defaultValue:"",staticMock:"Test String",dynamicMock:d},TextLong:{defaultValue:"",staticMock:"This is a sentence.",dynamicMock:f},Boolean:{defaultValue:null,staticMock:!0,dynamicMock:c},Choice:{defaultValue:"",staticMock:"My Choice",dynamicMock:d},ChoiceMulti:{defaultValue:[],staticMock:["A Good Choice","A Bad Choice"],dynamicMock:e},Counter:{defaultValue:null,staticMock:u(),dynamicMock:u},Currency:{defaultValue:null,staticMock:120.5,dynamicMock:g},DateTime:{defaultValue:null,staticMock:new Date(2014,5,4,11,33,25),dynamicMock:h},Integer:{defaultValue:null,staticMock:14,dynamicMock:i},JSON:{defaultValue:"",staticMock:[{id:1,title:"test"},{id:2}],dynamicMock:d},Lookup:{defaultValue:"",staticMock:{lookupId:49,lookupValue:"Static Lookup"},dynamicMock:l},LookupMulti:{defaultValue:[],staticMock:[{lookupId:50,lookupValue:"Static Multi 1"},{lookupId:51,lookupValue:"Static Multi 2"}],dynamicMock:n},Mask:{defaultValue:k(),staticMock:k(),dynamicMock:k},User:{defaultValue:"",staticMock:{lookupId:52,lookupValue:"Static User"},dynamicMock:m},UserMulti:{defaultValue:[],staticMock:[{lookupId:53,lookupValue:"Static User 1"},{lookupId:54,lookupValue:"Static User 2"}],dynamicMock:o}},w=[{internalName:"ID",objectType:"Counter",mappedName:"id",readOnly:!0},{internalName:"Modified",objectType:"DateTime",mappedName:"modified",readOnly:!0},{internalName:"Created",objectType:"DateTime",mappedName:"created",readOnly:!0},{internalName:"Author",objectType:"User",mappedName:"author",readOnly:!0},{internalName:"Editor",objectType:"User",mappedName:"editor",readOnly:!0},{internalName:"PermMask",objectType:"Mask",mappedName:"permMask",readOnly:!0},{internalName:"UniqueId",objectType:"String",mappedName:"uniqueId",readOnly:!0}];return{defaultFields:w,extendFieldDefinitions:t,getDefaultValueForType:r,getMockData:s,getDefinition:q,mockPermMask:k,resolveValueForEffectivePermMask:j}}]),angular.module("angularPoint").service("apModalService",["$modal","_","toastr",function(a,b,c){function d(c){return function d(){var e=d,f={templateUrl:c.templateUrl,controller:c.controller,resolve:{}},g=b.extend({},f,c),h=arguments;b.each(c.expectedArguments,function(a,b){g.resolve[a]=function(){return h[b]}});var i=a.open(g);return h[0]&&(e.snapshot=angular.copy(h[0]),i.result.then(function(){},function(){b.extend(h[0],e.snapshot)})),i.result}}function e(a,b){function c(a){var b=a.resolvePermissions();d.userCanEdit=b.EditListItems,d.userCanDelete=b.DeleteListItems,d.userCanApprove=b.ApproveItems,d.fullControl=b.FullMask}var d={userCanApprove:!1,userCanDelete:!1,userCanEdit:!1,fullControl:!1};return a&&a.resolvePermissions?c(a):b&&b.resolvePermissions&&c(b),d}function f(a,c,d){var f={displayMode:"View",locked:!1,lockedBy:"",negotiatingWithServer:!1,ready:!1},g=e(a,d);return a&&a.id?g.userCanEdit&&(f.displayMode="Edit"):f.displayMode="New",b.extend(f,g,c)}function g(a,b,d,e){var f=window.confirm("Are you sure you want to delete this record?");f&&(b.negotiatingWithServer=!0,a.deleteItem(e).then(function(){c.success("Record deleted successfully"),d.close()},function(){c.error("Failed to delete record.  Please try again.")}))}function h(a,b,d,e,f){a.id?a.saveChanges(f).then(function(){c.success("Record updated"),e.close()},function(){c.error("There was a problem updating this record.  Please try again.")}):b.addNewItem(a,f).then(function(){c.success("New record created"),e.close()},function(){c.error("There was a problem creating a new record.  Please try again.")})}return{deleteEntity:g,initializeState:f,modalModelProvider:d,getPermissions:e,saveEntity:h}}]),angular.module("angularPoint").service("apQueueService",function(){var a=0,b=function(){return a++,g(),a},c=function(){return a>0?(a--,g(),a):void 0},d=function(){return a=0,g(),a},e=[],f=function(a){e.push(a)},g=function(){angular.forEach(e,function(b){b(a)})};return{count:a,decrease:c,increase:b,registerObserverCallback:f,reset:d}}),angular.module("angularPoint").service("apUtilityService",["$q","_","apConfig","$log",function(a,b,c,d){function e(a){return"number"==typeof a?a>9?a.toString():"0"+a:e(parseInt(a))}function f(a){var b=a.getFullYear(),c=a.getMonth()+1,d=a.getDate();return parseInt(b+e(c)+e(d))}function g(a,b,c){if(!a||!b)return!1;c=c||new Date;var d=f(a),e=f(b),g=f(c);return g>=d&&e>=g}function h(b,c,e,f,g){function h(){for(var a=+new Date,l=j;i>j&&g>j-l&&new Date-a<100;)c.call(e,b[j]),j+=1;i>j?(d.info("Batch Delayed"),setTimeout(h,f)):k.resolve(b)}var i=b.length,f=f||25,g=g||i,j=0,k=a.defer();return h(),k.promise}function i(a){var c={};return c.ViewListItems=(1&a)>0,c.AddListItems=(2&a)>0,c.EditListItems=(4&a)>0,c.DeleteListItems=(8&a)>0,c.ApproveItems=(16&a)>0,c.OpenItems=(32&a)>0,c.ViewVersions=(64&a)>0,c.DeleteVersions=(128&a)>0,c.CancelCheckout=(256&a)>0,c.PersonalViews=(512&a)>0,c.ManageLists=(2048&a)>0,c.ViewFormPages=(4096&a)>0,c.Open=(65536&a)>0,c.ViewPages=(131072&a)>0,c.AddAndCustomizePages=(262144&a)>0,c.ApplyThemeAndBorder=(524288&a)>0,c.ApplyStyleSheets=(1048576&a)>0,c.ViewUsageData=(2097152&a)>0,c.CreateSSCSite=(4194314&a)>0,c.ManageSubwebs=(8388608&a)>0,c.CreateGroups=(16777216&a)>0,c.ManagePermissions=(33554432&a)>0,c.BrowseDirectories=(67108864&a)>0,c.BrowseUserInfo=(134217728&a)>0,c.AddDelPrivateWebParts=(268435456&a)>0,c.UpdatePersonalWebParts=(536870912&a)>0,c.ManageWeb=(1073741824&a)>0,c.UseRemoteAPIs=(137438953472&a)>0,c.ManageAlerts=(274877906944&a)>0,c.CreateAlerts=(549755813888&a)>0,c.EditMyUserInfo=(1099511627776&a)>0,c.EnumeratePermissions=(0x4000000000000000&a)>0,c.FullMask=0x8000000000000000==a,c.FullMask&&b.each(c,function(a,b){c[b]=!0}),c}function j(a){return a.replace(/(?:^\w|[A-Z]|\b\w)/g,function(a,b){return 0==b?a.toLowerCase():a.toUpperCase()}).replace(/\s+/g,"")}function k(a){return a.replace(/([A-Z])/g," $1").replace(/^./,function(a){return a.toUpperCase()})}function l(a){var b=a.split(";#");this.id=parseInt(b[0],10),this.value=b[1]}function m(a){!c.offline&&a.sync&&b.isFunction(a.sync.registerChange)&&a.sync.registerChange()}return b.mixin({isDefined:function(a){return!b.isUndefined(a)},isGuid:function(a){return"string"==typeof a&&/[a-fA-F\d]{8}-(?:[a-fA-F\d]{4}-){3}[a-fA-F\d]{12}/.test(a)}}),{batchProcess:h,dateWithinRange:g,doubleDigit:e,fromCamelCase:k,registerChange:m,resolvePermissions:i,SplitIndex:l,toCamelCase:j,yyyymmdd:f}}]),angular.module("angularPoint").factory("apCamlFactory",["_",function(a){var b=function(a,b){var c;switch(a.objectType){case"HTML":case"JSON":c='<Contains><FieldRef Name="'+a.internalName+'" /><Value Type="Text"><![CDATA['+b+"]]></Value></Contains>";break;default:c='<Contains><FieldRef Name="'+a.internalName+'" /><Value Type="Text">'+b+"</Value></Contains>"}return c},c=function(b,c){var d="",e="";return a.each(b,function(a,f){f<b.length-1&&(d+="<"+c+">",e="</"+c+">"+e),d+=a}),d+e},d=function(d,e){var f=[];return a.each(d,function(a){f.push(b(a,e))}),c(f,"And")};return{camlContainsQuery:d,chainCamlSelects:c,createCamlContainsSelector:b}}]),angular.module("angularPoint").factory("apListFactory",["_","apConfig","apFieldService",function(a,b,c){function d(d){var e={viewFields:"",customFields:[],isReady:!1,fields:[],guid:"",mapping:{},title:""};b.defaultUrl&&(e.webURL=b.defaultUrl);var f=a.extend({},e,d);return c.extendFieldDefinitions(f),f}var e=function(a){return new d(a)};return{create:e,List:d}}]),angular.module("angularPoint").factory("apListItemFactory",["$q","_","apCacheService","apDataService","apEncodeService","apUtilityService","apConfig",function(a,b,c,d,e,f,g){function h(){}h.prototype.getDataService=function(){return d},h.prototype.saveChanges=function(b){var c=this,e=c.getModel(),g=a.defer();return d.addUpdateItemModel(e,c,b).then(function(a){g.resolve(a),f.registerChange(e)}),g.promise},h.prototype.saveFields=function(c,g){var h=this,i=h.getModel(),j=a.defer(),k=[];b.each(c,function(a){var c=b.findWhere(i.list.customFields,{mappedName:a});c&&k.push(c)});var l=e.generateValuePairs(k,h),m={buildValuePairs:!1,valuePairs:l},n=b.extend({},m,g);return d.addUpdateItemModel(i,h,n).then(function(a){j.resolve(a),f.registerChange(i)}),j.promise},h.prototype.deleteItem=function(b){var c=this,e=c.getModel(),g=a.defer();return d.deleteItemModel(e,c,b).then(function(a){g.resolve(a),f.registerChange(e)}),g.promise},h.prototype.getLookupReference=function(b,d){var e=this,f=a.defer(),g=d||e[b].lookupId;if(b){var h=e.getModel(),i=h.getFieldDefinition(b);i&&i.List?c.getEntity(i.List,g).then(function(a){f.resolve(a)}):f.fail("Need a List GUID before we can find this in cache.")}else f.fail("Need both fieldName && lookupId params");return f.promise},h.prototype.validateEntity=function(a){var b=this,c=b.getModel();return c.validateEntity(b,a)},h.prototype.getFieldDefinition=function(a){return this.getModel().getFieldDefinition(a)},h.prototype.getAttachmentCollection=function(){return d.getCollection({operation:"GetAttachmentCollection",listName:this.getModel().list.guid,webURL:this.getModel().list.webURL,ID:this.id,filterNode:"Attachment"})},h.prototype.deleteAttachment=function(a){var b=this;return d.deleteAttachment({listItemId:b.id,url:a,listName:b.getModel().list.guid})},h.prototype.resolvePermissions=function(){return f.resolvePermissions(this.permMask)},h.prototype.getEntityReferenceCache=function(){return c.listItem.get(this.uniqueId)},h.prototype.addEntityReference=function(a){var b=this;if(a&&"ListItem"===a.constructor.name){var d=b.uniqueId,e=a.getModel().list.title;return c.listItem.add(d,e,a)}$log.warn("Please verify that a valid entity is being used: ",b,a)},h.prototype.getEntityReferences=function(a){var b=this,c=b.getEntityReferenceCache();return a&&!c[a]?{}:a&&c[a]?c[a]:c},h.prototype.removeEntityReference=function(a){var b=this.uniqueId,d=a.getModel().list.title;return c.listItem.remove(b,d,a)},h.prototype.getFieldVersionHistory=function(c){var e=a.defer(),f=[],h=this,i=h.getModel(),j=function(a){var c=b.findWhere(i.list.fields,{mappedName:a}),e={operation:"GetVersionCollection",strlistID:i.list.guid,strlistItemID:h.id,strFieldName:c.internalName};g.defaultUrl&&(e.webURL=g.defaultUrl),f.push(d.getFieldVersionHistory(e,c))};if(c)b.isString(c)&&(c=[c]);else{var k=b.where(i.list.fields,{readOnly:!1});c=[],b.each(k,function(a){c.push(a.mappedName)})}return b.each(c,function(a){j(a)}),a.all(f).then(function(a){var c={};b.each(a,function(a){b.each(a,function(a){c[a.modified.toJSON()]||(c[a.modified.toJSON()]={}),b.extend(c[a.modified.toJSON()],a)})});var d=[];b.each(c,function(a,b){a.version=b,d.push(a)}),e.resolve(d)}),e.promise};var i=function(a){var c=this;b.extend(c,a)},j=function(){return new h},k=function(){return new i};return{create:j,createGenericFactory:k,ListItem:h,StandardListItem:i}}]),angular.module("angularPoint").factory("apModelFactory",["_","apModalService","apCacheService","apDataService","apListFactory","apListItemFactory","apQueryFactory","apUtilityService","apFieldService","apConfig","$q","toastr",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(b){var d=this,g={data:[],factory:f.createGenericFactory(),fieldDefinitionsExtended:!1,lastServerUpdate:null,queries:{}};return a.extend(d,g,b),d.list=e.create(d.list),d.factory.prototype=f.create(),d.factory.prototype.getModel=function(){return d},c.registerModel(d),d.registerQuery({name:"getAllListItems",operation:"GetListItems"}),d.searchLocalCache=n,d}function n(b,c){var d,e=this,f={propertyPath:"id",localCache:e.getCache(),cacheName:"main",rebuildIndex:!1},g=a.extend({},f,c);e._cachedIndexes=e._cachedIndexes||{},e._cachedIndexes[g.cacheName]=e._cachedIndexes[g.cacheName]||{};var h=e._cachedIndexes[g.cacheName],i=g.propertyPath.split(".");return a.each(i,function(a){h[a]=h[a]||{},h=h[a]}),h.map=h.map||[],(!a.isNumber(h.count)||h.count!==g.localCache.length||g.rebuildIndex)&&(h.map=a.deepPluck(g.localCache,g.propertyPath),h.count=g.localCache.length),a.isArray(b)?(d=[],a.each(b,function(a){d.push(g.localCache[h.map.indexOf(a)])})):d=g.localCache[h.map.indexOf(b)],d}function o(a){var b=this;return c.getEntity(b.list.guid,a)}function p(){var a=this;return d.executeQuery(a,a.queries.getAllListItems)}function q(b,c){var e=this,f=k.defer(),g={listName:e.list.guid},h=a.extend({},g,c);if(j.offline){var i=e.generateMockData({quantity:1});
i.id=b,f.resolve(i)}else d.getListItemById(b,h).then(function(a){f.resolve(1===a.length?a[0]:null)});return f.promise}function r(a,b){var c=this,e=k.defer();return d.addUpdateItemModel(c,a,b).then(function(a){e.resolve(a),h.registerChange(c)}),e.promise}function s(b){var c=this,d={name:E};return b=a.extend({},d,b),c.queries[b.name]=g.create(b,c),c.queries[b.name]}function t(b){var c,d=this;return c=a.isObject(d.queries[b])?d.queries[b]:a.isObject(d.queries[E])&&!b?d.queries[E]:void 0}function u(b){var c=this;return a.findWhere(c.list.fields,{mappedName:b})}function v(a){var b,c,d=this;return b=d.getQuery(a),b&&b.cache&&(c=b.cache),c}function w(a,b){var c=this,d=c.getQuery(a);return d?d.execute(b):void 0}function x(){var b=this;return a.isDate(b.lastServerUpdate)}function y(b){var c=this,d={};a.each(c.list.customFields,function(a){a.readOnly||(d[a.mappedName]=i.getDefaultValueForType(a.objectType))});var e=a.extend({},d,b);return new c.factory(e)}function z(b){var c=[],d=this,e={quantity:10,staticValue:!1,permissionLevel:"FullMask"},f=a.extend({},e,b);return a.times(f.quantity,function(b){var e={};a.each(d.list.fields,function(a){e[a.mappedName]=a.getMockData(f)}),e.id=b+1,c.push(new d.factory(e))}),c}function A(b,c){var d=!0,e=this,f={toast:!0},g=a.extend({},f,c),h=function(b){return a.isObject(b)&&a.isNumber(b.lookupId)};return a.each(e.list.customFields,function(c){var e=b[c.mappedName],f='"'+c.objectType+'" value.';if(c.required&&d){switch(c.objectType){case"Boolean":d=a.isBoolean(e);break;case"DateTime":d=a.isDate(e);break;case"Lookup":case"User":d=h(e);break;case"LookupMulti":case"UserMulti":d=a.isArray(e)&&e.length>0,d&&a.each(e,function(a){return d?void(d=h(a)):!1});break;default:d=!a.isEmpty(e)}if(!d&&g.toast){var i=c.label||c.internalName;l.error(i+" does not appear to be a valid "+f)}}return d?void 0:!1}),d}function B(a,c){return b.initializeState(a,c,this)}function C(){var a=this;return a.list&&a.list.effectivePermMask?h.resolvePermissions(a.list.effectivePermMask):(window.console.error("Attempted to resolve permissions of a model that hasn't been initialized.",a),h.resolvePermissions(null))}function D(a){return new m(a)}var E=j.defaultQueryName;return m.prototype.addNewItem=r,m.prototype.createEmptyItem=y,m.prototype.executeQuery=w,m.prototype.generateMockData=z,m.prototype.getAllListItems=p,m.prototype.getCache=v,m.prototype.getFieldDefinition=u,m.prototype.getListItemById=q,m.prototype.getLocalEntity=o,m.prototype.getQuery=t,m.prototype.initializeModalState=B,m.prototype.isInitialised=x,m.prototype.resolvePermissions=C,m.prototype.registerQuery=s,m.prototype.validateEntity=A,{create:D,Model:m}}]),angular.module("angularPoint").factory("apQueryFactory",["_","apModalService","apCacheService","apDataService","apConfig","$q",function(a,b,c,d,e,f){function g(b,c){var d=this,g={cache:[],initialized:f.defer(),lastRun:null,listName:c.list.guid,negotiatingWithServer:!1,operation:"GetListItemChangesSinceToken",cacheXML:!1,query:'<Query>   <OrderBy>       <FieldRef Name="ID" Ascending="TRUE"/>   </OrderBy></Query>',queryOptions:"<QueryOptions>   <IncludeMandatoryColumns>FALSE</IncludeMandatoryColumns>   <IncludeAttachmentUrls>TRUE</IncludeAttachmentUrls>   <IncludeAttachmentVersion>FALSE</IncludeAttachmentVersion>   <ExpandUserField>FALSE</ExpandUserField></QueryOptions>",viewFields:c.list.viewFields};e.defaultUrl&&(g.webURL=e.defaultUrl),a.extend(d,g,b);var h=[["query","CAMLQuery"],["viewFields","CAMLViewFields"],["rowLimit","CAMLRowLimit"],["queryOptions","CAMLQueryOptions"],["listItemID","ID"]];a.each(h,function(a){d[a[0]]&&!d[a[1]]&&(d[a[1]]=d[a[0]])}),d.getModel=function(){return c}}g.prototype.execute=function(b){var c=this,e=c.getModel(),g=f.defer();if(c.negotiatingWithServer)return c.promise;c.negotiatingWithServer=!0;var h=a.isNull(c.lastRun),i={target:c.cache},j=a.extend({},i,b);return d.executeQuery(e,c,j).then(function(){h&&(c.initialized.resolve(j.target),c.negotiatingWithServer=!1),e.lastServerUpdate=new Date,g.resolve(j.target)}),c.promise=g.promise,g.promise},g.prototype.searchLocalCache=function(b,c){var d=this,e=d.getModel(),f={cacheName:d.name,localCache:d.cache},g=a.extend({},f,c);return e.searchLocalCache(b,g)};var h=function(a,b){return new g(a,b)};return{create:h,Query:g}}]),angular.module("angularPoint").service("apUserModel",["$q","_","apDataService","apConfig",function(a,b,c,d){var e={};return e._getUserProfile=function(){var b=a.defer();return c.serviceWrapper({operation:"GetUserProfileByName"}).then(function(a){var c={};$(a).SPFilterNode("PropertyData").each(function(){var a=$(this).SPFilterNode("Name"),b=$(this).SPFilterNode("Value");a.length>0&&b.length>0&&(c[a.text().trim()]=b.text().trim())}),c.userLoginName=d.userLoginNamePrefix?d.userLoginNamePrefix+c.AccountName:c.AccountName,b.resolve(c)}),b.promise},e.getUserProfile=e._getUserProfile(),e._getGroupCollection=function(){var b=a.defer();return e.getUserProfile.then(function(a){c.serviceWrapper({operation:"GetGroupCollectionFromUser",userLoginName:a.userLoginName,filterNode:"Group"}).then(function(a){b.resolve(a)})}),b.promise},e.getGroupCollection=e._getGroupCollection(),e.checkIfMember=function(c){var d=a.defer(),f=this;return e.getGroupCollection.then(function(a){f.groupMap&&f.groupMap.length===a.length||(f.groupMap=[],b.each(a,function(a){f.groupMap.push(a.Name)})),d.resolve(b.isObject(a[f.groupMap.indexOf(c)]))}),d.promise},e}]),angular.module("angularPoint").directive("apAttachments",["$sce","toastr","_",function(a,b,c){return{restrict:"A",replace:!0,templateUrl:"src/directives/ap_attachments/ap_attachments_tmpl.html",scope:{listItem:"=",changeEvent:"="},link:function(d,e){function f(){c.isFunction(d.changeEvent)&&d.changeEvent(),e.find("iframe").attr("src",e.find("iframe").attr("src"))}d.attachments=[],d.state={ready:!1},d.refresh=function(){d.$$phase||d.$apply()};var g=d.listItem.getModel(),h=g.list.webURL+"/_layouts/Attachfile.aspx?ListId="+g.list.guid+"&ItemId="+d.listItem.id+"&IsDlg=1";d.trustedUrl=a.trustAsResourceUrl(h);var i=function(){b.info("Checking for attachments"),d.listItem.getAttachmentCollection().then(function(a){d.attachments.length=0,Array.prototype.push.apply(d.attachments,a)})};i(),d.fileName=function(a){var b=a.lastIndexOf("/")+1;return a.substr(b)},d.deleteAttachment=function(a){var e=window.confirm("Are you sure you want to delete this file?");e&&(b.info("Negotiating with the server"),d.listItem.deleteAttachment(a).then(function(){b.success("Attachment successfully deleted"),i(),c.isFunction(d.changeEvent)&&d.changeEvent()}))},e.find("iframe").bind("load",function(){d.state.ready=!0,d.refresh();var a=$(this).contents();a.find("#CancelButton").length<1?(b.success("File successfully uploaded"),f(),i(),c.isFunction(d.changeEvent)&&d.changeEvent()):(a.find("#CancelButton").hide(),a.find(".ms-dialog").css({height:"95px"}),a.find("input[name$='Ok']").css({"float":"left"}).click(function(){b.info("Please wait while the file is uploaded")}),a.find("input[name$='$InputFile']").attr({size:40}),a.find("#s4-workspace").css({"overflow-y":"hidden","overflow-x":"hidden"}),console.log("Frame Loaded"))})}}}]),angular.module("angularPoint").directive("apSelect",["_",function(a){return{restrict:"A",replace:!0,templateUrl:"src/directives/ap_select/ap_select_tmpl.html",scope:{target:"=",bindedField:"=",multi:"=",arr:"=",lookupValue:"=",ngDisabled:"="},link:function(b){b.bindedField&&!b.target&&(b.target=b.bindedField),b.state={multiSelectIDs:[],singleSelectID:""},b.state.lookupField=b.lookupValue||"title";var c=function(c){var d=parseInt(c,10),e=a.findWhere(b.arr,{id:d});return{lookupId:d,lookupValue:e[b.state.lookupField]}};b.generateDisplayText=function(c){return a.isFunction(b.state.lookupField)?b.state.lookupField(c):a.isString(b.state.lookupField)?c[b.state.lookupField]:c.title},b.updateMultiModel=function(){a.isArray(b.target)||(b.target=[]),b.target.length=0,a.each(b.state.multiSelectIDs,function(a){b.target.push(c(a))})},b.updateSingleModel=function(){b.target=c(b.state.singleSelectID)},b.$watch("target",function(){b.multi?a.each(b.target,function(a){b.state.multiSelectIDs.push(a.lookupId.toString())}):a.isObject(b.target)&&b.target.lookupId&&(b.state.singleSelectID=b.target.lookupId)})}}}]),angular.module("angularPoint").run(["$templateCache",function(a){a.put("src/directives/ap_attachments/ap_attachments_tmpl.html",'<div style="min-height: 200px"><div class=row><div class=col-xs-12><div ng-hide=state.ready class="alert alert-info">Loading attachment details</div><div style="height: 110px" ng-show=state.ready><h4><small>Add Attachment</small></h4><iframe frameborder=0 seamless width=100% src="{{ trustedUrl }}" scrolling=no style="height: 95px"></iframe></div></div></div><h4 ng-show="attachments.length > 0"><small>Attachments</small></h4><ul class=list-unstyled><li ng-repeat="attachment in attachments"><a href="{{ attachment }}" target=_blank>{{ fileName(attachment) }}</a> <button class="btn btn-link" ng-click=deleteAttachment(attachment) title="Delete this attachment"><i class="fa fa-times red"></i></button></li></ul></div>'),a.put("src/directives/ap_comments/ap_comments_tmpl.html",'<div><div class=pull-right><button class="btn btn-primary btn-xs" ng-click=createNewComment() title="Create a new comment" ng-show="state.tempComment.length > 0">Save</button> <button class="btn btn-default btn-xs" ng-click=clearTempVars() title="Cancel comment" ng-show="state.tempComment.length > 0">Cancel</button>    </div><div style="min-height: 150px"><div class=newComment><div class=form-group><h4><small>New Comment</small></h4><textarea class=form-control rows=2 ng-model=state.tempComment placeholder="Create a new comment..."></textarea></div></div><div class="alert text-center" style="margin-top: 30px" ng-show=!state.ready><h4><small>loading...</small></h4></div><div class=grey style="margin-top: 30px" ng-show="!comments && !state.newCommentVisible && state.ready">No comments have been made. Create one using the input box above.</div><div ng-if="comments && comments.thread.length > 0" class=comments-container><span ng-include="\'src/directives/ap_comments/ap_recursive_comment.html\'" ng-init="comment = comments;"></span></div></div></div>'),a.put("src/directives/ap_comments/ap_recursive_comment.html",'<ul class=comments><li class=comment ng-repeat="response in comment.thread" style="border-top-width: 1px;border-top-color: grey"><div class=comment-content><div class=content><h5><small><span class=author>{{ response.author.lookupValue }}</span> <span>{{ response.modified | date:\'short\' }}</span> <button class="btn btn-link btn-xs" ng-click="state.respondingTo = response"><i class="fa fa-mail-reply"></i> Reply</button> <button class="btn btn-link btn-xs" ng-click=deleteComment(response)><i class="fa fa-trash-o"></i> Delete</button></small></h5><p class=comment-text>{{ response.comment }}</p></div></div><div ng-if="state.respondingTo === response"><div class=row><div class=col-xs-12><form><div class=form-group><h5><small>Response<label class=pull-right><button class="btn btn-link btn-xs" ng-click=createResponse(response)><i class="fa fa-save"></i> Save</button> <button class="btn btn-link btn-xs" ng-click=clearTempVars()><i class="fa fa-undo"></i> Cancel</button></label></small></h5><textarea class=form-control rows=2 ng-model=state.tempResponse></textarea></div></form></div></div></div><div ng-if="response.thread.length !== -1"><span ng-include="\'src/directives/ap_comments/ap_recursive_comment.html\'" ng-init="comment = response;"></span></div></li></ul>'),a.put("src/directives/ap_select/ap_select_tmpl.html",'<span class=ng-cloak><span ng-if=!multi><select class=form-control ng-model=state.singleSelectID ng-change=updateSingleModel() style="width: 100%" ng-disabled=ngDisabled ng-options="lookup.id as lookup[state.lookupField] for lookup in arr"></select></span> <span ng-if=multi><select multiple ui-select2 ng-model=state.multiSelectIDs ng-change=updateMultiModel() style="width: 100%" ng-disabled=ngDisabled><option></option><option ng-repeat="lookup in arr" value="{{ lookup.id }}" ng-bind=lookup[state.lookupField]>&nbsp;</option></select></span></span>'),a.put("src/views/group_manager_view.html",'<style>select.multiselect {\n        min-height: 400px;\n    }\n\n    .ui-match {\n        background: yellow;\n    }</style><div class=container><ul class="nav nav-tabs"><li ng-class="{active: state.activeTab === \'Users\'}"><a href ng-click="updateTab(\'Users\')">Users</a></li><li ng-class="{active: state.activeTab === \'Groups\'}"><a href ng-click="updateTab(\'Groups\')">Groups</a></li><li ng-class="{active: state.activeTab === \'Merge\'}"><a href ng-click="state.activeTab = \'Merge\'">Merge</a></li><li ng-class="{active: state.activeTab === \'UserList\'}"><a href ng-click="state.activeTab = \'UserList\'">User List</a></li><li ng-class="{active: state.activeTab === \'GroupList\'}"><a href ng-click="state.activeTab = \'GroupList\'">Group List</a></li></ul><div ng-if="state.activeTab === \'Users\'"><div class="panel panel-default"><div class=panel-heading><div class=row><div class=col-xs-5><span style=font-weight:bold>Select a Group:</span><select class=form-control ng-model=users.filter ng-options="group.Name for group in groups.all" ng-change=updateAvailableUsers(users.filter) style="min-width: 100px"></select></div><div class=col-xs-7><span style=font-weight:bold>Site/Site Collection:</span> <input class=form-control ng-model=state.siteUrl ng-change=updateAvailableUsers(users.filter)></div></div><div class=row ng-if=users.filter.Description><div class=col-xs-12><p class=help-block>Description: {{ users.filter.Description }}</p></div></div></div><div class=panel-body><div class=row><div class=col-xs-12><div colspan=3 class=description>This tab will allow you to quickly assign multiple users to a selected group.</div></div></div><hr class=hr-sm><div class=row><div class=col-xs-5><div class=form-group><label>Available Users ({{users.available.length}})</label><select ng-model=users.selectedAvailable ng-options="user.Name for user in users.available" multiple class="multiselect form-control"></select></div></div><div class="col-xs-2 text-center" style="padding-top: 175px"><button class="btn btn-default" style=width:80px ng-click="updatePermissions(\'AddUserToGroup\', users.selectedAvailable, [users.filter])" title="Add user"><i class="fa fa-2x fa-angle-double-right"></i></button><br><br><button class="btn btn-default" style=width:80px ng-click="updatePermissions(\'RemoveUserFromGroup\', users.selectedAssigned, [users.filter])"><i class="fa fa-2x fa-angle-double-left"></i></button></div><div class=col-xs-5><div class=form-group><label>Assigned Users ({{users.assigned.length}})</label><select ng-model=users.selectedAssigned ng-options="user.Name for user in users.assigned" multiple class="multiselect form-control"></select></div></div></div></div></div></div><div ng-if="state.activeTab === \'Groups\'"><div class="panel panel-default"><div class=panel-heading><div class=row><div class=col-xs-5><span style=font-weight:bold>Select a User:</span><select class=form-control ng-model=groups.filter ng-options="user.Name for user in users.all" ng-change=updateAvailableGroups(groups.filter) style="min-width: 100px"></select></div><div class=col-xs-7><span style=font-weight:bold>Site/Site Collection:</span> <input class=form-control ng-model=state.siteUrl ng-change=updateAvailableGroups(groups.filter)></div></div></div><div class=panel-body><div class=row><div class=col-xs-12><div colspan=3 class=description>This page was created to make the process of managing users/groups within the site collection more manageable. When a user is selected, the available groups are displayed on the left and the groups that the user is currently a member of will show on the right. Selecting multiple groups is supported.</div></div></div><hr class=hr-sm><div class=row><div class=col-xs-5><div class=form-group><label>Available Groups ({{groups.available.length}})</label><select ng-model=groups.selectedAvailable ng-options="group.Name for group in groups.available" multiple class="multiselect form-control"></select></div></div><div class="col-xs-2 text-center" style="padding-top: 175px"><button class="btn btn-default" style=width:80px ng-click="updatePermissions(\'AddUserToGroup\', [groups.filter], groups.selectedAvailable)" title="Add to group"><i class="fa fa-2x fa-angle-double-right"></i></button><br><br><button class="btn btn-default" style=width:80px ng-click="updatePermissions(\'RemoveUserFromGroup\', [groups.filter], groups.selectedAssigned)"><i class="fa fa-2x fa-angle-double-left"></i></button></div><div class=col-xs-5><div class=form-group><label>Assigned Users ({{users.assigned.length}})</label><select ng-model=groups.selectedAssigned ng-options="group.Name for group in groups.assigned" multiple class="multiselect form-control"></select></div></div></div></div></div></div><div ng-if="state.activeTab === \'Merge\'"><div class="panel panel-default"><div class=panel-body><div class=row><div class=col-xs-12><div class=description>This tab allows us to copy the members from the "Source" group over to the "Target" group. It\'s not a problem if any of the users already exist in the destination group. Note: This is a onetime operation so any additional members added to the Source group will not automatically be added to the destination group. You will need to repeat this process.</div></div></div><hr class=hr-sm><div class=row><div class=col-xs-5><fieldset><legend>Step 1</legend><div class=well><div class=form-group><label>Source Group</label><select class=form-control ng-model=state.sourceGroup ng-options="group.Name for group in groups.all" ng-change=updateAvailableUsers(state.sourceGroup) style="min-width: 100px"></select></div></div></fieldset></div><div class=col-xs-5><fieldset><legend>Step 2</legend><div class=well><div class=form-group><label>Source Group</label><select class=form-control ng-model=state.targetGroup ng-options="group.Name for group in groups.all" style="min-width: 100px"></select></div></div></fieldset></div><div class=col-xs-2><fieldset><legend>Step 3</legend><button class="btn btn-success" ng-disabled="state.sourceGroup.length < 1 || state.targetGroup.length < 1" ng-click=mergeGroups() title="Copy all members from the source group over to the destination group."><i class="fa fa-2x fa-magic"></i> Merge</button></fieldset></div></div></div></div></div><div ng-if="state.activeTab === \'UserList\'"><div class="panel panel-default"><div class=panel-heading><span style=font-weight:bold>User Filter</span> <input class=form-control ng-model=state.userFilter ng-change=usersTable.reload()></div><table ng-table=usersTable class=table template-pagination=custom/pager><tr ng-repeat="user in $data"><td data-title="\'ID\'">{{ user.ID }}</td><td data-title="\'Name\'"><a href ng-click=userDetailsLink(user) ng-bind-html="user.Name |  highlight:state.userFilter"></a></td><td data-title="\'Email\'">{{ user.Email }}</td></tr></table></div></div><div ng-if="state.activeTab === \'GroupList\'"><div class="panel panel-default"><div class=panel-heading><span style=font-weight:bold>Group Filter</span> <input class=form-control ng-model=state.groupFilter ng-change=groupsTable.reload()></div><table ng-table=groupsTable class=table template-pagination=custom/pager><tr ng-repeat="group in $data"><td data-title="\'ID\'">{{ group.ID }}</td><td data-title="\'Name\'"><a href ng-click=groupDetailsLink(group) ng-bind-html="group.Name |  highlight:state.groupFilter"></a></td><td data-title="\'Description\'">{{ group.Description }}</td></tr></table></div></div></div><script type=text/ng-template id=custom/pager><div class="row">\n        <div class="col-xs-12">\n            <ul class="pager ng-cloak">\n                <li ng-repeat="page in pages"\n                    ng-class="{\'disabled\': !page.active}"\n                    ng-show="page.type == \'prev\' || page.type == \'next\'" ng-switch="page.type">\n                    <a ng-switch-when="prev" ng-click="params.page(page.number)" href="">\n                        <i class="fa fa-chevron-left"></i>\n                    </a>\n                    <a ng-switch-when="next" ng-click="params.page(page.number)" href="">\n                        <i class="fa fa-chevron-right"></i>\n                    </a>\n                </li>\n            </ul>\n        </div>\n    </div></script>')}]);