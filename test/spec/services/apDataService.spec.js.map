{"version":3,"sources":["spec/services/apDataService.spec.ts"],"names":["ap"],"mappings":"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","file":"spec/services/apDataService.spec.js","sourcesContent":["/// <reference path=\"../../mock/app.module.mock.ts\" />\n\nmodule ap {\n    'use strict';\n\n    describe(\"Service: apDataService\", function() {\n\n        beforeEach(module(\"angularPoint\"));\n\n        var service: DataService,\n            primaryQueryCache: IndexedCache<MockListItem>,\n            secondaryQueryCache: IndexedCache<MockListItem>,\n            mockModel: MockModel,\n            mockToUpdate: MockListItem,\n            mockXML,\n            mockXMLService,\n            $httpBackend;\n\n\n        beforeEach(inject(function(_apDataService_, _mockModel_, _mockXMLService_, $injector) {\n            service = _apDataService_;\n            mockModel = _mockModel_;\n            mockXMLService = _mockXMLService_;\n            mockXML = mockXMLService.GetListItemChangesSinceToken;\n            mockModel.importMocks();\n            primaryQueryCache = mockModel.getCache('primary');\n            secondaryQueryCache = mockModel.getCache('secondary');\n            mockToUpdate = mockModel.getCache('primary')[1];\n\n            // Set up the mock http service responses\n            $httpBackend = $injector.get('$httpBackend');\n\n\n        }));\n\n        describe('Function: getCurrentSite', function() {\n            it('returns the site url', function() {\n                service.getCurrentSite()\n                    .then(function(response) {\n                        expect(response).toEqual('http://sharepoint.company-server.com/mysite');\n                    });\n                $httpBackend.flush();\n            });\n        });\n\n        describe('Function: updateListItem', function() {\n            it('updates the list item', function() {\n                mockToUpdate.integer = 44;\n                service.updateListItem(mockModel, mockToUpdate)\n                    .then(function(response) {\n                        expect(mockToUpdate.integer).toEqual(44);\n                        expect(response.integer).toEqual(44);\n                    });\n                $httpBackend.flush();\n            });\n            it('updates all cache\\'s because they are be referencing the same object', function() {\n                service.updateListItem(mockModel, primaryQueryCache[1])\n                    .then(function(response) {\n                        expect(primaryQueryCache[1]).toEqual(secondaryQueryCache[1]);\n                        expect(secondaryQueryCache[1].integer).toEqual(response.integer);\n                    });\n                $httpBackend.flush();\n            });\n        });\n\n        describe('Function: createListItem', function() {\n            it('creates a new list item', function() {\n                service.createListItem(mockModel, { integer: 11 })\n                    .then(function(response) {\n                        expect(response.integer).toEqual(11);\n                    });\n                $httpBackend.flush();\n            });\n            it('doesn\\'t add it to existing caches', function() {\n                service.createListItem(mockModel, { integer: 11 })\n                    .then(function(response) {\n                        expect(secondaryQueryCache[response.id]).toBeUndefined();\n                    });\n                $httpBackend.flush();\n            });\n        });\n\n        describe('Function: deleteListItem', function() {\n            it('removes entity with ID of 1 from all cache objects', function() {\n                service.deleteListItem(mockModel, primaryQueryCache[1], { updateAllCaches: true })\n                    .then(function() {\n                        expect(primaryQueryCache[1]).toBeUndefined();\n                        expect(secondaryQueryCache[1]).toBeUndefined();\n                    });\n                $httpBackend.flush();\n            });\n        });\n\n\n        describe('Function: deleteAttachment', function() {\n            it('resolves the deleteAttachment request', function() {\n                service.deleteAttachment({})\n                    .then(function(response) {\n                        /** If an error isn't returned, the operation was successful */\n                        expect(response).toBeDefined();\n                    });\n            })\n        });\n\n        describe('Function: retrieveChangeToken', function() {\n            it('returns the change token from the XML', function() {\n                expect(service.retrieveChangeToken(mockXML))\n                    .toEqual('1;3;f5345fe7-2f7c-49f7-87d0-dbfebdd0ce61;635452551037430000;387547');\n            })\n        });\n\n        describe('Function: retrieveListPermissions', function() {\n            \n            let fullMaskXML = `\n            <?xml version=\"1.0\" encoding=\"utf-8\"?>\n            <soap:Envelope>\n                 <GetListItemChangesSinceTokenResponse xmlns=\"http://schemas.microsoft.com/sharepoint/soap/\">\n                    <GetListItemChangesSinceTokenResult>\n                        <listitems EffectivePermMask='FullMask'></listitems>\n                    </GetListItemChangesSinceTokenResult>\n                </GetListItemChangesSinceTokenResponse>\n            </soap:Envelope>`\n            \n            it('returns permmission object with all permission levels set to true', function() {\n                let permissions = service.retrieveListPermissions(fullMaskXML);\n                _.each(permissions, (permissionValue) => {\n                    expect(permissionValue).toEqual(true);\n                })\n            });\n           \n            \n            let partialPermissionXML = `\n            <?xml version=\"1.0\" encoding=\"utf-8\"?>\n            <soap:Envelope>\n                 <GetListItemChangesSinceTokenResponse xmlns=\"http://schemas.microsoft.com/sharepoint/soap/\">\n                    <GetListItemChangesSinceTokenResult>\n                        <listitems EffectivePermMask='ViewListItems, AddListItems, EditListItems, DeleteListItems'></listitems>\n                    </GetListItemChangesSinceTokenResult>\n                </GetListItemChangesSinceTokenResponse>\n            </soap:Envelope>`\n            \n            it('correctly sets the specified permission levels to true', function() {\n                let permissions = service.retrieveListPermissions(partialPermissionXML);\n                expect(permissions.ViewListItems).toEqual(true);\n                expect(permissions.AddListItems).toEqual(true);\n                expect(permissions.EditListItems).toEqual(true);\n                expect(permissions.DeleteListItems).toEqual(true);\n            });\n            \n            it('leaves unspecified permissions as false', function() {\n                let permissions = service.retrieveListPermissions(partialPermissionXML);\n                expect(permissions.ViewVersions).toEqual(false);\n            });\n            \n            let noPermMaskXML = `\n            <?xml version=\"1.0\" encoding=\"utf-8\"?>\n            <soap:Envelope>\n                 <GetListItemChangesSinceTokenResponse xmlns=\"http://schemas.microsoft.com/sharepoint/soap/\">\n                    <GetListItemChangesSinceTokenResult></GetListItemChangesSinceTokenResult>\n                </GetListItemChangesSinceTokenResponse>\n            </soap:Envelope>`            \n            \n            it('returns undefined if no EffectivePermMask is found', function() {\n                let permissions = service.retrieveListPermissions(noPermMaskXML);\n                expect(permissions).toBeUndefined();\n            });\n            \n        });\n\n        describe('Function: getCollection', function() {\n            it('can process a GetListCollection call', function() {\n                service.getCollection({ operation: 'GetListCollection' })\n                    .then(function(listCollection) {\n                        expect(listCollection.length).toEqual(1);\n                    });\n                $httpBackend.flush();\n            });\n        });\n\n        //describe('Function: getListItemById', function () {\n        //    it('returns a single list item', function () {\n        //        service.getListItemById(1, mockModel)\n        //            .then(function (response) {\n        //                expect(response.id).toEqual(1);\n        //            });\n        //        $httpBackend.flush();\n        //    });\n        //});\n\n        describe('Function: getUserProfileByName', function() {\n            it('returns a user profile object', function() {\n                service.getUserProfileByName()\n                    .then(function(response) {\n                        expect(response).toEqual({\n                            UserProfile_GUID: 'e1234f12-6992-42eb-9bbc-b3a123b29295',\n                            AccountName: 'DOMAIN\\\\John.Doe',\n                            PreferredName: 'DOMAIN\\\\John.Doe',\n                            UserName: 'John.Doe',\n                            userLoginName: 'DOMAIN\\\\John.Doe'\n                        });\n                    });\n                $httpBackend.flush();\n            });\n        });\n\n        describe('Function: getAvailableWorkflows', function() {\n            it('returns a workflow definition', function() {\n                service.getAvailableWorkflows('myFileRef')\n                    .then(function(response: IWorkflowDefinition[]) {\n                        var expectedFirstWorkflowDefinition = {\n                            instantiationUrl: \"https://sharepoint.mycompany.com/_layouts/IniWrkflIP.aspx?List=fc17890e-8c0f-43b5-8e3e-ffae6f456727&amp;ID=5&amp;TemplateID={59062311-cea9-40d1-a183-6edde9333815}&amp;Web={ec744d8e-ae0a-45dd-bcd1-8a63b9b399bd}\",\n                            name: \"WidgetApproval\",\n                            templateId: \"{59062311-cea9-40d1-a183-6edde9333815}\"\n                        }\n                        //Have issues comparing these objects because there's an issue with the instantiationUrl matching\n                        //so just compare the name for each.\n                        expect(response[0].name).toEqual(expectedFirstWorkflowDefinition.name);\n                    });\n                $httpBackend.flush();\n            });\n\n        });\n\n        describe('Function: getGroupCollectionFromUser', function() {\n            it('returns an array of groups the user belongs to', function() {\n                service.getGroupCollectionFromUser()\n                    .then(function(response) {\n                        expect(response).toEqual([{\n                            ID: '385',\n                            Name: 'Super Duper Admins',\n                            Description: '',\n                            OwnerID: '338',\n                            OwnerIsUser: 'True'\n                        }, {\n                                ID: '396',\n                                Name: 'Super Duper Contributors',\n                                Description: 'Members of this group are able to contribute to create and edit project records.',\n                                OwnerID: '385',\n                                OwnerIsUser: 'False'\n                            }, {\n                                ID: '398',\n                                Name: 'Super Duper Viewers',\n                                Description: 'Members of this group are able to view project specific information.',\n                                OwnerID: '385',\n                                OwnerIsUser: 'False'\n                            }]);\n                    });\n                $httpBackend.flush();\n            });\n        });\n\n        //ddescribe('Function: getView', function () {\n        //    it('can process a list definition', function () {\n        //        apDataService.getView({listName: mockModel.list.guid})\n        //            .then(function (response) {\n        //                expect(response.viewFields).toBeDefined();\n        //            });\n        //        $httpBackend.flush();\n        //    });\n        //});\n\n        describe('Function: getList', function() {\n            it('can process a list definition', function() {\n                service.getList({ listName: mockModel.list.guid })\n                    .then(function(response) {\n                        expect(response).toBeDefined();\n                    });\n                $httpBackend.flush();\n            });\n        });\n\n        describe('Function: getListFields', function() {\n            it('returns an array of field definition objects', function() {\n                service.getListFields({ listName: mockModel.list.guid })\n                    .then(function(response) {\n                        expect(response.length).toEqual(98);\n                    });\n                $httpBackend.flush();\n            });\n        });\n\n        describe('Function: getVersionHistory', function() {\n            it('returns an array containing 4 versions of the mock.integer field', function() {\n                var fieldDefinition = mockModel.getField('integer');\n                service.getFieldVersionHistory({}, fieldDefinition)\n                    .then(function(response) {\n                        expect(response.count()).toEqual(4);\n                    });\n                $httpBackend.flush();\n            });\n        });\n\n        describe('Function: executeQuery', function() {\n            it('can complete a query form a known model', function() {\n                primaryQueryCache.clear();\n                ////Ensure there's nothing left in the cache and we remove any existing change token\n                expect(primaryQueryCache.count()).toEqual(0);\n                mockModel.getQuery().changeToken = undefined;\n                service.executeQuery(mockModel, mockModel.getQuery())\n                    .then(function(response) {\n                        expect(response.count()).toEqual(2);\n                    });\n                $httpBackend.flush();\n            });\n        });\n\n        describe('Function: processDeletionsSinceToken', function() {\n            it('removes a deleted entity from the array', function() {\n                service.processDeletionsSinceToken(mockXMLService.getChangeToken_Delete, primaryQueryCache);\n                expect(primaryQueryCache[1]).toBeUndefined();\n            });\n        });\n\n        describe('Function: getAvailableWorkflows', function() {\n            it('removes a deleted entity from the array', function() {\n                service.getAvailableWorkflows(mockToUpdate.fileRef.lookupValue)\n                    .then(function(templates) {\n                        expect(templates.length).toBeGreaterThan(0);\n                        expect(templates[0].name).toEqual('WidgetApproval');\n                    });\n                $httpBackend.flush();\n            });\n        });\n\n    });\n}\n"],"sourceRoot":"/source/"}