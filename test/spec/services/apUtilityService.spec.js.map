{"version":3,"sources":["spec/services/apUtilityService.spec.ts"],"names":["ap","someBigTask"],"mappings":"AAAA,sDAAsD;AAEtD,IAAO,EAAE,CAyMR;AAzMD,WAAO,EAAE,EAAC,CAAC;IACPA,YAAYA,CAACA;IAGbA,QAAQA,CAACA,2BAA2BA,EAAEA;QAElC,IAAI,OAAuB,EACvB,SAAoB,EACpB,UAAU,CAAC;QACf,UAAU,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC,CAAC;QAEnC,UAAU,CAAC,MAAM,CAAC,UAAS,kBAAkB,EAAE,WAAW,EAAE,YAAY;YACpE,OAAO,GAAG,kBAAkB,CAAC;YAC7B,SAAS,GAAG,WAAW,CAAC;YACxB,UAAU,GAAG,YAAY,CAAC;QAC9B,CAAC,CAAC,CAAC,CAAC;QAEJ,QAAQ,CAAC,UAAU,EAAE;YACjB,EAAE,CAAC,qCAAqC,EAAE;gBACtC,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,wCAAwC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC1E,CAAC,CAAC,CAAC;YACH,EAAE,CAAC,8BAA8B,EAAE;gBAC/B,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YACrC,CAAC,CAAC,CAAC;YACH,EAAE,CAAC,4CAA4C,EAAE;gBAC7C,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,sCAAsC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACxE,CAAC,CAAC,CAAA;QACN,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,aAAa,EAAE;YACpB,EAAE,CAAC,qCAAqC,EAAE;gBACtC,IAAI,SAAS,CAAC;gBACd,MAAM,CAAC,CAAC,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YAC/C,CAAC,CAAC,CAAC;YACH,EAAE,CAAC,mCAAmC,EAAE;gBACpC,IAAI,SAAS,GAAG,CAAC,CAAC;gBAClB,MAAM,CAAC,CAAC,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC9C,CAAC,CAAC,CAAC;YACH,EAAE,CAAC,+BAA+B,EAAE;gBAChC,IAAI,SAAS,GAAG,IAAI,CAAC;gBACrB,MAAM,CAAC,CAAC,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC9C,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,aAAa,EAAE;YACpB,EAAE,CAAC,4CAA4C,EAAE;gBAC7C,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;YACjD,CAAC,CAAC,CAAC;YACH,EAAE,CAAC,oDAAoD,EAAE;gBACrD,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;YAClD,CAAC,CAAC,CAAC;YACH,EAAE,CAAC,0DAA0D,EAAE;gBAC3D,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;YACnD,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,UAAU,EAAE;YACjB,EAAE,CAAC,wBAAwB,EAAE;gBACzB,IAAI,QAAQ,GAAG,OAAO,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;gBACtD,MAAM,CAAC,QAAQ,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;YACvC,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,iBAAiB,EAAE;YACxB,EAAE,CAAC,uDAAuD,EAAE;gBACxD,IAAI,KAAK,GAAG,IAAI,IAAI,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,CAAC,EAC5B,GAAG,GAAG,IAAI,IAAI,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,CAAC,EAC1B,IAAI,GAAG,IAAI,IAAI,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;gBAChC,MAAM,CAAC,OAAO,CAAC,eAAe,CAAC,KAAK,EAAE,GAAG,EAAE,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACjE,CAAC,CAAC,CAAC;YACH,EAAE,CAAC,gCAAgC,EAAE;gBACjC,IAAI,KAAK,GAAG,IAAI,IAAI,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,CAAC,EAC5B,GAAG,GAAG,IAAI,IAAI,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;gBAC/B,AACA,8DAD8D;gBAC9D,MAAM,CAAC,OAAO,CAAC,eAAe,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YAC5D,CAAC,CAAC,CAAC;YACH,EAAE,CAAC,0CAA0C,EAAE;gBAC3C,IAAI,KAAK,EACL,GAAG,GAAG,IAAI,IAAI,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;gBAC/B,MAAM,CAAC,OAAO,CAAC,eAAe,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YAC5D,CAAC,CAAC,CAAC;YACH,EAAE,CAAC,wCAAwC,EAAE;gBACzC,IAAI,KAAK,GAAG,IAAI,IAAI,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,CAAC,EAC5B,GAAG,CAAC;gBACR,MAAM,CAAC,OAAO,CAAC,eAAe,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YAC5D,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,wBAAwB,EAAE;YAC/B,AACA,iDADiD;gBAC7C,QAAQ,GAAG,CAAC,CAAC,KAAK,CAAC,IAAI,EAAE,UAAS,CAAC,IAAI,MAAM,CAAC,CAAC,CAAA,CAAC,CAAC,CAAC,EAClD,MAAM,GAAG,EAAE,EACX,UAAU,GAAG,CAAC,CAAC;YAEnB,qBAAqB,MAAM,EAAE,KAAK,EAAE,UAAU;gBAC1CC,MAAMA,CAACA,IAAIA,CAACA,SAASA,CAACA,eAAeA,CAACA,EAAEA,EAAEA,EAAEA,MAAMA,EAAEA,CAACA,CAACA,CAACA;gBACvDA,EAAEA,CAACA,CAACA,UAAUA,GAAGA,UAAUA,CAACA,CAACA,CAACA;oBAC1BA,UAAUA,GAAGA,UAAUA,CAACA;gBAC5BA,CAACA;YACLA,CAACA;YAED,SAAS,CAAC;gBACN,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC;YACtB,CAAC,CAAC,CAAC;YAEH,EAAE,CAAC,sDAAsD,EAAE;gBACvD,OAAO,CAAC,YAAY,CAAC,QAAQ,EAAE,WAAW,EAAE,IAAI,EAAE,EAAE,EAAE,IAAI,CAAC;qBACtD,IAAI,CAAC,UAAS,WAAW;oBACtB,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;oBACpC,MAAM,CAAC,UAAU,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;gBAClC,CAAC,CAAC,CAAC;gBACP,UAAU,CAAC,OAAO,EAAE,CAAC;YACzB,CAAC,CAAC,CAAC;YAEH,4DAA4D;YAC5D,yFAAyF;YACzF,yEAAyE;YACzE,wCAAwC;YACxC,4CAA4C;YAC5C,aAAa;YACb,2BAA2B;YAC3B,KAAK;QACT,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,oBAAoB,EAAE;YAE3B,EAAE,CAAC,gEAAgE,EAAE;gBACjE,AACA,kBADkB;oBACd,WAAW,GAAG,OAAO,CAAC,kBAAkB,CAAC,oBAAoB,CAAC,CAAC;gBACnE,CAAC,CAAC,IAAI,CAAC,WAAW,EAAE,UAAC,aAAa,EAAE,cAAc;oBAC9C,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBACnD,CAAC,CAAC,CAAA;YACN,CAAC,CAAC,CAAC;YACH,EAAE,CAAC,+CAA+C,EAAE;gBAChD,AACA,0BAD0B;oBACtB,WAAW,GAAG,OAAO,CAAC,kBAAkB,CAAC,oBAAoB,CAAC,CAAC;gBACnE,IAAI,mBAAmB,GAAG;oBACtB,cAAc;oBACd,eAAe;oBACf,iBAAiB;oBACjB,cAAc;oBACd,WAAW;oBACX,cAAc;oBACd,gBAAgB;oBAChB,gBAAgB;oBAChB,aAAa;oBACb,eAAe;iBAClB,CAAC;gBACF,AACA,6BAD6B;gBAC7B,MAAM,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBAC7C,AACA,+BAD+B;gBAC/B,CAAC,CAAC,IAAI,CAAC,mBAAmB,EAAE,UAAC,cAAc;oBACvC,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;gBACpD,CAAC,CAAC,CAAA;YAEN,CAAC,CAAC,CAAC;YACH,EAAE,CAAC,+CAA+C,EAAE;gBAChD,AACA,gHADgH;oBAC5G,WAAW,GAAG,OAAO,CAAC,kBAAkB,CAAC,oBAAoB,CAAC,CAAC;gBACnE,AACA,8BAD8B;gBAC9B,MAAM,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBAC7C,MAAM,CAAC,WAAW,CAAC,YAAY,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBAC5C,MAAM,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBAC7C,AACA,4BAD4B;gBAC5B,MAAM,CAAC,WAAW,CAAC,eAAe,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;gBAChD,MAAM,CAAC,WAAW,CAAC,YAAY,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;gBAC7C,MAAM,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;gBAC1C,MAAM,CAAC,WAAW,CAAC,YAAY,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;gBAC7C,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;gBAC/C,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;gBAC/C,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;gBAC/C,MAAM,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;gBAC5C,MAAM,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YAClD,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,mCAAmC,EAAE;YAC1C,EAAE,CAAC,mCAAmC,EAAE;gBACpC,MAAM,CAAC,OAAO,CAAC,wBAAwB,CAAC,UAAU,CAAC,CAAC,CAAC,OAAO,CAAC,oBAAoB,CAAC,CAAC;YACvF,CAAC,CAAC,CAAC;YACH,EAAE,CAAC,2DAA2D,EAAE;gBAC5D,MAAM,CAAC,OAAO,CAAC,wBAAwB,CAAC,mBAAmB,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAC;YAC7E,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,YAAY,EAAE;YACnB,EAAE,CAAC,qCAAqC,EAAE;gBACtC,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC,gBAAgB,CAAC,CAAC,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC;YACzE,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,YAAY,EAAE;YACnB,EAAE,CAAC,uCAAuC,EAAE;gBACxC,IAAI,QAAQ,GAAG,IAAI,OAAO,CAAC,UAAU,CAAC,eAAe,CAAC,CAAC;gBACvD,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,KAAK,EAAE,WAAW,EAAE,CAAC,CAAC,CAAC;YAC7F,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;IAGP,CAAC,CAACD,CAACA;AAEPA,CAACA,EAzMM,EAAE,KAAF,EAAE,QAyMR","file":"spec/services/apUtilityService.spec.js","sourcesContent":["/// <reference path=\"../../mock/app.module.mock.ts\" />\n\nmodule ap {\n    'use strict';\n\n\n    describe(\"Service: apUtilityService\", function() {\n\n        var service: UtilityService,\n            mockModel: MockModel,\n            $rootScope;\n        beforeEach(module(\"angularPoint\"));\n\n        beforeEach(inject(function(_apUtilityService_, _mockModel_, _$rootScope_) {\n            service = _apUtilityService_;\n            mockModel = _mockModel_;\n            $rootScope = _$rootScope_;\n        }));\n\n        describe('_.isGuid', function() {\n            it(\"Should detect when a GUID is valid.\", function() {\n                expect(_.isGuid('{00A69513-BB63-4333-9639-EB14C08269DB}')).toBe(true);\n            });\n            it(\"Should reject a missing GUID\", function() {\n                expect(_.isGuid('')).toBe(false);\n            });\n            it(\"Should detect GUID without curly brackets.\", function() {\n                expect(_.isGuid('00A69513-BB63-4333-9639-EB14C08269DB')).toBe(true);\n            })\n        });\n\n        describe('_.isDefined', function() {\n            it('returns true for an undefined value', function() {\n                var someValue;\n                expect(_.isDefined(someValue)).toBe(false);\n            });\n            it('returns false for a defined value', function() {\n                var someValue = 2;\n                expect(_.isDefined(someValue)).toBe(true);\n            });\n            it('returns true for a null value', function() {\n                var someValue = null;\n                expect(_.isDefined(someValue)).toBe(true);\n            });\n        });\n\n        describe('doubleDigit', function() {\n            it(\"Should add a leading 0 for a single digit.\", function() {\n                expect(service.doubleDigit(3)).toEqual('03');\n            });\n            it(\"Should return a 2 digit string for a double digit.\", function() {\n                expect(service.doubleDigit(11)).toEqual('11');\n            });\n            it(\"Should work when a number represented by string is used.\", function() {\n                expect(service.doubleDigit('3')).toEqual('03');\n            });\n        });\n\n        describe('yyyymmdd', function() {\n            it(\"Should convert a date.\", function() {\n                var testDate = service.yyyymmdd(new Date(2012, 0, 1));\n                expect(testDate).toEqual(20120101);\n            });\n        });\n\n        describe('dateWithinRange', function() {\n            it(\"works with a valid start and end with date in middle.\", function() {\n                var start = new Date(2012, 1, 1),\n                    end = new Date(2012, 1, 3),\n                    date = new Date(2012, 1, 2);\n                expect(service.dateWithinRange(start, end, date)).toBe(true);\n            });\n            it(\"works without a date to check.\", function() {\n                var start = new Date(2014, 1, 1),\n                    end = new Date(2014, 1, 2);\n                //Current date is in the future so it is not within the range.\n                expect(service.dateWithinRange(start, end)).toBe(false);\n            });\n            it('returns false if a start date is missing', function() {\n                var start,\n                    end = new Date(2014, 1, 2);\n                expect(service.dateWithinRange(start, end)).toBe(false);\n            });\n            it('returns false if a end date is missing', function() {\n                var start = new Date(2014, 1, 1),\n                    end;\n                expect(service.dateWithinRange(start, end)).toBe(false);\n            });\n        });\n\n        describe('Function: batchProcess', function() {\n            //Create simple array of integers to loop through\n            var entities = _.times(1000, function(n) { return n }),\n                output = [],\n                batchCount = 0;\n\n            function someBigTask(entity, index, batchIndex) {\n                output.push(mockModel.createEmptyItem({ id: entity }));\n                if (batchIndex > batchCount) {\n                    batchCount = batchIndex;\n                }\n            }\n\n            afterEach(function() {\n                output.length = 0;\n            });\n\n            it('resolves with the expected outcome in a single batch', function() {\n                service.batchProcess(entities, someBigTask, this, 25, 2000)\n                    .then(function(entityArray) {\n                        expect(output.length).toEqual(1000);\n                        expect(batchCount).toEqual(1);\n                    });\n                $rootScope.$digest();\n            });\n\n            //TODO Get this working after the first timeout is triggered\n            //it('splits the request into multiple batches if we exceed the max items', function () {\n            //    apUtilityService.batchProcess(entities, someBigTask, this, 25, 750)\n            //        .then(function (entityArray) {\n            //            expect(batchCount).toEqual(1);\n            //        });\n            //    $rootScope.$digest();\n            //});\n        });\n\n        describe('resolvePermissions', function() {\n\n            it('allows user with FullMask to have all permissions set to true.', function() {\n                //Full rights mask\n                let permissions = service.resolvePermissions('0x7FFFFFFFFFFFFFFF');\n                _.each(permissions, (permissionVal, permissionName) => {\n                    expect(permissions[permissionName]).toBe(true);\n                })\n            });\n            it('Should prevent read-only user from approving.', function() {\n                //Limited user (view only)\n                let permissions = service.resolvePermissions('0x0000000000000001');\n                let rejectedPermissions = [\n                    'AddListItems',\n                    'EditListItems',\n                    'DeleteListItems',\n                    'ApproveItems',\n                    'OpenItems',\n                    'ViewVersions',\n                    'DeleteVersions',\n                    'CancelCheckout',\n                    'ManageLists',\n                    'ViewFormPages'\n                ];\n                //Should only be able to view\n                expect(permissions.ViewListItems).toBe(true);\n                //All others should be rejected\n                _.each(rejectedPermissions, (permissionName) => {\n                    expect(permissions[permissionName]).toBe(false);\n                })\n\n            });\n            it('Should allow a user with edit rights to edit.', function() {\n                //0x0000000000000007 combines View (0x0000000000000001), Add (0x0000000000000002), and Edit (0x0000000000000004)\n                let permissions = service.resolvePermissions('0x0000000000000007');\n                //User can view, add, and edit\n                expect(permissions.ViewListItems).toBe(true);\n                expect(permissions.AddListItems).toBe(true);\n                expect(permissions.EditListItems).toBe(true);\n                //But can't do anything else\n                expect(permissions.DeleteListItems).toBe(false);\n                expect(permissions.ApproveItems).toBe(false);\n                expect(permissions.OpenItems).toBe(false);\n                expect(permissions.ViewVersions).toBe(false);\n                expect(permissions.DeleteVersions).toBe(false);\n                expect(permissions.CancelCheckout).toBe(false);\n                expect(permissions.DeleteVersions).toBe(false);\n                expect(permissions.ManageLists).toBe(false);\n                expect(permissions.ViewFormPages).toBe(false);\n            });\n        });\n\n        describe('Function convertEffectivePermMask', function() {\n            it('returns the mask for \\'FullMask\\'', function() {\n                expect(service.convertEffectivePermMask('FullMask')).toEqual('0x7FFFFFFFFFFFFFFF');\n            });\n            it('returns null when a matching permission name isn\\'t found', function() {\n                expect(service.convertEffectivePermMask('Some Unknown Mask')).toBeNull();\n            });\n        });\n\n        describe('toCamlCase', function() {\n            it(\"Convert multiple words with spaces.\", function() {\n                expect(service.toCamelCase('This is a test')).toEqual('thisIsATest');\n            });\n        });\n\n        describe('SplitIndex', function() {\n            it(\"Converts delimited string into object\", function() {\n                var splitObj = new service.SplitIndex('12;#TestValue');\n                expect(JSON.stringify(splitObj)).toEqual(JSON.stringify({ id: 12, value: 'TestValue' }));\n            });\n        });\n\n\n    });\n\n}"],"sourceRoot":"/source/"}