<h1><code ng:non-bindable="">registerQuery</code>
<div><span class="hint">service in module <code ng:non-bindable="">Model</code>
</span>
</div>
</h1>
<div><h2 id="description">Description</h2>
<div class="description"><div class="model-registerquery-page"><p>Constructor that allows us create a static query with the option to build dynamic queries as seen in the
third example.  This construct is a passthrough to <a href="http: //spservices.codeplex.com/">SPServices</a></p>
</div></div>
<h2 id="usage">Usage</h2>
<div class="usage"><pre class="prettyprint linenums">registerQuery(queryOptions);</pre>
<h4 id="usage_parameters">Parameters</h4><table class="variables-matrix table table-bordered table-striped"><thead><tr><th>Param</th><th>Type</th><th>Details</th></tr></thead><tbody><tr><td>queryOptions</td><td><a href="" class="label type-hint type-hint-object">object</a></td><td><div class="model-registerquery-page"><p>Initialization parameters.</p>
</div></td></tr><tr><td>queryOptions.force</td><td><a href="" class="label type-hint type-hint-boolean">boolean</a></td><td><div class="model-registerquery-page"><p>Ignore cached data and force server query.</p>
</div> <p><em>(default: false)</em></p></td></tr><tr><td>[queryOptions.listItemID]</td><td><a href="" class="label type-hint type-hint-number">number</a></td><td><div class="model-registerquery-page"><p>Optionally request for a single list item by id.</p>
</div></td></tr><tr><td>queryOptions.localStorage</td><td><a href="" class="label type-hint type-hint-boolean">boolean</a></td><td><div class="model-registerquery-page"><p>Should we store data from this query in local storage to speed up requests in the future.</p>
</div> <p><em>(default: false)</em></p></td></tr><tr><td>queryOptions.localStorageExpiration</td><td><a href="" class="label type-hint type-hint-number">number</a></td><td><div class="model-registerquery-page"><p>Set expiration in milliseconds - Defaults to a day
and if set to 0 doesn&#39;t expire.  Can be updated globally using apConfig.localStorageExpiration.</p>
</div> <p><em>(default: 86400000)</em></p></td></tr><tr><td>queryOptions.name</td><td><a href="" class="label type-hint type-hint-string">string</a></td><td><div class="model-registerquery-page"><p>The name that we use to identify this query.</p>
</div> <p><em>(default: primary)</em></p></td></tr><tr><td>queryOptions.operation</td><td><a href="" class="label type-hint type-hint-string">string</a></td><td><div class="model-registerquery-page"><p>Optionally use &#39;GetListItems&#39; to
receive a more efficient response, just don&#39;t have the ability to check for changes since the last time
the query was called. Defaults to <a href="http://msdn.microsoft.com/en-us/library/lists.lists.getlistitemchangessincetoken%28v=office.12%29.aspx">GetListItemChangesSinceToken</a>
but for a smaller payload and faster response you can use <a href="http: //spservices.codeplex.com/wikipage?title=GetListItems&amp;referringTitle=Lists">GetListItems</a>.</p>
</div> <p><em>(default: GetListItemChangesSinceToken)</em></p></td></tr><tr><td>queryOptions.query</td><td><a href="" class="label type-hint type-hint-string">string</a></td><td><div class="model-registerquery-page"><p>CAML query passed to SharePoint to control
the data SharePoint returns. Josh McCarty has a good quick reference <a href="http: //joshmccarty.com/2012/06/a-caml-query-quick-reference">here</a>.</p>
</div> <p><em>(default: Ordered ascending by ID)</em></p></td></tr><tr><td>[queryOptions.queryOptions]</td><td><a href="" class="label type-hint type-hint-string">string</a></td><td><div class="model-registerquery-page"><p>SharePoint options xml as string.
<pre class="prettyprint linenums">
&lt;QueryOptions&gt;
   &lt;IncludeMandatoryColumns&gt;FALSE&lt;/IncludeMandatoryColumns&gt;
   &lt;IncludeAttachmentUrls&gt;TRUE&lt;/IncludeAttachmentUrls&gt;
   &lt;IncludeAttachmentVersion&gt;FALSE&lt;/IncludeAttachmentVersion&gt;
   &lt;ExpandUserField&gt;FALSE&lt;/ExpandUserField&gt;
&lt;/QueryOptions&gt;
</pre>
</div></td></tr><tr><td>[queryOptions.rowLimit]</td><td><a href="" class="label type-hint type-hint-string">string</a></td><td><div class="model-registerquery-page"><p>The number of list items to return, 0 returns all list items.</p>
</div></td></tr><tr><td>[queryOptions.runOnce]</td><td><a href="" class="label type-hint type-hint-boolean">boolean</a></td><td><div class="model-registerquery-page"><p>Pertains to GetListItems only, optionally run a single time and return initial value for all future
calls.  Works well with data that isn&#39;t expected to change throughout the session but unlike localStorage or sessionStorage
the data doesn&#39;t persist between sessions.</p>
</div></td></tr><tr><td>queryOptions.sessionStorage</td><td><a href="" class="label type-hint type-hint-boolean">boolean</a></td><td><div class="model-registerquery-page"><p>Use the browsers sessionStorage to cache the list items and uses the
queryOptions.localStorageExpiration param to validate how long the cache is good for.</p>
</div> <p><em>(default: false)</em></p></td></tr><tr><td>[queryOptions.viewFields]</td><td><a href="" class="label type-hint type-hint-string">string</a></td><td><div class="model-registerquery-page"><p>XML as string that specifies fields to return.</p>
</div></td></tr><tr><td>[queryOptions.webURL]</td><td><a href="" class="label type-hint type-hint-string">string</a></td><td><div class="model-registerquery-page"><p>Used to override the default URL if list is located somewhere else.</p>
</div></td></tr></tbody></table><h4 id="usage_returns">Returns</h4><table class="variables-matrix"><tr><td><a href="" class="label type-hint type-hint-object">object</a></td><td><div class="model-registerquery-page"><p>Query Returns a new query object.</p>
</div></td></tr></table></div>
<h2 id="example">Example</h2>
<div class="example"><div class="model-registerquery-page"><p><h6 id="example_example-#1">Example #1</h6>
<pre class="prettyprint linenums">
// Query to retrieve the most recent 25 modifications
model.registerQuery({
   name: 'recentChanges',
   rowLimit: 25,
   query: '' +
       '&lt;Query&gt;' +
       '   &lt;OrderBy&gt;' +
       '       &lt;FieldRef Name="Modified" Ascending="FALSE"/&gt;' +
       '   &lt;/OrderBy&gt;' +
           //Prevents any records from being returned if user doesn't
           // have permissions on project
       '   &lt;Where&gt;' +
       '       &lt;IsNotNull&gt;' +
       '           &lt;FieldRef Name="Project"/&gt;' +
       '       &lt;/IsNotNull&gt;' +
       '   &lt;/Where&gt;' +
       '&lt;/Query&gt;'
});
</pre>
<p><h6 id="example_example-#2">Example #2</h6>
<pre class="prettyprint linenums">
// Could be placed on the projectModel and creates the query but doesn't
// call it.  Uses the session cache to make the initial call faster.
projectModel.registerQuery({
    name: 'primary',
    sessionCache: true,
    //Set an expiration value of 8 hours rather than use the default of 24
    localStorageExpiration: 28800000,
    query: '' +
        '&lt;Query&gt;' +
        '   &lt;OrderBy&gt;' +
        '       &lt;FieldRef Name="Title" Ascending="TRUE"/&gt;' +
        '   &lt;/OrderBy&gt;' +
        '&lt;/Query&gt;'
});

//To call the query or check for changes since the last call
projectModel.executeQuery('primary')
  .then((entities) =&gt; {
    // We now have a reference to array of entities stored in the local
    // cache.  These inherit from the ListItem prototype as well as the
    // Project prototype on the model
    vm.projects = entities;
  })
  .catch((err) =&gt; {
      //Handle error
  })
</pre>
<p><h6 id="example_example-#3">Example #3</h6>
<pre class="prettyprint linenums">
// Advanced functionality that would allow us to dynamically create
// queries for list items with a lookup field associated with a specific
// project id.  Let's assume this is on the projectTasksModel.
model.queryByProjectId(projectId) {
    // Unique query name
    var queryKey = 'pid' + projectId;

    // Register project query if it doesn't exist
    if (!_.isObject(model.queries[queryKey])) {
        model.registerQuery({
            name: queryKey,
            query: '' +
                '&lt;Query&gt;' +
                '   &lt;OrderBy&gt;' +
                '       &lt;FieldRef Name="ID" Ascending="TRUE"/&gt;' +
                '   &lt;/OrderBy&gt;' +
                '   &lt;Where&gt;' +
                '       &lt;And&gt;' +
                             // Prevents any records from being returned
                             //if user doesn't have permissions on project
                '           &lt;IsNotNull&gt;' +
                '               &lt;FieldRef Name="Project"/&gt;' +
                '           &lt;/IsNotNull&gt;' +
                             // Return all records for the project matching
                             // param projectId
                '           &lt;Eq&gt;' +
                '               &lt;FieldRef Name="Project" LookupId="TRUE"/&gt;' +
                '               &lt;Value Type="Lookup"&gt;' + projectId + '&lt;/Value&gt;' +
                '           &lt;/Eq&gt;' +
                '       &lt;/And&gt;' +
                '   &lt;/Where&gt;' +
                '&lt;/Query&gt;'
        });
    }
    //Still using execute query but now we have a custom query
    return model.executeQuery(queryKey);
};
</pre>
</div></div>
</div>
